"use strict";(self.webpackChunk_bitwarden_web_vault=self.webpackChunk_bitwarden_web_vault||[]).push([[212],{53562:(e,t,s)=>{s.d(t,{Y:()=>z});var i=s(99042),r=s(24852),n=s(98645),o=s(54019),a=s(68362),l=s(62324),c=s(53634),u=s(28055),p=s(82083),h=s(85958),d=s(76528),m=s(78627),f=s(99721),g=s(87483),y=s(83924),v=s(66459),w=s(42304),O=s(53481),x=s(73369),N=function(e,t,s,i){return new(s||(s=Promise))((function(r,n){function o(e){try{l(i.next(e))}catch(t){n(t)}}function a(e){try{l(i.throw(e))}catch(t){n(t)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,a)}l((i=i.apply(e,t||[])).next())}))};class _{get disabledByPolicy(){return this._disabledByPolicy}constructor(e,t,s,i,a,l,c,u,h,d,m,f){this.cryptoService=e,this.i18nService=t,this.platformUtilsService=s,this.exportService=i,this.eventCollectionService=a,this.policyService=l,this.win=c,this.logService=u,this.userVerificationService=h,this.formBuilder=d,this.fileDownloadService=m,this.dialogService=f,this.onSaved=new r.vpe,this._disabledByPolicy=!1,this.exportForm=this.formBuilder.group({format:["json"],secret:[""],filePassword:["",n.kI.required],confirmFilePassword:["",n.kI.required],fileEncryptionType:[p.x$.AccountEncrypted]}),this.formatOptions=[{name:".json",value:"json"},{name:".csv",value:"csv"},{name:".json (Encrypted)",value:"encrypted_json"}],this.destroy$=new o.x}ngOnInit(){return N(this,void 0,void 0,(function*(){this.policyService.policyAppliesToActiveUser$(u.Mi.DisablePersonalVaultExport).pipe((0,a.R)(this.destroy$)).subscribe((e=>{this._disabledByPolicy=e,this.disabledByPolicy&&this.exportForm.disable()})),(0,l.T)(this.exportForm.get("format").valueChanges,this.exportForm.get("fileEncryptionType").valueChanges).pipe((0,a.R)(this.destroy$)).pipe((0,c.O)(0)).subscribe((()=>this.adjustValidators()))}))}ngOnDestroy(){this.destroy$.next()}get encryptedFormat(){return"encrypted_json"===this.format}doExport(){return N(this,void 0,void 0,(function*(){try{this.formPromise=this.getExportData();const e=yield this.formPromise;this.downloadFile(e),this.saved(),yield this.collectEvent(),this.exportForm.get("secret").setValue(""),this.exportForm.clearValidators()}catch(e){this.logService.error(e)}}))}submit(){return N(this,void 0,void 0,(function*(){if(this.disabledByPolicy)return void this.platformUtilsService.showToast("error",null,this.i18nService.t("personalVaultExportPolicyInEffect"));if(!(yield this.warningDialog()))return;const e=this.exportForm.get("secret").value;try{yield this.userVerificationService.verifyUser(e)}catch(t){return void this.platformUtilsService.showToast("error",this.i18nService.t("errorOccurred"),t.message)}this.doExport()}))}warningDialog(){return N(this,void 0,void 0,(function*(){return this.encryptedFormat?yield this.dialogService.openSimpleDialog({title:{key:"confirmVaultExport"},content:this.i18nService.t("encExportKeyWarningDesc")+" "+this.i18nService.t("encExportAccountWarningDesc"),acceptButtonText:{key:"exportVault"},type:"warning"}):yield this.dialogService.openSimpleDialog({title:{key:"confirmVaultExport"},content:{key:"exportWarningDesc"},acceptButtonText:{key:"exportVault"},type:"warning"})}))}saved(){this.onSaved.emit()}getExportData(){return"encrypted_json"===this.format&&this.fileEncryptionType===p.x$.FileEncrypted?this.exportService.getPasswordProtectedExport(this.filePassword):this.exportService.getExport(this.format,null)}getFileName(e){let t=this.format;return"encrypted_json"===this.format&&(e=null==e?"encrypted":"encrypted_"+e,t="json"),this.exportService.getFileName(e,t)}collectEvent(){return N(this,void 0,void 0,(function*(){yield this.eventCollectionService.collect(p.tw.User_ClientExportedVault)}))}get format(){return this.exportForm.get("format").value}get filePassword(){return this.exportForm.get("filePassword").value}get confirmFilePassword(){return this.exportForm.get("confirmFilePassword").value}get fileEncryptionType(){return this.exportForm.get("fileEncryptionType").value}adjustValidators(){this.exportForm.get("confirmFilePassword").reset(),this.exportForm.get("filePassword").reset(),this.encryptedFormat&&this.fileEncryptionType==p.x$.FileEncrypted?(this.exportForm.controls.filePassword.enable(),this.exportForm.controls.confirmFilePassword.enable()):(this.exportForm.controls.filePassword.disable(),this.exportForm.controls.confirmFilePassword.disable())}downloadFile(e){const t=this.getFileName();this.fileDownloadService.download({fileName:t,blobData:e,blobOptions:{type:"text/plain"}})}}_.ɵfac=function(e){return new(e||_)(r.Y36(d.$),r.Y36(m.D),r.Y36(f.P),r.Y36(h.qX),r.Y36(g.j),r.Y36(y.d),r.Y36(Window),r.Y36(v.$),r.Y36(w.i),r.Y36(n.QS),r.Y36(O._),r.Y36(x.x))},_.ɵdir=r.lG2({type:_,outputs:{onSaved:"onSaved"}});var b=s(4519),C=s(19419),U=s(24610),S=s(25376),D=s(53707),k=s(90258),P=s(24637),V=s(11512),A=s(54666),E=s(1e4),I=s(36179),T=s(44358),F=s(21656),L=s(82933),Z=function(e,t,s,i){return new(s||(s=Promise))((function(r,n){function o(e){try{l(i.next(e))}catch(t){n(t)}}function a(e){try{l(i.throw(e))}catch(t){n(t)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,a)}l((i=i.apply(e,t||[])).next())}))};function W(e,t){1&e&&(r.TgZ(0,"app-callout",15),r.ALo(1,"i18n"),r._uU(2),r.ALo(3,"i18n"),r.qZA()),2&e&&(r.s9C("title",r.lcZ(1,2,"vaultExportDisabled")),r.xp6(2),r.hij("\n    ",r.lcZ(3,4,"personalVaultExportPolicyInEffect"),"\n  "))}function B(e,t){if(1&e&&r._UZ(0,"app-export-scope-callout",16),2&e){const e=r.oxw(2);r.Q6J("organizationId",e.organizationId)}}function q(e,t){if(1&e&&(r.TgZ(0,"option",17),r._uU(1),r.qZA()),2&e){const e=t.$implicit;r.Q6J("value",e.value),r.xp6(1),r.Oqu(e.name)}}function R(e,t){if(1&e){const e=r.EpF();r.ynx(0),r._uU(1,"\n          "),r.TgZ(2,"bit-form-field"),r._uU(3,"\n            "),r.TgZ(4,"bit-label"),r._uU(5),r.ALo(6,"i18n"),r.qZA(),r._uU(7,"\n            "),r._UZ(8,"input",28),r._uU(9,"\n            "),r.TgZ(10,"button",29),r.NdJ("toggledChange",(function(t){r.CHM(e);const s=r.oxw(3);return r.KtG(s.showFilePassword=t)})),r.qZA(),r._uU(11,"\n            "),r.TgZ(12,"bit-hint"),r._uU(13),r.ALo(14,"i18n"),r.qZA(),r._uU(15,"\n          "),r.qZA(),r._uU(16,"\n          "),r.TgZ(17,"bit-form-field"),r._uU(18,"\n            "),r.TgZ(19,"bit-label"),r._uU(20),r.ALo(21,"i18n"),r.qZA(),r._uU(22,"\n            "),r._UZ(23,"input",30),r._uU(24,"\n            "),r.TgZ(25,"button",29),r.NdJ("toggledChange",(function(t){r.CHM(e);const s=r.oxw(3);return r.KtG(s.showFilePassword=t)})),r.qZA(),r._uU(26,"\n          "),r.qZA(),r._uU(27,"\n        "),r.BQk()}if(2&e){const e=r.oxw(3);r.xp6(5),r.Oqu(r.lcZ(6,5,"filePassword")),r.xp6(5),r.Q6J("toggled",e.showFilePassword),r.xp6(3),r.Oqu(r.lcZ(14,7,"exportPasswordDescription")),r.xp6(7),r.Oqu(r.lcZ(21,9,"confirmFilePassword")),r.xp6(5),r.Q6J("toggled",e.showFilePassword)}}function Q(e,t){if(1&e&&(r.ynx(0),r._uU(1,"\n        "),r.TgZ(2,"div",18),r._uU(3,"\n          "),r.TgZ(4,"label",19),r._uU(5),r.ALo(6,"i18n"),r.qZA(),r._uU(7,"\n\n          "),r.TgZ(8,"div",20),r._uU(9,"\n            "),r.TgZ(10,"div"),r._uU(11,"\n              "),r._UZ(12,"input",21),r._uU(13,"\n            "),r.qZA(),r._uU(14,"\n            "),r.TgZ(15,"div"),r._uU(16,"\n              "),r.TgZ(17,"label",22),r._uU(18),r.ALo(19,"i18n"),r.qZA(),r._uU(20,"\n            "),r.qZA(),r._uU(21,"\n          "),r.qZA(),r._uU(22,"\n\n          "),r.TgZ(23,"div",23),r._uU(24),r.ALo(25,"i18n"),r.qZA(),r._uU(26,"\n\n          "),r.TgZ(27,"div",24),r._uU(28,"\n            "),r.TgZ(29,"div"),r._uU(30,"\n              "),r._UZ(31,"input",25),r._uU(32,"\n            "),r.qZA(),r._uU(33,"\n            "),r.TgZ(34,"div"),r._uU(35,"\n              "),r.TgZ(36,"label",26),r._uU(37),r.ALo(38,"i18n"),r.qZA(),r._uU(39,"\n            "),r.qZA(),r._uU(40,"\n          "),r.qZA(),r._uU(41,"\n\n          "),r.TgZ(42,"div",27),r._uU(43),r.ALo(44,"i18n"),r.qZA(),r._uU(45,"\n        "),r.qZA(),r._uU(46,"\n        "),r._UZ(47,"br"),r._uU(48,"\n\n        "),r.YNc(49,R,28,11,"ng-container",12),r._uU(50,"\n      "),r.BQk()),2&e){const e=r.oxw(2);r.xp6(5),r.hij("\n            ",r.lcZ(6,10,"exportTypeHeading"),"\n          "),r.xp6(7),r.Q6J("value",e.encryptedExportType.AccountEncrypted)("checked",e.fileEncryptionType===e.encryptedExportType.AccountEncrypted),r.xp6(6),r.hij("\n                ",r.lcZ(19,12,"accountRestricted"),"\n              "),r.xp6(6),r.hij("\n            ",r.lcZ(25,14,"accountRestrictedOptionDescription"),"\n          "),r.xp6(7),r.Q6J("value",e.encryptedExportType.FileEncrypted)("checked",e.fileEncryptionType===e.encryptedExportType.FileEncrypted),r.xp6(6),r.Oqu(r.lcZ(38,16,"passwordProtected")),r.xp6(6),r.hij("\n            ",r.lcZ(44,18,"passwordProtectedOptionDescription"),"\n          "),r.xp6(6),r.Q6J("ngIf",e.fileEncryptionType==e.encryptedExportType.FileEncrypted)}}const Y=function(e){return{manual:e}};function M(e,t){if(1&e){const e=r.EpF();r.TgZ(0,"form",1,2),r.NdJ("ngSubmit",(function(){r.CHM(e);const t=r.oxw();return r.KtG(t.submit())})),r._uU(2,"\n  "),r.TgZ(3,"div",3),r._uU(4,"\n    "),r.TgZ(5,"h1"),r._uU(6),r.ALo(7,"i18n"),r.qZA(),r._uU(8,"\n  "),r.qZA(),r._uU(9,"\n\n  "),r.YNc(10,W,4,6,"app-callout",4),r._uU(11,"\n  "),r.YNc(12,B,1,1,"app-export-scope-callout",5),r._uU(13,"\n\n  "),r.TgZ(14,"div",6),r._uU(15,"\n    "),r.TgZ(16,"div",7),r._uU(17,"\n      "),r.TgZ(18,"bit-form-field"),r._uU(19,"\n        "),r.TgZ(20,"bit-label",8),r._uU(21),r.ALo(22,"i18n"),r.qZA(),r._uU(23,"\n        "),r.TgZ(24,"select",9),r._uU(25,"\n          "),r.YNc(26,q,2,2,"option",10),r._uU(27,"\n        "),r.qZA(),r._uU(28,"\n      "),r.qZA(),r._uU(29,"\n    "),r.qZA(),r._uU(30,"\n  "),r.qZA(),r._uU(31,"\n  "),r.TgZ(32,"div",6),r._uU(33,"\n    "),r.TgZ(34,"div",11),r._uU(35,"\n      "),r.YNc(36,Q,51,20,"ng-container",12),r._uU(37,"\n\n      "),r.TgZ(38,"button",13),r._uU(39,"\n        "),r._UZ(40,"i",14),r.ALo(41,"i18n"),r._uU(42,"\n        "),r.TgZ(43,"span"),r._uU(44),r.ALo(45,"i18n"),r.qZA(),r._uU(46,"\n      "),r.qZA(),r._uU(47,"\n    "),r.qZA(),r._uU(48,"\n  "),r.qZA(),r._uU(49,"\n"),r.qZA()}if(2&e){const e=r.MAs(1),t=r.oxw();r.Q6J("appApiAction",t.formPromise)("formGroup",t.exportForm),r.xp6(6),r.Oqu(r.lcZ(7,12,"exportVault")),r.xp6(4),r.Q6J("ngIf",t.disabledByPolicy),r.xp6(2),r.Q6J("ngIf",!t.disabledByPolicy),r.xp6(9),r.Oqu(r.lcZ(22,14,"fileFormat")),r.xp6(5),r.Q6J("ngForOf",t.formatOptions),r.xp6(10),r.Q6J("ngIf","encrypted_json"===t.format),r.xp6(2),r.Q6J("disabled",e.loading||t.disabledByPolicy)("ngClass",r.VKq(20,Y,t.disabledByPolicy)),r.xp6(2),r.s9C("title",r.lcZ(41,16,"loading")),r.xp6(4),r.Oqu(r.lcZ(45,18,"confirmFormat"))}}class z extends _{constructor(e,t,s,i,r,n,o,a,l,c,u){super(e,t,s,i,r,n,window,o,a,l,c,u),this.encryptedExportType=p.x$}submit(){return Z(this,void 0,void 0,(function*(){if(this.isFileEncryptedExport&&this.filePassword!=this.confirmFilePassword)return void this.platformUtilsService.showToast("error",this.i18nService.t("errorOccurred"),this.i18nService.t("filePasswordAndConfirmFilePasswordDoNotMatch"));if(this.exportForm.markAllAsTouched(),!this.exportForm.valid)return;if(this.disabledByPolicy)return void this.platformUtilsService.showToast("error",null,this.i18nService.t("personalVaultExportPolicyInEffect"));(yield this.verifyUser())&&this.doExport()}))}saved(){super.saved(),this.platformUtilsService.showToast("success",null,this.i18nService.t("exportSuccess"))}verifyUser(){let e="exportWarningDesc";this.isFileEncryptedExport?e="fileEncryptedExportWarningDesc":this.isAccountEncryptedExport&&(e="encExportKeyWarningDesc");const t=(0,b.CV)(this.dialogService,{data:{confirmDescription:e,confirmButtonText:"exportVault",modalTitle:"confirmVaultExport"}});if(null!=t)return(0,i.z)(t.closed)}get isFileEncryptedExport(){return"encrypted_json"===this.format&&this.fileEncryptionType===p.x$.FileEncrypted}get isAccountEncryptedExport(){return"encrypted_json"===this.format&&this.fileEncryptionType===p.x$.AccountEncrypted}}z.ɵfac=function(e){return new(e||z)(r.Y36(d.$),r.Y36(m.D),r.Y36(f.P),r.Y36(h.qX),r.Y36(g.j),r.Y36(y.d),r.Y36(v.$),r.Y36(w.i),r.Y36(n.QS),r.Y36(O._),r.Y36(x.x))},z.ɵcmp=r.Xpm({type:z,selectors:[["app-export"]],features:[r.qOj],decls:4,vars:1,consts:[[3,"appApiAction","formGroup","ngSubmit",4,"ngIf"],[3,"appApiAction","formGroup","ngSubmit"],["form",""],[1,"page-header"],["type","error",3,"title",4,"ngIf"],[3,"organizationId",4,"ngIf"],[1,"row"],[1,"col-6"],["for","format",1,"tw-text-lg"],["bitInput","","name","format","formControlName","format"],[3,"value",4,"ngFor","ngForOf"],[1,"form-group","col-6"],[4,"ngIf"],["type","submit",1,"btn","btn-primary","btn-submit",3,"disabled","ngClass"],["aria-hidden","true",1,"bwi","bwi-spinner","bwi-spin",3,"title"],["type","error",3,"title"],[3,"organizationId"],[3,"value"],["role","radiogroup","aria-labelledby","exportTypeHeading"],["id","exportTypeHeading",1,"tw-semi-bold","tw-text-lg"],["appBoxRow","","name","FileTypeOptions",1,"tw-flex","tw-items-center"],["type","radio","name","fileEncryptionType","id","AccountEncrypted","formControlName","fileEncryptionType",1,"radio",3,"value","checked"],["for","AccountEncrypted",1,"tw-semi-bold","tw-text-md","tw-my-1","tw-ml-1"],[1,"tw-regular","ml-3","pb-2","tw-text-sm"],[1,"tw-flex","tw-items-center"],["type","radio","name","fileEncryptionType","id","FileEncrypted","formControlName","fileEncryptionType",1,"radio",3,"value","checked"],["for","FileEncrypted",1,"tw-semi-bold","tw-text-md","tw-my-1","tw-ml-1"],[1,"tw-regular","ml-3","tw-text-sm"],["bitInput","","type","password","id","filePassword","formControlName","filePassword","name","password"],["type","button","bitSuffix","","bitIconButton","","bitPasswordInputToggle","",3,"toggled","toggledChange"],["bitInput","","type","password","id","confirmFilePassword","formControlName","confirmFilePassword","name","confirmFilePassword"]],template:function(e,t){1&e&&(r._uU(0,"\n"),r._uU(1,"\n"),r.YNc(2,M,50,22,"form",0),r._uU(3,"\n")),2&e&&(r.xp6(2),r.Q6J("ngIf",t.exportForm))},dependencies:[C.mk,C.sg,C.O5,n._Y,n.YN,n.Kr,n.Fj,n.EJ,n._,n.JJ,n.JL,n.sg,n.u,U.b,S.$,D.O,k.N,P.d,V.G,A.w,E.e,I.u,T.M,F.Q,L.C],encapsulation:2})},35025:(e,t,s)=>{s.d(t,{k:()=>wt});var i=s(98645),r=s(48584),n=s(54019),o=s(35406),a=s(33031),l=s(70032),c=s(92786),u=s(68362),p=s(77494),h=s(58691),d=s(28055),m=s(27646),f=s(13968),g=s(65017),y=s(2138),v=s(24852),w=s(19419),O=s(81974),x=s(29465),N=s(18362),_=s(54735),b=s(50941),C=s(26361),U=s(82933);function S(e,t){if(1&e&&(v.TgZ(0,"tr",9),v._uU(1,"\n          "),v.TgZ(2,"td",4),v._uU(3),v.qZA(),v._uU(4,"\n          "),v.TgZ(5,"td",4),v._uU(6),v.qZA(),v._uU(7,"\n        "),v.qZA()),2&e){const e=t.$implicit;v.xp6(3),v.Oqu(e.type),v.xp6(3),v.Oqu(e.message)}}function D(e,t){if(1&e&&(v._uU(0,"\n        "),v.YNc(1,S,8,2,"tr",8),v.ALo(2,"async"),v._uU(3,"\n      ")),2&e){const e=t.$implicit;v.xp6(1),v.Q6J("ngForOf",v.lcZ(2,1,e))}}class k{constructor(e,t){this.dialogRef=e,this.data=t,this.dataSource=new y.G}ngOnInit(){const e=this.data.message.split("\n\n");if(1==e.length)return void(this.dataSource.data=[{type:"",message:this.data.message}]);const t=[];e.forEach((e=>{t.push({type:"",message:e})})),this.dataSource.data=t}}k.ɵfac=function(e){return new(e||k)(v.Y36(g.zj),v.Y36(g.Kt))},k.ɵcmp=v.Xpm({type:k,selectors:[["app-import-error-dialog"]],decls:40,vars:16,consts:[["bitDialogTitle",""],["bitDialogContent",""],[3,"dataSource"],["header",""],["bitCell",""],["body",""],["bitDialogFooter",""],["bitButton","","bitDialogClose","","buttonType","primary","type","button"],["bitRow","",4,"ngFor","ngForOf"],["bitRow",""]],template:function(e,t){1&e&&(v.TgZ(0,"bit-dialog"),v._uU(1,"\n  "),v.TgZ(2,"span",0),v._uU(3),v.ALo(4,"i18n"),v.qZA(),v._uU(5,"\n\n  "),v.TgZ(6,"span",1),v._uU(7,"\n    "),v.TgZ(8,"div"),v._uU(9),v.ALo(10,"i18n"),v.qZA(),v._uU(11,"\n    "),v.TgZ(12,"bit-table",2),v._uU(13,"\n      "),v.ynx(14,3),v._uU(15,"\n        "),v.TgZ(16,"tr"),v._uU(17,"\n          "),v.TgZ(18,"th",4),v._uU(19),v.ALo(20,"i18n"),v.qZA(),v._uU(21,"\n          "),v.TgZ(22,"th",4),v._uU(23),v.ALo(24,"i18n"),v.qZA(),v._uU(25,"\n        "),v.qZA(),v._uU(26,"\n      "),v.BQk(),v._uU(27,"\n      "),v.YNc(28,D,4,3,"ng-template",5),v._uU(29,"\n    "),v.qZA(),v._uU(30,"\n  "),v.qZA(),v._uU(31,"\n\n  "),v.TgZ(32,"div",6),v._uU(33,"\n    "),v.TgZ(34,"button",7),v._uU(35),v.ALo(36,"i18n"),v.qZA(),v._uU(37,"\n  "),v.qZA(),v._uU(38,"\n"),v.qZA(),v._uU(39,"\n")),2&e&&(v.xp6(3),v.hij("\n    ",v.lcZ(4,6,"importError"),"\n  "),v.xp6(6),v.Oqu(v.lcZ(10,8,"resolveTheErrorsBelowAndTryAgain")),v.xp6(3),v.Q6J("dataSource",t.dataSource),v.xp6(7),v.Oqu(v.lcZ(20,10,"name")),v.xp6(4),v.Oqu(v.lcZ(24,12,"description")),v.xp6(12),v.hij("\n      ",v.lcZ(36,14,"ok"),"\n    "))},dependencies:[w.sg,O.r,x.a,N.f,_.a,b.Y,C.v,_.f,w.Ov,U.C],encapsulation:2});var P=s(31182);function V(e,t){if(1&e&&(v.TgZ(0,"tr",9),v._uU(1,"\n          "),v.TgZ(2,"td",4),v._uU(3,"\n            "),v._UZ(4,"i",10),v._uU(5),v.ALo(6,"i18n"),v.qZA(),v._uU(7,"\n          "),v.TgZ(8,"td",4),v._uU(9),v.qZA(),v._uU(10,"\n        "),v.qZA()),2&e){const e=t.$implicit;v.xp6(4),v.Gre("bwi bwi-fw bwi-",e.icon,""),v.xp6(1),v.hij("\n            ",v.lcZ(6,5,e.type),"\n          "),v.xp6(4),v.Oqu(e.count)}}function A(e,t){if(1&e&&(v._uU(0,"\n        "),v.YNc(1,V,11,7,"tr",8),v.ALo(2,"async"),v._uU(3,"\n      ")),2&e){const e=t.$implicit;v.xp6(1),v.Q6J("ngForOf",v.lcZ(2,1,e))}}class E{constructor(e,t){this.dialogRef=e,this.data=t,this.dataSource=new y.G}ngOnInit(){null!=this.data&&(this.dataSource.data=this.buildResultList())}buildResultList(){let e=0,t=0,s=0,i=0;this.data.ciphers.map((r=>{switch(r.type){case P.O.Login:e++;break;case P.O.Card:t++;break;case P.O.SecureNote:i++;break;case P.O.Identity:s++}}));const r=[];return e>0&&r.push({icon:"globe",type:"typeLogin",count:e}),t>0&&r.push({icon:"credit-card",type:"typeCard",count:t}),s>0&&r.push({icon:"id-card",type:"typeIdentity",count:s}),i>0&&r.push({icon:"sticky-note",type:"typeSecureNote",count:i}),this.data.folders.length>0&&r.push({icon:"folder",type:"folders",count:this.data.folders.length}),this.data.collections.length>0&&r.push({icon:"collection",type:"collections",count:this.data.collections.length}),r}}E.ɵfac=function(e){return new(e||E)(v.Y36(g.zj),v.Y36(g.Kt))},E.ɵcmp=v.Xpm({type:E,selectors:[["ng-component"]],decls:40,vars:17,consts:[["bitDialogTitle",""],["bitDialogContent",""],[3,"dataSource"],["header",""],["bitCell",""],["body",""],["bitDialogFooter",""],["bitButton","","bitDialogClose","","buttonType","primary","type","button"],["bitRow","",4,"ngFor","ngForOf"],["bitRow",""],["aria-hidden","true"]],template:function(e,t){1&e&&(v.TgZ(0,"bit-dialog"),v._uU(1,"\n  "),v.TgZ(2,"span",0),v._uU(3),v.ALo(4,"i18n"),v.qZA(),v._uU(5,"\n\n  "),v.TgZ(6,"div",1),v._uU(7,"\n    "),v.TgZ(8,"span"),v._uU(9),v.ALo(10,"i18n"),v.qZA(),v._uU(11,"\n    "),v.TgZ(12,"bit-table",2),v._uU(13,"\n      "),v.ynx(14,3),v._uU(15,"\n        "),v.TgZ(16,"tr"),v._uU(17,"\n          "),v.TgZ(18,"th",4),v._uU(19),v.ALo(20,"i18n"),v.qZA(),v._uU(21,"\n          "),v.TgZ(22,"th",4),v._uU(23),v.ALo(24,"i18n"),v.qZA(),v._uU(25,"\n        "),v.qZA(),v._uU(26,"\n      "),v.BQk(),v._uU(27,"\n      "),v.YNc(28,A,4,3,"ng-template",5),v._uU(29,"\n    "),v.qZA(),v._uU(30,"\n  "),v.qZA(),v._uU(31,"\n\n  "),v.ynx(32,6),v._uU(33,"\n    "),v.TgZ(34,"button",7),v._uU(35),v.ALo(36,"i18n"),v.qZA(),v._uU(37,"\n  "),v.BQk(),v._uU(38,"\n"),v.qZA(),v._uU(39,"\n")),2&e&&(v.xp6(3),v.hij("\n    ",v.lcZ(4,6,"importSuccess"),"\n  "),v.xp6(6),v.Oqu(v.xi3(10,8,"importSuccessNumberOfItems",t.data.ciphers.length)),v.xp6(3),v.Q6J("dataSource",t.dataSource),v.xp6(7),v.Oqu(v.lcZ(20,11,"type")),v.xp6(4),v.Oqu(v.lcZ(24,13,"total")),v.xp6(12),v.hij("\n      ",v.lcZ(36,15,"ok"),"\n    "))},dependencies:[w.sg,O.r,x.a,N.f,_.a,b.Y,C.v,_.f,w.Ov,U.C],encapsulation:2});var I=s(62374),T=s(85356),F=s(24637),L=s(11512),Z=s(54666),W=s(1e4),B=s(36179),q=s(21656);class R{constructor(e){this.dialogRef=e,this.filePassword=new i.NI("",i.kI.required)}submit(){this.filePassword.markAsTouched(),this.filePassword.valid&&this.dialogRef.close(this.filePassword.value)}}R.ɵfac=function(e){return new(e||R)(v.Y36(g.zj))},R.ɵcmp=v.Xpm({type:R,selectors:[["ng-component"]],decls:42,vars:16,consts:[[3,"submit"],["bitDialogTitle",""],["bitDialogContent",""],[1,"tw-mt-6"],["bitInput","","type","password","name","filePassword","appAutofocus","","appInputVerbatim","",3,"formControl"],["type","button","bitSuffix","","bitIconButton","","bitPasswordInputToggle",""],["bitDialogFooter",""],["bitButton","","buttonType","primary","type","submit"],["bitButton","","bitDialogClose","","buttonType","secondary","type","button"]],template:function(e,t){1&e&&(v.TgZ(0,"form",0),v.NdJ("submit",(function(){return t.submit()})),v._uU(1,"\n  "),v.TgZ(2,"bit-dialog"),v._uU(3,"\n    "),v.TgZ(4,"span",1),v._uU(5),v.ALo(6,"i18n"),v.qZA(),v._uU(7,"\n\n    "),v.TgZ(8,"div",2),v._uU(9),v.ALo(10,"i18n"),v.TgZ(11,"bit-form-field",3),v._uU(12,"\n        "),v.TgZ(13,"bit-label"),v._uU(14),v.ALo(15,"i18n"),v.qZA(),v._uU(16,"\n        "),v._UZ(17,"input",4),v._uU(18,"\n        "),v._UZ(19,"button",5),v._uU(20,"\n      "),v.qZA(),v._uU(21,"\n    "),v.qZA(),v._uU(22,"\n\n    "),v.ynx(23,6),v._uU(24,"\n      "),v.TgZ(25,"button",7),v._uU(26,"\n        "),v.TgZ(27,"span"),v._uU(28),v.ALo(29,"i18n"),v.qZA(),v._uU(30,"\n      "),v.qZA(),v._uU(31,"\n      "),v.TgZ(32,"button",8),v._uU(33,"\n        "),v.TgZ(34,"span"),v._uU(35),v.ALo(36,"i18n"),v.qZA(),v._uU(37,"\n      "),v.qZA(),v._uU(38,"\n    "),v.BQk(),v._uU(39,"\n  "),v.qZA(),v._uU(40,"\n"),v.qZA(),v._uU(41,"\n")),2&e&&(v.xp6(5),v.hij("\n      ",v.lcZ(6,6,"confirmVaultImport"),"\n    "),v.xp6(4),v.hij("\n      ",v.lcZ(10,8,"confirmVaultImportDesc"),"\n      "),v.xp6(5),v.Oqu(v.lcZ(15,10,"confirmFilePassword")),v.xp6(3),v.Q6J("formControl",t.filePassword),v.xp6(11),v.Oqu(v.lcZ(29,12,"importData")),v.xp6(7),v.Oqu(v.lcZ(36,14,"cancel")))},dependencies:[i._Y,i.Fj,i.JJ,i.JL,i.F,i.oH,I.U,T.b,O.r,x.a,N.f,F.d,L.G,Z.w,W.e,B.u,q.Q,U.C],encapsulation:2});var Q=s(78627),Y=s(75557),M=s(99721),z=s(83924),J=s(66459),j=s(4871),K=s(73369),G=s(23031),$=s(31754),H=s(33245),X=s(46246),ee=s(36338),te=s(24083),se=s(44358),ie=s(28975),re=s(30469),ne=s(28315),oe=function(e,t,s,i){return new(s||(s=Promise))((function(r,n){function o(e){try{l(i.next(e))}catch(t){n(t)}}function a(e){try{l(i.throw(e))}catch(t){n(t)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,a)}l((i=i.apply(e,t||[])).next())}))};function ae(e,t){1&e&&(v.TgZ(0,"bit-callout",20),v._uU(1),v.ALo(2,"i18n"),v.qZA()),2&e&&(v.xp6(1),v.hij("\n  ",v.lcZ(2,1,"personalOwnershipPolicyInEffectImports"),"\n"))}function le(e,t){1&e&&(v._UZ(0,"bit-option",21),v.ALo(1,"i18n")),2&e&&v.Q6J("label",v.lcZ(1,1,"myVault"))}function ce(e,t){if(1&e&&v._UZ(0,"bit-option",22),2&e){const e=t.$implicit;v.Q6J("value",e.id)("label",e.name)}}function ue(e,t){if(1&e&&v._UZ(0,"bit-option",25),2&e){const e=t.$implicit;v.Q6J("value",e.id)("label",e.name)}}function pe(e,t){if(1&e&&(v.ynx(0),v._uU(1,"\n        "),v._UZ(2,"bit-option",23),v.ALo(3,"i18n"),v._uU(4,"\n        "),v.YNc(5,ue,1,2,"bit-option",24),v.ALo(6,"async"),v._uU(7,"\n      "),v.BQk()),2&e){const e=v.oxw();v.xp6(2),v.MGl("label","-- ",v.lcZ(3,3,"selectImportFolder")," --"),v.Q6J("value",null),v.xp6(3),v.Q6J("ngForOf",v.lcZ(6,5,e.folders$))}}function he(e,t){if(1&e&&v._UZ(0,"bit-option",27),2&e){const e=t.$implicit;v.Q6J("value",e.id)("label",e.name)}}function de(e,t){if(1&e&&(v.ynx(0),v._uU(1,"\n        "),v._UZ(2,"bit-option",23),v.ALo(3,"i18n"),v._uU(4,"\n        "),v.YNc(5,he,1,2,"bit-option",26),v.ALo(6,"async"),v._uU(7,"\n      "),v.BQk()),2&e){const e=v.oxw();v.xp6(2),v.MGl("label","-- ",v.lcZ(3,3,"selectImportCollection")," --"),v.Q6J("value",null),v.xp6(3),v.Q6J("ngForOf",v.lcZ(6,5,e.collections$))}}function me(e,t){if(1&e&&v._UZ(0,"bit-option",23),2&e){const e=t.$implicit;v.Q6J("value",e.id)("label",e.name)}}function fe(e,t){if(1&e&&v._UZ(0,"bit-option",23),2&e){const e=t.$implicit;v.Q6J("value",e.id)("label",e.name)}}function ge(e,t){if(1&e&&(v.ynx(0),v._uU(1,"\n        "),v._UZ(2,"bit-option",28),v._uU(3,"\n        "),v.YNc(4,fe,1,2,"bit-option",12),v._uU(5,"\n      "),v.BQk()),2&e){const e=v.oxw();v.xp6(4),v.Q6J("ngForOf",e.importOptions)}}function ye(e,t){1&e&&(v.ynx(0),v._uU(1,"\n      See detailed instructions on our help site at\n      "),v.TgZ(2,"a",30),v._uU(3,"\n        https://bitwarden.com/help/export-your-data/"),v.qZA(),v._uU(4,"\n    "),v.BQk())}function ve(e,t){1&e&&(v.ynx(0),v._uU(1,"\n      See detailed instructions on our help site at\n      "),v.TgZ(2,"a",31),v._uU(3,"\n        https://bitwarden.com/help/import-from-lastpass/"),v.qZA(),v._uU(4,"\n    "),v.BQk())}function we(e,t){1&e&&(v.ynx(0),v._uU(1,'\n      Using the KeePassX desktop application, navigate to "Database" → "Export to CSV file" and\n      save the CSV file.\n    '),v.BQk())}function Oe(e,t){1&e&&(v.ynx(0),v._uU(1,'\n      In the Avira web vault, go to "Settings" → "My Data" → "Export data" and save the\n      CSV file.\n    '),v.BQk())}function xe(e,t){1&e&&(v.ynx(0),v._uU(1,'\n      In the Blur web vault, click your username at the top and go to "Settings" → "Export\n      Data", then click "Export CSV" for your "Accounts".\n    '),v.BQk())}function Ne(e,t){1&e&&(v.ynx(0),v._uU(1,'\n      Using the SaveInCloud desktop application, navigate to "File" → "Export" → "As XML"\n      and save the XML file.\n    '),v.BQk())}function _e(e,t){1&e&&(v.ynx(0),v._uU(1,'\n      Using the Padlock desktop application, click the hamburger icon in the top left corner and\n      navigate to "Settings" → "Export" button and save the file "As CSV".\n    '),v.BQk())}function be(e,t){1&e&&(v.ynx(0),v._uU(1,'\n      Using the KeePass 2 desktop application, navigate to "File" → "Export" and select the\n      "KeePass XML (2.x)" option.\n    '),v.BQk())}function Ce(e,t){1&e&&(v.ynx(0),v._uU(1,'\n      Using the Universal Password Manager desktop application, navigate to "Database" →\n      "Export" and save the CSV file.\n    '),v.BQk())}function Ue(e,t){1&e&&(v.ynx(0),v._uU(1,'\n      Using the SaferPass browser extension, click the hamburger icon in the top left corner and\n      navigate to "Settings". Click the "Export accounts" button to save the CSV file.\n    '),v.BQk())}function Se(e,t){1&e&&(v.ynx(0),v._uU(1,'\n      Using the Meldium web vault, navigate to "Settings". Locate the "Export data" function and\n      click "Show me my data" to save the CSV file.\n    '),v.BQk())}function De(e,t){1&e&&(v.ynx(0),v._uU(1,'\n      Log into the Keeper web vault (keepersecurity.com/vault). Click on your "account email" (top\n      right) and select "Settings". Go to "Export" and find the "Export to .csv File" option. Click\n      "Export" to save the CSV file.\n    '),v.BQk())}function ke(e,t){1&e&&(v.TgZ(0,"span"),v._uU(1,"\n        The process is exactly the same as importing from Google Chrome.\n      "),v.qZA())}function Pe(e,t){if(1&e&&(v.ynx(0),v._uU(1,"\n      "),v.YNc(2,ke,2,0,"span",9),v._uU(3,"\n      See detailed instructions on our help site at\n      "),v.TgZ(4,"a",32),v._uU(5,"\n        https://bitwarden.com/help/import-from-chrome/"),v.qZA(),v._uU(6,"\n    "),v.BQk()),2&e){const e=v.oxw(2);v.xp6(2),v.Q6J("ngIf","chromecsv"!==e.format)}}function Ve(e,t){1&e&&(v.ynx(0),v._uU(1,"\n      See detailed instructions on our help site at\n      "),v.TgZ(2,"a",33),v._uU(3,"\n        https://bitwarden.com/help/import-from-firefox/"),v.qZA(),v._uU(4,".\n    "),v.BQk())}function Ae(e,t){1&e&&(v.ynx(0),v._uU(1,"\n      See detailed instructions on our help site at\n      "),v.TgZ(2,"a",34),v._uU(3,"\n        https://bitwarden.com/help/import-from-safari/"),v.qZA(),v._uU(4,".\n    "),v.BQk())}function Ee(e,t){1&e&&(v.ynx(0),v._uU(1,"\n      See detailed instructions on our help site at\n      "),v.TgZ(2,"a",35),v._uU(3,"\n        https://bitwarden.com/help/import-from-1password/"),v.qZA(),v._uU(4,".\n    "),v.BQk())}function Ie(e,t){1&e&&(v.ynx(0),v._uU(1,'\n      Using the Password Dragon desktop application, navigate to "File" → "Export" → "To\n      XML". In the dialog that pops up select "All Rows" and check all fields. Click the "Export"\n      button and save the XML file.\n    '),v.BQk())}function Te(e,t){1&e&&(v.ynx(0),v._uU(1,'\n      Using the Enpass desktop application, navigate to "File" → "Export" → "As CSV".\n      Select "OK" to the warning alert and save the CSV file. Note that the importer only supports\n      files exported while Enpass is set to the English language, so adjust your settings\n      accordingly.\n    '),v.BQk())}function Fe(e,t){1&e&&(v.ynx(0),v._uU(1,'\n      Using the Enpass 6 desktop application, click the menu button and navigate to "File" →\n      "Export". Select the ".json" file format option and save the JSON file.\n    '),v.BQk())}function Le(e,t){1&e&&(v.ynx(0),v._uU(1,'\n      Using the Password Safe desktop application, navigate to "File" → "Export To" → "XML\n      format..." and save the XML file.\n    '),v.BQk())}function Ze(e,t){1&e&&(v.ynx(0),v._uU(1,'\n      Log in to Dashlane, click on "My Account" → "Settings" → "Export file" and select\n      "Export as a CSV file". This will download a zip archive containing various CSV files. Unzip\n      the archive and import each CSV file individually.\n    '),v.BQk())}function We(e,t){1&e&&(v.ynx(0),v._uU(1,"\n      Dashlane no longer supports the JSON format. Only use this if you have an existing JSON for\n      import. Use the CSV importer when creating new exports.\n    "),v.BQk())}function Be(e,t){1&e&&(v.ynx(0),v._uU(1,'\n      Using the mSecure desktop application, navigate to "File" → "Export" → "CSV File..."\n      and save the CSV file.\n    '),v.BQk())}function qe(e,t){1&e&&(v.ynx(0),v._uU(1,'\n      Using the Sticky Password desktop application, navigate to "Menu" (top right) → "Export"\n      → "Export all". Select the unencrypted format XML option and save the XML file.\n    '),v.BQk())}function Re(e,t){1&e&&(v.ynx(0),v._uU(1,'\n      Using the True Key desktop application, click the gear icon (top right) and then navigate to\n      "App Settings". Click the "Export" button, enter your password and save the CSV file.\n    '),v.BQk())}function Qe(e,t){1&e&&(v.ynx(0),v._uU(1,'\n      Log into the Clipperz web application (clipperz.is/app). Click the hamburger menu icon in the\n      top right to expand the navigation bar. Navigate to "Data" → "Export". Click the\n      "download HTML+JSON" button to save the HTML file.\n    '),v.BQk())}function Ye(e,t){1&e&&(v.ynx(0),v._uU(1,'\n      Using the RoboForm Editor desktop application, navigate to "RoboForm" (top left) →\n      "Options" → "Account & Data" and click the "Export" button. Select all of your data,\n      change the "Format" to "CSV file" and then click the "Export" button to save the CSV file.\n      Note: RoboForm only allows you to export Logins. Other items will not be exported.\n    '),v.BQk())}function Me(e,t){1&e&&(v.ynx(0),v._uU(1,'\n      Log into the Passbolt web vault and navigate to the "Passwords" listing. Select all of the\n      passwords you would like to export and click the "Export" button at the top of the listing.\n      Choose the "csv (lastpass)" export format and click the "Export" button.\n    '),v.BQk())}function ze(e,t){1&e&&(v.ynx(0),v._uU(1,'\n      Using the Ascendo DataVault desktop application, navigate to "Tools" → "Export". In the\n      dialog that pops up, select the "All Items (DVX, CSV)" option. Click the "Ok" button to save\n      the CSV file.\n    '),v.BQk())}function Je(e,t){1&e&&(v.ynx(0),v._uU(1,'\n      Using the Password Boss desktop application, navigate to "File" → "Export data" →\n      "Password Boss JSON - not encrypted" and save the JSON file.\n    '),v.BQk())}function je(e,t){1&e&&(v.ynx(0),v._uU(1,'\n      Log into the Zoho web vault (vault.zoho.com). Navigate to "Tools" → "Export Secrets".\n      Select "All Secrets" and click the "Zoho Vault Format CSV" button. Highlight and copy the data\n      from the textarea. Open a text editor like Notepad and paste the data. Save the data from the\n      text editor as\n      '),v.TgZ(2,"code"),v._uU(3,"zoho_export.csv"),v.qZA(),v._uU(4,".\n    "),v.BQk())}function Ke(e,t){1&e&&(v.ynx(0),v._uU(1,'\n      Using the SplashID Safe desktop application, click on the SplashID blue lock logo in the top\n      right corner. Navigate to "Export" → "Export as CSV" and save the CSV file.\n    '),v.BQk())}function Ge(e,t){1&e&&(v.ynx(0),v._uU(1,'\n      Using the PassKeep mobile app, navigate to "Backup/Restore". Locate the "CSV Backup/Restore"\n      section and click "Backup to CSV" to save the CSV file.\n    '),v.BQk())}function $e(e,t){1&e&&(v.ynx(0),v._uU(1,"\n      Make sure you have python-keyring and python-gnomekeyring installed. Save the\n      "),v.TgZ(2,"a",36),v._uU(3,"GNOME Keyring Import/Export"),v.qZA(),v._uU(4,"\n      python script to your desktop as "),v.TgZ(5,"code"),v._uU(6,"pw_helper.py"),v.qZA(),v._uU(7,". Open terminal and run\n      "),v.TgZ(8,"code"),v._uU(9,"chmod +rx Desktop/pw_helper.py"),v.qZA(),v._uU(10," and then\n      "),v.TgZ(11,"code"),v._uU(12,"python Desktop/pw_helper.py export Desktop/my_passwords.json"),v.qZA(),v._uU(13,". Then upload the\n      resulting "),v.TgZ(14,"code"),v._uU(15,"my_passwords.json"),v.qZA(),v._uU(16," file here to Bitwarden.\n    "),v.BQk())}function He(e,t){1&e&&(v.ynx(0),v._uU(1,'\n      Using the Password Agent desktop application navigate to "File" → "Export", select the\n      "Fields to export" button and check all of the fields, change the "Output format" to "CSV",\n      and then click the "Start" button to save the CSV file.\n    '),v.BQk())}function Xe(e,t){1&e&&(v.ynx(0),v._uU(1,'\n      Log into the Passpack website vault and navigate to "Settings" → "Export", then click the\n      "Download" button to save the CSV file.\n    '),v.BQk())}function et(e,t){1&e&&(v.ynx(0),v._uU(1,'\n      Open your Passman vault and click on "Settings" in the bottom left corner. In the "Settings"\n      window switch to the "Export credentials" tab and choose "JSON" as the export type. Enter your\n      vault\'s passphrase and click the "Export" button to save the JSON file.\n    '),v.BQk())}function tt(e,t){1&e&&(v.ynx(0),v._uU(1,'\n      Open the Avast Passwords desktop application and navigate to "Settings" → "Import/export\n      data". Select the "Export" button for the "Export to CSV file" option to save the CSV file.\n    '),v.BQk())}function st(e,t){1&e&&(v.ynx(0),v._uU(1,'\n      Open the Avast Passwords desktop application and navigate to "Settings" → "Import/export\n      data". Select the "Export" button for the "Export to JSON file" option to save the JSON file.\n    '),v.BQk())}function it(e,t){1&e&&(v.ynx(0),v._uU(1,'\n      Open the F-Secure KEY desktop application and navigate to "Settings" → "Export\n      Passwords". Select the "Export" button, enter your master password, and save the FSK file.\n    '),v.BQk())}function rt(e,t){1&e&&(v.ynx(0),v._uU(1,'\n      Open the Kaspersky Password Manager desktop application and navigate to "Settings" →\n      "Import/Export". Locate the "Export to text file" section and select the "Export" button to\n      save the TXT file.\n    '),v.BQk())}function nt(e,t){1&e&&(v.ynx(0),v._uU(1,'\n      Open the RememBear desktop application and navigate to "Settings" → "Account" →\n      "Export". Enter your master password and select the "Export Anyway" button to save the CSV\n      file.\n    '),v.BQk())}function ot(e,t){1&e&&(v.ynx(0),v._uU(1,'\n      Open the PasswordWallet desktop application and navigate to "File" → "Export" →\n      "Visible entries to text file". Enter your password and select the "Ok" button to save the TXT\n      file.\n    '),v.BQk())}function at(e,t){1&e&&(v.ynx(0),v._uU(1,'\n      Open the Myki desktop browser extension and navigate to "Advanced" → "Export Accounts"\n      and then scan the QR code with your mobile device. Various CSV files will then be saved to\n      your computer\'s downloads folder.\n    '),v.BQk())}function lt(e,t){1&e&&(v.ynx(0),v._uU(1,"\n      Export your SecureSafe password safe to a CSV file with a comma delimiter.\n    "),v.BQk())}function ct(e,t){1&e&&(v.ynx(0),v._uU(1,'\n      Open the LogMeOnce browser extension, then navigate to "Open Menu" → "Export To" and\n      select "CSV File" to save the CSV file.\n    '),v.BQk())}function ut(e,t){1&e&&(v.ynx(0),v._uU(1,'\n      Open the BlackBerry Password Keeper application, then navigate to "Settings" →\n      "Import/Export". Select "Export Passwords" and follow the instructions on screen to save the\n      unencrypted CSV file.\n    '),v.BQk())}function pt(e,t){1&e&&(v.ynx(0),v._uU(1,'\n      Open the Buttercup desktop application and unlock your vault. Right click on your vault\'s icon\n      and select "Export" to save the CSV file.\n    '),v.BQk())}function ht(e,t){1&e&&(v.ynx(0),v._uU(1,'\n      Open the Codebook desktop application and log in. Navigate to "File" → "Export all", then\n      click "Yes" on the dialog and save the CSV file.\n    '),v.BQk())}function dt(e,t){1&e&&(v.ynx(0),v._uU(1,"\n      Open the newest version of the Encryptr desktop application and allow all of your data to\n      sync. Once syncing of your data is complete, the download icon in the top right corner will\n      turn pink. Click the download icon and save the CSV file.\n    "),v.BQk())}function mt(e,t){1&e&&(v.ynx(0),v._uU(1,'\n      From the Yoti browser extension, click on "Settings", then "Export Saved Logins" and save the\n      CSV file.\n    '),v.BQk())}function ft(e,t){1&e&&(v.ynx(0),v._uU(1,'\n      Log in to the Psono web vault, click on the "Signed in as"-dropdown, select "Others". Go to\n      the "Export"-tab and select the json type export and then click on Export.\n    '),v.BQk())}function gt(e,t){1&e&&(v.ynx(0),v._uU(1,'\n      Log in to "https://vault.passky.org" → "Import & Export" → "Export" in the Passky\n      section. ("Backup" is unsupported as it is encrypted).\n    '),v.BQk())}function yt(e,t){1&e&&(v.ynx(0),v._uU(1,"\n      In the ProtonPass browser extension, go to Settings > Export. Export without PGP encryption\n      and save the zip file.\n    "),v.BQk())}function vt(e,t){if(1&e&&(v.TgZ(0,"bit-callout",29),v._uU(1,"\n    "),v.YNc(2,ye,5,0,"ng-container",9),v._uU(3,"\n    "),v.YNc(4,ve,5,0,"ng-container",9),v._uU(5,"\n    "),v.YNc(6,we,2,0,"ng-container",9),v._uU(7,"\n    "),v.YNc(8,Oe,2,0,"ng-container",9),v._uU(9,"\n    "),v.YNc(10,xe,2,0,"ng-container",9),v._uU(11,"\n    "),v.YNc(12,Ne,2,0,"ng-container",9),v._uU(13,"\n    "),v.YNc(14,_e,2,0,"ng-container",9),v._uU(15,"\n    "),v.YNc(16,be,2,0,"ng-container",9),v._uU(17,"\n    "),v.YNc(18,Ce,2,0,"ng-container",9),v._uU(19,"\n    "),v.YNc(20,Ue,2,0,"ng-container",9),v._uU(21,"\n    "),v.YNc(22,Se,2,0,"ng-container",9),v._uU(23,"\n    "),v.YNc(24,De,2,0,"ng-container",9),v._uU(25,"\n    "),v._uU(26,"\n    "),v.YNc(27,Pe,7,1,"ng-container",9),v._uU(28,"\n    "),v.YNc(29,Ve,5,0,"ng-container",9),v._uU(30,"\n    "),v.YNc(31,Ae,5,0,"ng-container",9),v._uU(32,"\n    "),v.YNc(33,Ee,5,0,"ng-container",9),v._uU(34,"\n    "),v.YNc(35,Ie,2,0,"ng-container",9),v._uU(36,"\n    "),v.YNc(37,Te,2,0,"ng-container",9),v._uU(38,"\n    "),v.YNc(39,Fe,2,0,"ng-container",9),v._uU(40,"\n    "),v.YNc(41,Le,2,0,"ng-container",9),v._uU(42,"\n    "),v.YNc(43,Ze,2,0,"ng-container",9),v._uU(44,"\n    "),v.YNc(45,We,2,0,"ng-container",9),v._uU(46,"\n    "),v.YNc(47,Be,2,0,"ng-container",9),v._uU(48,"\n    "),v.YNc(49,qe,2,0,"ng-container",9),v._uU(50,"\n    "),v.YNc(51,Re,2,0,"ng-container",9),v._uU(52,"\n    "),v.YNc(53,Qe,2,0,"ng-container",9),v._uU(54,"\n    "),v.YNc(55,Ye,2,0,"ng-container",9),v._uU(56,"\n    "),v.YNc(57,Me,2,0,"ng-container",9),v._uU(58,"\n    "),v.YNc(59,ze,2,0,"ng-container",9),v._uU(60,"\n    "),v.YNc(61,Je,2,0,"ng-container",9),v._uU(62,"\n    "),v.YNc(63,je,5,0,"ng-container",9),v._uU(64,"\n    "),v.YNc(65,Ke,2,0,"ng-container",9),v._uU(66,"\n    "),v.YNc(67,Ge,2,0,"ng-container",9),v._uU(68,"\n    "),v.YNc(69,$e,17,0,"ng-container",9),v._uU(70,"\n    "),v.YNc(71,He,2,0,"ng-container",9),v._uU(72,"\n    "),v.YNc(73,Xe,2,0,"ng-container",9),v._uU(74,"\n    "),v.YNc(75,et,2,0,"ng-container",9),v._uU(76,"\n    "),v.YNc(77,tt,2,0,"ng-container",9),v._uU(78,"\n    "),v.YNc(79,st,2,0,"ng-container",9),v._uU(80,"\n    "),v.YNc(81,it,2,0,"ng-container",9),v._uU(82,"\n    "),v.YNc(83,rt,2,0,"ng-container",9),v._uU(84,"\n    "),v.YNc(85,nt,2,0,"ng-container",9),v._uU(86,"\n    "),v.YNc(87,ot,2,0,"ng-container",9),v._uU(88,"\n    "),v.YNc(89,at,2,0,"ng-container",9),v._uU(90,"\n    "),v.YNc(91,lt,2,0,"ng-container",9),v._uU(92,"\n    "),v.YNc(93,ct,2,0,"ng-container",9),v._uU(94,"\n    "),v.YNc(95,ut,2,0,"ng-container",9),v._uU(96,"\n    "),v.YNc(97,pt,2,0,"ng-container",9),v._uU(98,"\n    "),v.YNc(99,ht,2,0,"ng-container",9),v._uU(100,"\n    "),v.YNc(101,dt,2,0,"ng-container",9),v._uU(102,"\n    "),v.YNc(103,mt,2,0,"ng-container",9),v._uU(104,"\n    "),v.YNc(105,ft,2,0,"ng-container",9),v._uU(106,"\n    "),v.YNc(107,gt,2,0,"ng-container",9),v._uU(108,"\n    "),v.YNc(109,yt,2,0,"ng-container",9),v._uU(110,"\n  "),v.qZA()),2&e){const e=v.oxw();v.s9C("title",e.getFormatInstructionTitle()),v.xp6(2),v.Q6J("ngIf","bitwardencsv"===e.format||"bitwardenjson"===e.format),v.xp6(2),v.Q6J("ngIf","lastpasscsv"===e.format),v.xp6(2),v.Q6J("ngIf","keepassxcsv"===e.format),v.xp6(2),v.Q6J("ngIf","aviracsv"===e.format),v.xp6(2),v.Q6J("ngIf","blurcsv"===e.format),v.xp6(2),v.Q6J("ngIf","safeincloudxml"===e.format),v.xp6(2),v.Q6J("ngIf","padlockcsv"===e.format),v.xp6(2),v.Q6J("ngIf","keepass2xml"===e.format),v.xp6(2),v.Q6J("ngIf","upmcsv"===e.format),v.xp6(2),v.Q6J("ngIf","saferpasscsv"===e.format),v.xp6(2),v.Q6J("ngIf","meldiumcsv"===e.format),v.xp6(2),v.Q6J("ngIf","keepercsv"===e.format),v.xp6(3),v.Q6J("ngIf","chromecsv"===e.format||"operacsv"===e.format||"vivaldicsv"===e.format),v.xp6(2),v.Q6J("ngIf","firefoxcsv"===e.format),v.xp6(2),v.Q6J("ngIf","safaricsv"===e.format),v.xp6(2),v.Q6J("ngIf","1password1pux"===e.format||"1password1pif"===e.format||"1passwordwincsv"===e.format||"1passwordmaccsv"===e.format),v.xp6(2),v.Q6J("ngIf","passworddragonxml"===e.format),v.xp6(2),v.Q6J("ngIf","enpasscsv"===e.format),v.xp6(2),v.Q6J("ngIf","enpassjson"===e.format),v.xp6(2),v.Q6J("ngIf","pwsafexml"===e.format),v.xp6(2),v.Q6J("ngIf","dashlanecsv"===e.format),v.xp6(2),v.Q6J("ngIf","dashlanejson"===e.format),v.xp6(2),v.Q6J("ngIf","msecurecsv"===e.format),v.xp6(2),v.Q6J("ngIf","stickypasswordxml"===e.format),v.xp6(2),v.Q6J("ngIf","truekeycsv"===e.format),v.xp6(2),v.Q6J("ngIf","clipperzhtml"===e.format),v.xp6(2),v.Q6J("ngIf","roboformcsv"===e.format),v.xp6(2),v.Q6J("ngIf","passboltcsv"===e.format),v.xp6(2),v.Q6J("ngIf","ascendocsv"===e.format),v.xp6(2),v.Q6J("ngIf","passwordbossjson"===e.format),v.xp6(2),v.Q6J("ngIf","zohovaultcsv"===e.format),v.xp6(2),v.Q6J("ngIf","splashidcsv"===e.format),v.xp6(2),v.Q6J("ngIf","passkeepcsv"===e.format),v.xp6(2),v.Q6J("ngIf","gnomejson"===e.format),v.xp6(2),v.Q6J("ngIf","passwordagentcsv"===e.format),v.xp6(2),v.Q6J("ngIf","passpackcsv"===e.format),v.xp6(2),v.Q6J("ngIf","passmanjson"===e.format),v.xp6(2),v.Q6J("ngIf","avastcsv"===e.format),v.xp6(2),v.Q6J("ngIf","avastjson"===e.format),v.xp6(2),v.Q6J("ngIf","fsecurefsk"===e.format),v.xp6(2),v.Q6J("ngIf","kasperskytxt"===e.format),v.xp6(2),v.Q6J("ngIf","remembearcsv"===e.format),v.xp6(2),v.Q6J("ngIf","passwordwallettxt"===e.format),v.xp6(2),v.Q6J("ngIf","mykicsv"===e.format),v.xp6(2),v.Q6J("ngIf","securesafecsv"===e.format),v.xp6(2),v.Q6J("ngIf","logmeoncecsv"===e.format),v.xp6(2),v.Q6J("ngIf","blackberrycsv"===e.format),v.xp6(2),v.Q6J("ngIf","buttercupcsv"===e.format),v.xp6(2),v.Q6J("ngIf","codebookcsv"===e.format),v.xp6(2),v.Q6J("ngIf","encryptrcsv"===e.format),v.xp6(2),v.Q6J("ngIf","yoticsv"===e.format),v.xp6(2),v.Q6J("ngIf","psonojson"===e.format),v.xp6(2),v.Q6J("ngIf","passkyjson"===e.format),v.xp6(2),v.Q6J("ngIf","protonpass"===e.format)}}class wt{constructor(e,t,s,r,o,a,l,c,u,p,h,d,m){this.i18nService=e,this.importService=t,this.router=s,this.platformUtilsService=r,this.policyService=o,this.logService=a,this.modalService=l,this.syncService=c,this.dialogService=u,this.folderService=p,this.collectionService=h,this.organizationService=d,this.formBuilder=m,this.format=null,this.organizationId=null,this.destroy$=new n.x,this._importBlockedByPolicy=!1,this.formGroup=this.formBuilder.group({vaultSelector:["myVault",{nonNullable:!0,validators:[i.kI.required]}],targetSelector:[null],format:[null,[i.kI.required]],fileContents:[],file:[]}),this.submit=()=>oe(this,void 0,void 0,(function*(){this.formGroup.invalid?this.formGroup.markAllAsTouched():yield this.performImport()}))}get importBlockedByPolicy(){return this._importBlockedByPolicy}onSuccessfulImport(){return oe(this,void 0,void 0,(function*(){yield this.router.navigate(["vault"])}))}ngOnInit(){this.setImportOptions(),this.organizations$=(0,o.z)(this.organizationService.memberOrganizations$.pipe((0,h.EC)(this.i18nService),(0,c.U)((e=>e.sort(m.c.getSortFunction(this.i18nService,"name")))))),(0,a.a)([this.policyService.policyAppliesToActiveUser$(d.Mi.PersonalOwnership),this.organizations$]).pipe((0,u.R)(this.destroy$)).subscribe((([e,t])=>{this._importBlockedByPolicy=e,e&&0==t.length&&this.formGroup.disable()})),this.organizationId?(this.formGroup.controls.vaultSelector.patchValue(this.organizationId),this.formGroup.controls.vaultSelector.disable(),this.collections$=m.c.asyncToObservable((()=>this.collectionService.getAllDecrypted().then((e=>e.filter((e=>e.organizationId===this.organizationId))))))):(this.folders$=this.folderService.folderViews$.pipe((0,c.U)((e=>e.filter((e=>null!=e.id))))),this.formGroup.controls.targetSelector.disable(),this.formGroup.controls.vaultSelector.valueChanges.pipe((0,u.R)(this.destroy$)).subscribe((e=>{this.organizationId="myVault"!=e?e:void 0,this._importBlockedByPolicy||this.formGroup.controls.targetSelector.enable(),e&&(this.collections$=m.c.asyncToObservable((()=>this.collectionService.getAllDecrypted().then((t=>t.filter((t=>t.organizationId===e)))))))})),this.formGroup.controls.vaultSelector.setValue("myVault")),this.formGroup.controls.format.valueChanges.pipe((0,u.R)(this.destroy$)).subscribe((e=>{this.format=e}))}performImport(){var e;return oe(this,void 0,void 0,(function*(){if(this.importBlockedByPolicy)return void this.platformUtilsService.showToast("error",null,this.i18nService.t("personalOwnershipPolicyInEffectImports"));const t=this.importService.getImporter(this.format,(()=>oe(this,void 0,void 0,(function*(){return yield this.getFilePassword()}))),this.organizationId);if(null===t)return void this.platformUtilsService.showToast("error",this.i18nService.t("errorOccurred"),this.i18nService.t("selectFormat"));const s=document.getElementById("file").files;let i=this.formGroup.controls.fileContents.value;if(null!=s&&0!==s.length||null!=i&&""!==i){if(null!=s&&s.length>0)try{const e=yield this.getFileContents(s[0]);null!=e&&(i=e)}catch(r){this.logService.error(r)}if(null!=i&&""!==i){this.organizationId&&(yield null===(e=this.organizationService.get(this.organizationId))||void 0===e?void 0:e.isAdmin);try{const e=yield this.importService.import(t,i,this.organizationId,this.formGroup.controls.targetSelector.value,this.isUserAdmin(this.organizationId));this.dialogService.open(E,{data:e}),this.syncService.fullSync(!0),yield this.onSuccessfulImport()}catch(r){this.dialogService.open(k,{data:r}),this.logService.error(r)}}else this.platformUtilsService.showToast("error",this.i18nService.t("errorOccurred"),this.i18nService.t("selectFile"))}else this.platformUtilsService.showToast("error",this.i18nService.t("errorOccurred"),this.i18nService.t("selectFile"))}))}isUserAdmin(e){var t;return!!e&&(null===(t=this.organizationService.get(this.organizationId))||void 0===t?void 0:t.isAdmin)}getFormatInstructionTitle(){if(null==this.format)return null;const e=this.featuredImportOptions.concat(this.importOptions).filter((e=>e.id===this.format));return e.length>0?this.i18nService.t("instructionsFor",e[0].name):null}setImportOptions(){this.featuredImportOptions=[{id:null,name:"-- "+this.i18nService.t("select")+" --"},...this.importService.featuredImportOptions],this.importOptions=[...this.importService.regularImportOptions].sort(((e,t)=>null==e.name&&null!=t.name?-1:null!=e.name&&null==t.name?1:null==e.name&&null==t.name?0:this.i18nService.collator?this.i18nService.collator.compare(e.name,t.name):e.name.localeCompare(t.name)))}setSelectedFile(e){const t=e.target;this.fileSelected=t.files.length>0?t.files[0]:null}getFileContents(e){return"1password1pux"===this.format&&e.name.endsWith(".1pux")?this.extractZipContent(e,"export.data"):"protonpass"!==this.format||"application/zip"!==e.type&&"application/x-zip-compressed"!=e.type&&!e.name.endsWith(".zip")?new Promise(((t,s)=>{const i=new FileReader;i.readAsText(e,"utf-8"),i.onload=i=>{if("lastpasscsv"===this.format&&"text/html"===e.type){const e=(new DOMParser).parseFromString(i.target.result,"text/html").querySelector("pre");return null!=e?void t(e.textContent):void s()}t(i.target.result)},i.onerror=()=>{s()}})):this.extractZipContent(e,"Proton Pass/data.json")}extractZipContent(e,t){return(new r).loadAsync(e).then((e=>e.file(t).async("string"))).then((function(e){return e}),(function(e){return""}))}getFilePassword(){return oe(this,void 0,void 0,(function*(){const e=this.dialogService.open(R,{ariaModal:!0});return yield(0,l.n)(e.closed)}))}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}}wt.ɵfac=function(e){return new(e||wt)(v.Y36(Q.D),v.Y36(f.wF),v.Y36(Y.F0),v.Y36(M.P),v.Y36(z.d),v.Y36(J.$),v.Y36(p.Z),v.Y36(j._),v.Y36(K.x),v.Y36(G.s),v.Y36($.a),v.Y36(h.Mn),v.Y36(i.qu))},wt.ɵcmp=v.Xpm({type:wt,selectors:[["app-import"]],decls:100,vars:57,consts:[["bitTypography","h1"],["type","info",4,"ngIf"],[3,"formGroup","bitSubmit"],["target","_blank","rel","noopener","href","https://bitwarden.com/help/import-data/",3,"appA11yTitle"],["aria-hidden","true",1,"bwi","bwi-question-circle"],["formControlName","vaultSelector"],["value","myVault","icon","bwi-user",3,"label",4,"ngIf"],["icon","bwi-business",3,"value","label",4,"ngFor","ngForOf"],["formControlName","targetSelector"],[4,"ngIf"],[1,"tw-w-1/2"],["formControlName","format"],[3,"value","label",4,"ngFor","ngForOf"],["type","info",3,"title",4,"ngIf"],[1,"file-selector"],["bitButton","","type","button",1,"btn","btn-outline-primary",3,"click"],["bitInput","","type","file","id","file","name","file","formControlName","file","hidden","",1,"form-control-file",3,"change"],["fileSelector",""],["id","fileContents","bitInput","","name","FileContents","formControlName","fileContents"],["bitButton","","bitFormButton","","type","submit","buttonType","primary",3,"disabled"],["type","info"],["value","myVault","icon","bwi-user",3,"label"],["icon","bwi-business",3,"value","label"],[3,"value","label"],["icon","bwi-folder",3,"value","label",4,"ngFor","ngForOf"],["icon","bwi-folder",3,"value","label"],["icon","bwi-collection",3,"value","label",4,"ngFor","ngForOf"],["icon","bwi-collection",3,"value","label"],["value","-","disabled",""],["type","info",3,"title"],["target","_blank","rel","noopener","href","https://bitwarden.com/help/export-your-data/"],["target","_blank","rel","noopener","href","https://bitwarden.com/help/import-from-lastpass/"],["target","_blank","rel","noopener","href","https://bitwarden.com/help/import-from-chrome/"],["target","_blank","rel","noopener","href","https://bitwarden.com/help/import-from-firefox/"],["target","_blank","rel","noopener","href","https://bitwarden.com/help/import-from-safari/"],["target","_blank","rel","noopener","href","https://bitwarden.com/help/import-from-1password/"],["target","_blank","rel","noopener","href","https://bit.ly/2GpOMTg"]],template:function(e,t){if(1&e){const e=v.EpF();v.TgZ(0,"h1",0),v._uU(1),v.ALo(2,"i18n"),v.qZA(),v._uU(3,"\n\n"),v.YNc(4,ae,3,3,"bit-callout",1),v._uU(5,"\n"),v.TgZ(6,"form",2),v._uU(7,"\n  "),v.TgZ(8,"bit-form-field"),v._uU(9,"\n    "),v.TgZ(10,"bit-label"),v._uU(11),v.ALo(12,"i18n"),v.TgZ(13,"a",3),v.ALo(14,"i18n"),v._uU(15,"\n        "),v._UZ(16,"i",4),v._uU(17,"\n      "),v.qZA(),v._uU(18,"\n    "),v.qZA(),v._uU(19,"\n    "),v.TgZ(20,"bit-select",5),v._uU(21,"\n      "),v.YNc(22,le,2,3,"bit-option",6),v._uU(23,"\n      "),v.YNc(24,ce,1,2,"bit-option",7),v.ALo(25,"async"),v._uU(26,"\n    "),v.qZA(),v._uU(27,"\n  "),v.qZA(),v._uU(28,"\n\n  "),v.TgZ(29,"bit-form-field"),v._uU(30,"\n    "),v.TgZ(31,"bit-label"),v._uU(32),v.ALo(33,"i18n"),v.ALo(34,"i18n"),v.qZA(),v._uU(35,"\n    "),v.TgZ(36,"bit-select",8),v._uU(37,"\n      "),v.YNc(38,pe,8,7,"ng-container",9),v._uU(39,"\n      "),v.YNc(40,de,8,7,"ng-container",9),v._uU(41,"\n    "),v.qZA(),v._uU(42,"\n    "),v.TgZ(43,"bit-hint"),v._uU(44),v.ALo(45,"i18n"),v.ALo(46,"lowercase"),v.ALo(47,"i18n"),v.ALo(48,"lowercase"),v.ALo(49,"i18n"),v.qZA(),v._uU(50,"\n  "),v.qZA(),v._uU(51,"\n\n  "),v.TgZ(52,"bit-form-field",10),v._uU(53,"\n    "),v.TgZ(54,"bit-label"),v._uU(55),v.ALo(56,"i18n"),v.qZA(),v._uU(57,"\n    "),v.TgZ(58,"bit-select",11),v._uU(59,"\n      "),v.YNc(60,me,1,2,"bit-option",12),v._uU(61,"\n      "),v.YNc(62,ge,6,1,"ng-container",9),v._uU(63,"\n    "),v.qZA(),v._uU(64,"\n  "),v.qZA(),v._uU(65,"\n  "),v.YNc(66,vt,111,55,"bit-callout",13),v._uU(67,"\n  "),v.TgZ(68,"bit-form-field"),v._uU(69,"\n    "),v.TgZ(70,"bit-label"),v._uU(71),v.ALo(72,"i18n"),v.qZA(),v._uU(73,"\n    "),v.TgZ(74,"div",14),v._uU(75,"\n      "),v.TgZ(76,"button",15),v.NdJ("click",(function(){v.CHM(e);const t=v.MAs(83);return v.KtG(t.click())})),v._uU(77),v.ALo(78,"i18n"),v.qZA(),v._uU(79),v.ALo(80,"i18n"),v.qZA(),v._uU(81,"\n    "),v.TgZ(82,"input",16,17),v.NdJ("change",(function(e){return t.setSelectedFile(e)})),v.qZA(),v._uU(84,"\n  "),v.qZA(),v._uU(85,"\n  "),v.TgZ(86,"bit-form-field"),v._uU(87,"\n    "),v.TgZ(88,"bit-label"),v._uU(89),v.ALo(90,"i18n"),v.qZA(),v._uU(91,"\n    "),v._UZ(92,"textarea",18),v._uU(93,"\n  "),v.qZA(),v._uU(94,"\n  "),v.TgZ(95,"button",19),v._uU(96),v.ALo(97,"i18n"),v.qZA(),v._uU(98,"\n"),v.qZA(),v._uU(99,"\n")}2&e&&(v.xp6(1),v.Oqu(v.lcZ(2,22,"importData")),v.xp6(3),v.Q6J("ngIf",t.importBlockedByPolicy),v.xp6(2),v.Q6J("formGroup",t.formGroup)("bitSubmit",t.submit),v.xp6(5),v.hij("",v.lcZ(12,24,"importDestination"),"\n      "),v.xp6(2),v.s9C("appA11yTitle",v.lcZ(14,26,"learnAboutImportOptions")),v.xp6(9),v.Q6J("ngIf",!t.importBlockedByPolicy),v.xp6(2),v.Q6J("ngForOf",v.lcZ(25,28,t.organizations$)),v.xp6(8),v.Oqu(t.organizationId?v.lcZ(33,30,"collection"):v.lcZ(34,32,"folder")),v.xp6(6),v.Q6J("ngIf",!t.organizationId),v.xp6(2),v.Q6J("ngIf",t.organizationId),v.xp6(4),v.Oqu(v.xi3(45,34,"importTargetHint",t.organizationId?v.lcZ(46,37,v.lcZ(47,39,"collection")):v.lcZ(48,41,v.lcZ(49,43,"folder")))),v.xp6(11),v.Oqu(v.lcZ(56,45,"fileFormat")),v.xp6(5),v.Q6J("ngForOf",t.featuredImportOptions),v.xp6(2),v.Q6J("ngIf",t.importOptions&&t.importOptions.length),v.xp6(4),v.Q6J("ngIf",t.format),v.xp6(5),v.Oqu(v.lcZ(72,47,"selectImportFile")),v.xp6(6),v.hij("\n        ",v.lcZ(78,49,"chooseFile"),"\n      "),v.xp6(2),v.hij("\n      ",t.fileSelected?t.fileSelected.name:v.lcZ(80,51,"noFileChosen"),"\n    "),v.xp6(10),v.Oqu(v.lcZ(90,53,"orCopyPasteFileContents")),v.xp6(6),v.Q6J("disabled",t.importBlockedByPolicy),v.xp6(1),v.hij("\n    ",v.lcZ(97,55,"importData"),"\n  "))},dependencies:[w.sg,w.O5,i._Y,i.Fj,i.JJ,i.JL,i.sg,i.u,H.B,X.b,ee.u,O.r,te.O,F.d,L.G,B.u,se.M,ie.H,re.x,ne.t,w.Ov,w.i8,U.C],encapsulation:2})},25376:(e,t,s)=>{s.d(t,{$:()=>r});var i=s(24852);class r{constructor(e){this.el=null,this.el=e.nativeElement}ngOnInit(){this.formEls=Array.from(this.el.querySelectorAll('input:not([type="hidden"]), select, textarea')),this.formEls.forEach((e=>{e.addEventListener("focus",(()=>{this.el.classList.add("active")}),!1),e.addEventListener("blur",(()=>{this.el.classList.remove("active")}),!1)}))}onClick(e){const t=e.target;if((t===this.el||t.classList.contains("progress")||t.classList.contains("progress-bar"))&&this.formEls.length>0){const e=this.formEls[0];if("input"===e.tagName.toLowerCase()){const t=e;if(null!=t.type&&"checkbox"===t.type.toLowerCase())return void t.click()}e.focus()}}}r.ɵfac=function(e){return new(e||r)(i.Y36(i.SBq))},r.ɵdir=i.lG2({type:r,selectors:[["","appBoxRow",""]],hostBindings:function(e,t){1&e&&i.NdJ("click",(function(e){return t.onClick(e)}))}})},90258:(e,t,s)=>{s.d(t,{N:()=>p});var i=s(58691),r=s(24852),n=s(58172),o=s(19419),a=s(53707),l=s(82933),c=function(e,t,s,i){return new(s||(s=Promise))((function(r,n){function o(e){try{l(i.next(e))}catch(t){n(t)}}function a(e){try{l(i.throw(e))}catch(t){n(t)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,a)}l((i=i.apply(e,t||[])).next())}))};function u(e,t){if(1&e&&(r.ynx(0),r._uU(1,"\n  "),r.TgZ(2,"app-callout",1),r.ALo(3,"i18n"),r._uU(4),r.ALo(5,"i18n"),r.qZA(),r._uU(6,"\n"),r.BQk()),2&e){const e=r.oxw();r.xp6(2),r.s9C("title",r.lcZ(3,2,e.scopeConfig.title)),r.xp6(2),r.hij("\n    ",r.xi3(5,4,e.scopeConfig.description,e.scopeConfig.scopeIdentifier),"\n  ")}}class p{constructor(e,t){this.organizationService=e,this.stateService=t,this.organizationId=null,this.show=!1}ngOnInit(){return c(this,void 0,void 0,(function*(){this.organizationService.hasOrganizations()&&(this.scopeConfig=null!=this.organizationId?{title:"exportingOrganizationVaultTitle",description:"exportingOrganizationVaultDesc",scopeIdentifier:this.organizationService.get(this.organizationId).name}:{title:"exportingPersonalVaultTitle",description:"exportingIndividualVaultDescription",scopeIdentifier:yield this.stateService.getEmail()},this.show=!0)}))}}p.ɵfac=function(e){return new(e||p)(r.Y36(i.Mn),r.Y36(n.b))},p.ɵcmp=r.Xpm({type:p,selectors:[["app-export-scope-callout"]],inputs:{organizationId:"organizationId"},decls:2,vars:1,consts:[[4,"ngIf"],["type","info",3,"title"]],template:function(e,t){1&e&&(r.YNc(0,u,7,7,"ng-container",0),r._uU(1,"\n")),2&e&&r.Q6J("ngIf",t.show)},dependencies:[o.O5,a.O,l.C],encapsulation:2})},13968:(e,t,s)=>{s.d(t,{gO:()=>n,rZ:()=>i,Y5:()=>yt,wF:()=>o});class i{}var r=function(e,t,s,i){return new(s||(s=Promise))((function(r,n){function o(e){try{l(i.next(e))}catch(t){n(t)}}function a(e){try{l(i.throw(e))}catch(t){n(t)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,a)}l((i=i.apply(e,t||[])).next())}))};class n{constructor(e){this.apiService=e}postImportCiphers(e){return r(this,void 0,void 0,(function*(){return yield this.apiService.send("POST","/ciphers/import",e,!0,!1)}))}postImportOrganizationCiphers(e,t){return r(this,void 0,void 0,(function*(){return yield this.apiService.send("POST","/ciphers/import-organization?organizationId="+e,t,!0,!1)}))}}class o{}class a{constructor(){this.ciphers=[],this.folders=[],this.folderRelationships=[]}}class l{constructor(){this.ciphers=[],this.collections=[],this.collectionRelationships=[]}}class c{constructor(e,t){this.key=e,this.value=t}}var u=s(25679),p=s(27646),h=s(31182),d=s(29918),m=s(43441);class f extends m.W{constructor(e){null!=e&&(super(e),this.id=e.id)}}var g=s(79971),y=s(23666),v=s(90364);class w{constructor(){this.success=!1,this.ciphers=[],this.folders=[],this.folderRelationships=[],this.collections=[],this.collectionRelationships=[]}}var O=s(59778),x=s(82083),N=s(12481),_=s(53061),b=s(11612),C=s(95896),U=s(60712),S=s(54976);class D{constructor(){this.organizationId=null,this.logService=new N.d(!1),this.newLineRegex=/(?:\r\n|\r|\n)/,this.passwordFieldNames=["password","pass word","passphrase","pass phrase","pass","code","code word","codeword","secret","secret word","personpwd","key","keyword","key word","keyphrase","key phrase","form_pw","wppassword","pin","pwd","pw","pword","passwd","p","serial","serial#","license key","reg #","passwort"],this.usernameFieldNames=["user","name","user name","username","login name","email","e-mail","id","userid","user id","login","form_loginname","wpname","mail","loginid","login id","log","personlogin","first name","last name","card#","account #","member","member #","nom","benutzername"],this.notesFieldNames=["note","notes","comment","comments","memo","description","free form","freeform","free text","freetext","free","kommentar"],this.uriFieldNames=["url","hyper link","hyperlink","link","host","hostname","host name","server","address","hyper ref","href","web","website","web site","site","web-site","uri","ort","adresse"],this.parseCsvOptions={encoding:"UTF-8",skipEmptyLines:!1}}get organization(){return null!=this.organizationId}parseXml(e){const t=(new DOMParser).parseFromString(e,"application/xml");return null!=t&&null==t.querySelector("parsererror")?t:null}parseCsv(e,t,s={}){const i=Object.assign({header:t},this.parseCsvOptions,s);e=this.splitNewLine(e).join("\n").trim();const r=O.parse(e,i);return null!=r.errors&&r.errors.length>0&&r.errors.forEach((e=>{null!=e.row&&this.logService.warning("Error parsing row "+e.row+": "+e.message)})),r.data&&r.data.length>0?r.data:null}parseSingleRowCsv(e){if(this.isNullOrWhitespace(e))return null;const t=this.parseCsv(e,!1);return null!=t&&t.length>0&&t[0].length>0?t[0]:null}makeUriArray(e){if(null==e)return null;if("string"==typeof e){const t=new C.E;return t.uri=this.fixUri(e),this.isNullOrWhitespace(t.uri)?null:(t.match=null,[t])}if(e.length>0){const t=[];return e.forEach((e=>{const s=new C.E;s.uri=this.fixUri(e),this.isNullOrWhitespace(s.uri)||(s.match=null,t.push(s))})),0===t.length?null:t}return null}fixUri(e){return null==e?null:(-1===(e=e.trim()).indexOf("://")&&e.indexOf(".")>=0&&(e="http://"+e),e.length>1e3?e.substring(0,1e3):e)}nameFromUrl(e){const t=p.c.getHostname(e);return this.isNullOrWhitespace(t)?null:t.startsWith("www.")?t.replace("www.",""):t}isNullOrWhitespace(e){return p.c.isNullOrWhitespace(e)}getValueOrDefault(e,t=null){return this.isNullOrWhitespace(e)?t:e}splitNewLine(e){return e.split(this.newLineRegex)}setCardExpiration(e,t){if(this.isNullOrWhitespace(t))return!1;t=t.replace(/\s/g,"");const s=new RegExp("^0?(?<month>[1-9]|1[0-2])/(?<year>(?:[1-2][0-9])?[0-9]{2})$"),i=t.match(s);if(!i)return!1;e.card.expMonth=i.groups.month;const r=i.groups.year;return e.card.expYear=2===r.length?"20"+r:r,!0}moveFoldersToCollections(e){e.folderRelationships.forEach((t=>e.collectionRelationships.push(t))),e.collections=e.folders.map((e=>{const t=new y.n;return t.name=e.name,t.id=e.id,t})),e.folderRelationships=[],e.folders=[]}querySelectorDirectChild(e,t){const s=this.querySelectorAllDirectChild(e,t);return 0===s.length?null:s[0]}querySelectorAllDirectChild(e,t){return Array.from(e.querySelectorAll(t)).filter((t=>t.parentNode===e))}initLoginCipher(){const e=new _.$;return e.favorite=!1,e.notes="",e.fields=[],e.login=new U.q,e.type=h.O.Login,e}cleanupCipher(e){null!=e&&(e.type!==h.O.Login&&(e.login=null),this.isNullOrWhitespace(e.name)&&(e.name="--"),this.isNullOrWhitespace(e.notes)?e.notes=null:e.notes=e.notes.trim(),null!=e.fields&&0===e.fields.length&&(e.fields=null),null!=e.passwordHistory&&0===e.passwordHistory.length&&(e.passwordHistory=null))}processKvp(e,t,s,i=x.fS.Text){if(!this.isNullOrWhitespace(s))if(this.isNullOrWhitespace(t)&&(t=""),s.length>200||s.trim().search(this.newLineRegex)>-1)null==e.notes&&(e.notes=""),e.notes+=t+": "+this.splitNewLine(s).join("\n")+"\n";else{null==e.fields&&(e.fields=[]);const r=new b.k;r.type=i,r.name=t,r.value=s,e.fields.push(r)}}processFolder(e,t){if(this.isNullOrWhitespace(t))return;let s=e.folders.length;t=t.replace("\\","/");let i=!0;for(let r=0;r<e.folders.length;r++)if(e.folders[r].name===t){i=!1,s=r;break}if(i){const s=new v.a;s.name=t,e.folders.push(s)}e.folderRelationships.push([e.ciphers.length,s])}convertToNoteIfNeeded(e){e.type===h.O.Login&&this.isNullOrWhitespace(e.login.username)&&this.isNullOrWhitespace(e.login.password)&&(null==e.login.uris||0===e.login.uris.length)&&(e.type=h.O.SecureNote,e.secureNote=new S.z,e.secureNote.type=x.xs.Generic)}processFullName(e,t){if(this.isNullOrWhitespace(t))return;const s=t.split(" ");s.length>0&&(e.identity.firstName=this.getValueOrDefault(s[0])),2===s.length?e.identity.lastName=this.getValueOrDefault(s[1]):s.length>=3&&(e.identity.middleName=this.getValueOrDefault(s[1]),e.identity.lastName=s.slice(2,s.length).join(" "))}}class k extends D{parse(e){const t=new w,s=this.parseCsv(e,!1);return null==s?(t.success=!1,Promise.resolve(t)):(s.forEach((e=>{if(e.length<2)return;const s=this.initLoginCipher();if(s.notes=this.getValueOrDefault(e[e.length-1]),s.name=this.getValueOrDefault(e[0],"--"),e.length>2&&e.length%2==0)for(let t=0;t<e.length-2;t+=2){const i=e[t+2],r=e[t+1];if(this.isNullOrWhitespace(i)||this.isNullOrWhitespace(r))continue;const n=r.toLowerCase();null==s.login.password&&this.passwordFieldNames.indexOf(n)>-1?s.login.password=this.getValueOrDefault(i):null==s.login.username&&this.usernameFieldNames.indexOf(n)>-1?s.login.username=this.getValueOrDefault(i):(null==s.login.uris||0===s.login.uris.length)&&this.uriFieldNames.indexOf(n)>-1?s.login.uris=this.makeUriArray(i):this.processKvp(s,r,i)}this.convertToNoteIfNeeded(s),this.cleanupCipher(s),t.ciphers.push(s)})),t.success=!0,Promise.resolve(t))}}class P extends D{parse(e){const t=new w,s=this.parseCsv(e,!0);return null==s?(t.success=!1,Promise.resolve(t)):(s.forEach((e=>{const s=this.initLoginCipher();s.name=this.getValueOrDefault(e.name),s.login.uris=this.makeUriArray(e.web),s.login.password=this.getValueOrDefault(e.password),s.login.username=this.getValueOrDefault(e.login),this.cleanupCipher(s),t.ciphers.push(s)})),t.success=!0,Promise.resolve(t))}}var V=s(57387);class A extends D{parse(e){const t=new w,s=JSON.parse(e);return null==s?(t.success=!1,Promise.resolve(t)):(null!=s.logins&&s.logins.forEach((e=>{const s=this.initLoginCipher();s.name=this.getValueOrDefault(e.custName),s.notes=this.getValueOrDefault(e.note),s.login.uris=this.makeUriArray(e.url),s.login.password=this.getValueOrDefault(e.pwd),s.login.username=this.getValueOrDefault(e.loginName),this.cleanupCipher(s),t.ciphers.push(s)})),null!=s.notes&&s.notes.forEach((e=>{const s=this.initLoginCipher();s.type=h.O.SecureNote,s.secureNote.type=x.xs.Generic,s.name=this.getValueOrDefault(e.label),s.notes=this.getValueOrDefault(e.text),this.cleanupCipher(s),t.ciphers.push(s)})),null!=s.cards&&s.cards.forEach((e=>{const s=this.initLoginCipher();s.type=h.O.Card,s.name=this.getValueOrDefault(e.custName),s.notes=this.getValueOrDefault(e.note),s.card.cardholderName=this.getValueOrDefault(e.holderName),s.card.number=this.getValueOrDefault(e.cardNumber),s.card.code=this.getValueOrDefault(e.cvv),s.card.brand=V._.getCardBrandByPatterns(s.card.number),null!=e.expirationDate&&(null!=e.expirationDate.month&&(s.card.expMonth=e.expirationDate.month+""),null!=e.expirationDate.year&&(s.card.expYear=e.expirationDate.year+"")),this.cleanupCipher(s),t.ciphers.push(s)})),t.success=!0,Promise.resolve(t))}}class E extends D{parse(e){const t=new w,s=this.parseCsv(e,!0);return null==s?(t.success=!1,Promise.resolve(t)):(s.forEach((e=>{const s=this.initLoginCipher();s.name=this.getValueOrDefault(e.name,this.getValueOrDefault(this.nameFromUrl(e.website),"--")),s.login.uris=this.makeUriArray(e.website),s.login.password=this.getValueOrDefault(e.password),this.isNullOrWhitespace(e.username)&&!this.isNullOrWhitespace(e.secondary_username)?s.login.username=e.secondary_username:(s.login.username=this.getValueOrDefault(e.username),s.notes=this.getValueOrDefault(e.secondary_username)),this.cleanupCipher(s),t.ciphers.push(s)})),t.success=!0,Promise.resolve(t))}}class I extends D{parse(e){const t=new w,s=this.parseCsv(e,!0);return null==s?(t.success=!1,Promise.resolve(t)):(s.forEach((e=>{if("list"===e.grouping)return;const s=this.initLoginCipher();s.favorite="1"===e.fav,s.name=this.getValueOrDefault(e.name),s.notes=this.getValueOrDefault(e.extra),"note"!==e.grouping&&(s.login.uris=this.makeUriArray(e.url),s.login.password=this.getValueOrDefault(e.password),s.login.username=this.getValueOrDefault(e.username)),this.convertToNoteIfNeeded(s),this.cleanupCipher(s),t.ciphers.push(s)})),t.success=!0,Promise.resolve(t))}}class T extends D{constructor(){super(...arguments),this.androidPatternRegex=new RegExp("^android:\\/\\/.*(?<=@)(.*)(?=\\/)")}parse(e){const t=new w,s=this.parseCsv(e,!0);return null==s?(t.success=!1,Promise.resolve(t)):(s.forEach((e=>{const s=this.initLoginCipher();let i=e.name;!i&&this.androidPatternRegex.test(e.url)&&(i=e.url.match(this.androidPatternRegex)[1]),s.name=this.getValueOrDefault(i,"--"),s.login.username=this.getValueOrDefault(e.username),s.login.password=this.getValueOrDefault(e.password),s.login.uris=this.makeUriArray(e.url),this.cleanupCipher(s),t.ciphers.push(s)})),t.success=!0,Promise.resolve(t))}}var F=s(72285);class L extends D{parse(e){const t=new w,s=this.parseCsv(e,!0);return null==s?(t.success=!1,Promise.resolve(t)):(s.forEach((e=>{if(this.organization&&!this.isNullOrWhitespace(e.collections)){e.collections.split(",").forEach((e=>{let s=!0,i=t.collections.length;for(let r=0;r<t.collections.length;r++)if(t.collections[r].name===e){s=!1,i=r;break}if(s){const s=new y.n;s.name=e,t.collections.push(s)}t.collectionRelationships.push([t.ciphers.length,i])}))}else this.organization||this.processFolder(t,e.folder);const s=new _.$;s.favorite=!this.organization&&"0"!==this.getValueOrDefault(e.favorite,"0"),s.type=h.O.Login,s.notes=this.getValueOrDefault(e.notes),s.name=this.getValueOrDefault(e.name,"--");try{s.reprompt=parseInt(this.getValueOrDefault(e.reprompt,F.N.None.toString()),10)}catch(i){console.error("Unable to parse reprompt value",i),s.reprompt=F.N.None}if(!this.isNullOrWhitespace(e.fields)){const t=this.splitNewLine(e.fields);for(let e=0;e<t.length;e++){if(this.isNullOrWhitespace(t[e]))continue;const i=t[e].lastIndexOf(": ");if(-1===i)continue;null==s.fields&&(s.fields=[]);const r=new b.k;r.name=t[e].substr(0,i),r.value=null,r.type=x.fS.Text,t[e].length>i+2&&(r.value=t[e].substr(i+2)),s.fields.push(r)}}switch(null!=e.type?e.type.toLowerCase():null){case"note":s.type=h.O.SecureNote,s.secureNote=new S.z,s.secureNote.type=x.xs.Generic;break;default:{s.type=h.O.Login,s.login=new U.q,s.login.totp=this.getValueOrDefault(e.login_totp||e.totp),s.login.username=this.getValueOrDefault(e.login_username||e.username),s.login.password=this.getValueOrDefault(e.login_password||e.password);const t=this.parseSingleRowCsv(e.login_uri||e.uri);s.login.uris=this.makeUriArray(t);break}}t.ciphers.push(s)})),t.success=!0,Promise.resolve(t))}}var Z=s(36666),W=s(70427),B=function(e,t,s,i){return new(s||(s=Promise))((function(r,n){function o(e){try{l(i.next(e))}catch(t){n(t)}}function a(e){try{l(i.throw(e))}catch(t){n(t)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,a)}l((i=i.apply(e,t||[])).next())}))};class q extends D{constructor(e,t){super(),this.cryptoService=e,this.i18nService=t}parse(e){return B(this,void 0,void 0,(function*(){this.result=new w;const t=JSON.parse(e);return null==t||null==t.items?(this.result.success=!1,this.result):(t.encrypted?yield this.parseEncrypted(t):yield this.parseDecrypted(t),this.result)}))}parseEncrypted(e){return B(this,void 0,void 0,(function*(){if(null!=e.encKeyValidation_DO_NOT_EDIT){const t=yield this.cryptoService.getOrgKey(this.organizationId),s=new W._(e.encKeyValidation_DO_NOT_EDIT);if(null===(yield this.cryptoService.decryptToUtf8(s,t)))return this.result.success=!1,void(this.result.errorMessage=this.i18nService.t("importEncKeyError"))}const t=this.organization?yield this.parseCollections(e):yield this.parseFolders(e);for(const s of e.items){const e=Z.Rm.toDomain(s);e.id=null,e.organizationId=this.organizationId,e.collectionIds=null,null!=e.passwordHistory&&e.passwordHistory.length>5&&(e.passwordHistory=e.passwordHistory.slice(0,5)),!this.organization&&null!=s.folderId&&t.has(s.folderId)?this.result.folderRelationships.push([this.result.ciphers.length,t.get(s.folderId)]):this.organization&&null!=s.collectionIds&&s.collectionIds.forEach((e=>{t.has(e)&&this.result.collectionRelationships.push([this.result.ciphers.length,t.get(e)])}));const i=yield e.decrypt();this.cleanupCipher(i),this.result.ciphers.push(i)}this.result.success=!0}))}parseDecrypted(e){return B(this,void 0,void 0,(function*(){const t=this.organization?yield this.parseCollections(e):yield this.parseFolders(e);e.items.forEach((e=>{const s=Z.Rm.toView(e);s.id=null,s.organizationId=null,s.collectionIds=null,null!=s.passwordHistory&&s.passwordHistory.length>5&&(s.passwordHistory=s.passwordHistory.slice(0,5)),!this.organization&&null!=e.folderId&&t.has(e.folderId)?this.result.folderRelationships.push([this.result.ciphers.length,t.get(e.folderId)]):this.organization&&null!=e.collectionIds&&e.collectionIds.forEach((e=>{t.has(e)&&this.result.collectionRelationships.push([this.result.ciphers.length,t.get(e)])})),this.cleanupCipher(s),this.result.ciphers.push(s)})),this.result.success=!0}))}parseFolders(e){return B(this,void 0,void 0,(function*(){if(null==e.folders)return null;const t=new Map;for(const s of e.folders){let i;if(e.encrypted){const e=Z.L5.toDomain(s);null!=e&&(i=yield e.decrypt())}else i=Z.L5.toView(s);null!=i&&(t.set(s.id,this.result.folders.length),this.result.folders.push(i))}return t}))}parseCollections(e){return B(this,void 0,void 0,(function*(){if(null==e.collections)return null;const t=new Map;for(const s of e.collections){let i;if(e.encrypted){const e=Z.lC.toDomain(s);e.organizationId=this.organizationId,i=yield e.decrypt()}else i=Z.lC.toView(s),i.organizationId=null;null!=i&&(t.set(s.id,this.result.collections.length),this.result.collections.push(i))}return t}))}}var R=s(88160),Q=function(e,t,s,i){return new(s||(s=Promise))((function(r,n){function o(e){try{l(i.next(e))}catch(t){n(t)}}function a(e){try{l(i.throw(e))}catch(t){n(t)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,a)}l((i=i.apply(e,t||[])).next())}))};class Y extends q{constructor(e,t,s){super(e,t),this.promptForPassword_callback=s}parse(e){const t=Object.create(null,{parse:{get:()=>super.parse}});return Q(this,void 0,void 0,(function*(){const s=new w,i=JSON.parse(e);if(!i)return s.success=!1,s;if(!(null==i?void 0:i.encrypted))return yield t.parse.call(this,e);if(!(null==i?void 0:i.passwordProtected))return yield t.parse.call(this,e);if(this.cannotParseFile(i))return s.success=!1,s;const r=yield this.promptForPassword_callback();if(!(yield this.checkPassword(i,r)))return s.success=!1,s.errorMessage=this.i18nService.t("invalidFilePassword"),s;const n=new W._(i.data),o=yield this.cryptoService.decryptToUtf8(n,this.key);return yield t.parse.call(this,o)}))}checkPassword(e,t){return Q(this,void 0,void 0,(function*(){if(this.isNullOrWhitespace(t))return!1;this.key=yield this.cryptoService.makePinKey(t,e.salt,e.kdfType,new R.E(e.kdfIterations,e.kdfMemory,e.kdfParallelism));const s=new W._(e.encKeyValidation_DO_NOT_EDIT);return null!==(yield this.cryptoService.decryptToUtf8(s,this.key))}))}cannotParseFile(e){return!(e&&e.encrypted&&e.passwordProtected&&e.salt&&e.kdfIterations&&"number"==typeof e.kdfIterations&&null!=e.kdfType&&null!=x.G3[e.kdfType]&&e.encKeyValidation_DO_NOT_EDIT&&e.data)}}class M extends D{parse(e){const t=new w,s=this.parseCsv(e,!0);return null==s?(t.success=!1,Promise.resolve(t)):(s.forEach((e=>{"null"===e.label&&(e.label=null);const s=this.initLoginCipher();s.name=this.getValueOrDefault(e.label,this.getValueOrDefault(this.nameFromUrl(e.domain),"--")),s.login.uris=this.makeUriArray(e.domain),s.login.password=this.getValueOrDefault(e.password),this.isNullOrWhitespace(e.email)&&!this.isNullOrWhitespace(e.username)?s.login.username=e.username:(s.login.username=this.getValueOrDefault(e.email),s.notes=this.getValueOrDefault(e.username)),this.cleanupCipher(s),t.ciphers.push(s)})),t.success=!0,Promise.resolve(t))}}const z=["!group_id","!group_name","title","username","password","URL","id"];class J extends D{parse(e){const t=new w,s=this.parseCsv(e,!0);return null==s?(t.success=!1,Promise.resolve(t)):(s.forEach((e=>{this.processFolder(t,this.getValueOrDefault(e["!group_name"]));const s=this.initLoginCipher();s.name=this.getValueOrDefault(e.title,"--"),s.login.username=this.getValueOrDefault(e.username),s.login.password=this.getValueOrDefault(e.password),s.login.uris=this.makeUriArray(e.URL);let i=!1;for(const t in e)e.hasOwnProperty(t)&&(i||-1!==z.indexOf(t)||(i=!0),i&&this.processKvp(s,t,e[t]));this.cleanupCipher(s),t.ciphers.push(s)})),this.organization&&this.moveFoldersToCollections(t),t.success=!0,Promise.resolve(t))}}class j extends D{parse(e){const t=new w,s=this.parseXml(e);if(null==s)return t.success=!1,Promise.resolve(t);const i=s.querySelector("textarea");if(null==i||this.isNullOrWhitespace(i.textContent))return t.errorMessage="Missing textarea.",t.success=!1,Promise.resolve(t);return JSON.parse(i.textContent).forEach((e=>{const s=this.initLoginCipher();if(this.isNullOrWhitespace(e.label)||(s.name=e.label.split(" ")[0]),null==e.data||this.isNullOrWhitespace(e.data.notes)||(s.notes=e.data.notes.split("\\n").join("\n")),null!=e.currentVersion&&null!=e.currentVersion.fields)for(const t in e.currentVersion.fields){if(!e.currentVersion.fields.hasOwnProperty(t))continue;const i=e.currentVersion.fields[t];switch(null!=i.actionType?i.actionType.toLowerCase():null){case"password":s.login.password=this.getValueOrDefault(i.value);break;case"email":case"username":case"user":case"name":s.login.username=this.getValueOrDefault(i.value);break;case"url":s.login.uris=this.makeUriArray(i.value);break;default:{const e=null!=i.label?i.label.toLowerCase():null;null==s.login.password&&this.passwordFieldNames.indexOf(e)>-1?s.login.password=this.getValueOrDefault(i.value):null==s.login.username&&this.usernameFieldNames.indexOf(e)>-1?s.login.username=this.getValueOrDefault(i.value):(null==s.login.uris||0===s.login.uris.length)&&this.uriFieldNames.indexOf(e)>-1?s.login.uris=this.makeUriArray(i.value):this.processKvp(s,i.label,i.value);break}}}this.convertToNoteIfNeeded(s),this.cleanupCipher(s),t.ciphers.push(s)})),t.success=!0,Promise.resolve(t)}}class K extends D{parse(e){const t=new w,s=this.parseCsv(e,!0);return null==s?(t.success=!1,Promise.resolve(t)):(s.forEach((e=>{this.processFolder(t,this.getValueOrDefault(e.Category));const s=this.initLoginCipher();s.favorite="True"===this.getValueOrDefault(e.Favorite),s.name=this.getValueOrDefault(e.Entry,"--"),s.notes=this.getValueOrDefault(e.Note),s.login.username=this.getValueOrDefault(e.Username,e.Email),s.login.password=this.getValueOrDefault(e.Password),s.login.totp=this.getValueOrDefault(e.TOTP),s.login.uris=this.makeUriArray(e.Website),this.isNullOrWhitespace(e.Username)||this.processKvp(s,"Email",e.Email),this.processKvp(s,"Phone",e.Phone),this.processKvp(s,"PIN",e.PIN),this.processKvp(s,"Account",e.Account),this.processKvp(s,"Date",e.Date),this.convertToNoteIfNeeded(s),this.cleanupCipher(s),t.ciphers.push(s)})),this.organization&&this.moveFoldersToCollections(t),t.success=!0,Promise.resolve(t))}}var G=s(15091);const $=new Set(["title","note","username","password","url","otpSecret","category"]),H=new Set(["type","title","first_name","middle_name","last_name","login","email","phone_number","address","country","state","city","zip","item_name"]),X=new Set(["title","note"]);class ee extends D{parse(e){const t=new w,s=this.parseCsv(e,!0);if(null==s)return t.success=!1,Promise.resolve(t);if(null!=s[0].type&&null!=s[0].title){if(1===s.filter((e=>"name"===e.type)).length){const e=this.initLoginCipher();return e.type=h.O.Identity,e.identity=new G.t,s.forEach((t=>{this.parsePersonalInformationRecordAsIdentity(e,t)})),this.cleanupCipher(e),t.ciphers.push(e),t.success=!0,Promise.resolve(t)}}return s.forEach((e=>{const s=this.initLoginCipher(),i=Object.keys(e);"username"===i[0]&&(this.processFolder(t,e.category),this.parseCredentialsRecord(s,e)),"type"===i[0]&&"account_name"===i[1]&&this.parsePaymentRecord(s,e),"type"===i[0]&&"number"===i[1]&&this.parseIdRecord(s,e),"type"===i[0]!=null&&"title"===i[1]&&this.parsePersonalInformationRecord(s,e),"title"===i[0]&&"note"===i[1]&&this.parseSecureNoteRecords(s,e),this.convertToNoteIfNeeded(s),this.cleanupCipher(s),t.ciphers.push(s)})),this.organization&&this.moveFoldersToCollections(t),t.success=!0,Promise.resolve(t)}parseCredentialsRecord(e,t){e.type=h.O.Login,e.login=new U.q,e.name=t.title,e.notes=t.note,e.login.username=t.username,e.login.password=t.password,e.login.totp=t.otpSecret,e.login.uris=this.makeUriArray(t.url),this.importUnmappedFields(e,t,$)}parsePaymentRecord(e,t){e.type=h.O.Card,e.card=new V._,e.name=t.account_name;let s=[];switch(t.type){case"credit_card":e.card.cardholderName=t.account_name,e.card.number=t.cc_number,e.card.brand=V._.getCardBrandByPatterns(e.card.number),e.card.code=t.code,this.setCardExpiration(e,`${t.expiration_month}/${t.expiration_year}`),s=["account_name","account_holder","cc_number","code","expiration_month","expiration_year"];break;case"bank":e.card.cardholderName=t.account_holder,e.card.number=t.account_number,s=["account_name","account_holder","account_number"]}this.importUnmappedFields(e,t,new Set(s))}parseIdRecord(e,t){e.type=h.O.Identity,e.identity=new G.t;const s=["name","number"];switch(t.type){case"card":e.name=`${t.name} ${t.type}`,this.processFullName(e,t.name),e.identity.licenseNumber=t.number;break;case"passport":e.name=`${t.name} ${t.type}`,this.processFullName(e,t.name),e.identity.passportNumber=t.number;break;case"license":e.name=`${t.name} ${t.type}`,this.processFullName(e,t.name),e.identity.licenseNumber=t.number,e.identity.state=t.state,s.push("state");break;case"social_security":e.name=`${t.name} ${t.type}`,this.processFullName(e,t.name),e.identity.ssn=t.number;break;case"tax_number":e.name=t.type,e.identity.licenseNumber=t.number}this.importUnmappedFields(e,t,new Set(s))}parsePersonalInformationRecord(e,t){e.type=h.O.SecureNote,e.secureNote.type=x.xs.Generic,"name"===t.type?e.name=`${t.title} ${t.first_name} ${t.middle_name} ${t.last_name}`.replace("  "," ").trim():e.name=t.item_name;const s=t;Object.keys(t).forEach((t=>{this.processKvp(e,t,s[t])}))}parsePersonalInformationRecordAsIdentity(e,t){switch(t.type){case"name":this.processFullName(e,`${t.first_name} ${t.middle_name} ${t.last_name}`),e.identity.title=t.title,e.name=e.identity.fullName,e.identity.username=t.login;break;case"email":e.identity.email=t.email;break;case"number":e.identity.phone=t.phone_number;break;case"address":e.identity.address1=t.address,e.identity.city=t.city,e.identity.postalCode=t.zip,e.identity.state=t.state,e.identity.country=t.country}this.importUnmappedFields(e,t,H)}parseSecureNoteRecords(e,t){e.type=h.O.SecureNote,e.secureNote.type=x.xs.Generic,e.name=t.title,e.notes=t.note,this.importUnmappedFields(e,t,X)}importUnmappedFields(e,t,s){Object.keys(t).filter((e=>!s.has(e))).forEach((s=>{const i=t;this.processKvp(e,s,i[s])}))}}const te=new Set(["ADDRESS","AUTHENTIFIANT","BANKSTATEMENT","IDCARD","IDENTITY","PAYMENTMEANS_CREDITCARD","PAYMENTMEAN_PAYPAL","EMAIL"]);class se extends D{parse(e){this.result=new w;const t=JSON.parse(e);if(null==t||0===t.length)return this.result.success=!1,Promise.resolve(this.result);null!=t.ADDRESS&&this.processAddress(t.ADDRESS),null!=t.AUTHENTIFIANT&&this.processAuth(t.AUTHENTIFIANT),null!=t.BANKSTATEMENT&&this.processNote(t.BANKSTATEMENT,"BankAccountName"),null!=t.IDCARD&&this.processNote(t.IDCARD,"Fullname"),null!=t.PAYMENTMEANS_CREDITCARD&&this.processCard(t.PAYMENTMEANS_CREDITCARD),null!=t.IDENTITY&&this.processIdentity(t.IDENTITY);for(const s in t)t.hasOwnProperty(s)&&!te.has(s)&&this.processNote(t[s],null,"Generic Note");return this.result.success=!0,Promise.resolve(this.result)}processAuth(e){e.forEach((e=>{const t=this.initLoginCipher();t.name=this.getValueOrDefault(e.title),t.login.username=this.getValueOrDefault(e.login,this.getValueOrDefault(e.secondaryLogin)),this.isNullOrWhitespace(t.login.username)?t.login.username=this.getValueOrDefault(e.email):this.isNullOrWhitespace(e.email)||(t.notes="Email: "+e.email+"\n"),t.login.password=this.getValueOrDefault(e.password),t.login.uris=this.makeUriArray(e.domain),t.notes+=this.getValueOrDefault(e.note,""),this.convertToNoteIfNeeded(t),this.cleanupCipher(t),this.result.ciphers.push(t)}))}processIdentity(e){e.forEach((e=>{const t=new _.$;t.identity=new G.t,t.type=h.O.Identity,t.name=this.getValueOrDefault(e.fullName,"");const s=t.name.split(" ");s.length>0&&(t.identity.firstName=this.getValueOrDefault(s[0])),2===s.length?t.identity.lastName=this.getValueOrDefault(s[1]):3===s.length&&(t.identity.middleName=this.getValueOrDefault(s[1]),t.identity.lastName=this.getValueOrDefault(s[2])),t.identity.username=this.getValueOrDefault(e.pseudo),this.cleanupCipher(t),this.result.ciphers.push(t)}))}processAddress(e){e.forEach((e=>{const t=new _.$;t.identity=new G.t,t.type=h.O.Identity,t.name=this.getValueOrDefault(e.addressName),t.identity.address1=this.getValueOrDefault(e.addressFull),t.identity.city=this.getValueOrDefault(e.city),t.identity.state=this.getValueOrDefault(e.state),t.identity.postalCode=this.getValueOrDefault(e.zipcode),t.identity.country=this.getValueOrDefault(e.country),null!=t.identity.country&&(t.identity.country=t.identity.country.toUpperCase()),this.cleanupCipher(t),this.result.ciphers.push(t)}))}processCard(e){e.forEach((e=>{const t=new _.$;t.card=new V._,t.type=h.O.Card,t.name=this.getValueOrDefault(e.bank),t.card.number=this.getValueOrDefault(e.cardNumber),t.card.brand=V._.getCardBrandByPatterns(t.card.number),t.card.cardholderName=this.getValueOrDefault(e.owner),this.isNullOrWhitespace(t.card.brand)||(this.isNullOrWhitespace(t.name)?t.name=t.card.brand:t.name+=" - "+t.card.brand),this.cleanupCipher(t),this.result.ciphers.push(t)}))}processNote(e,t,s=null){e.forEach((e=>{const i=new _.$;i.secureNote=new S.z,i.type=h.O.SecureNote,i.secureNote.type=x.xs.Generic,i.name=null!=s?s:this.getValueOrDefault(e[t]);for(const s in e)e.hasOwnProperty(s)&&s!==t&&this.processKvp(i,s,e[s].toString());this.cleanupCipher(i),this.result.ciphers.push(i)}))}}class ie extends D{parse(e){const t=new w,s=this.parseCsv(e,!0);return null==s?(t.success=!1,Promise.resolve(t)):(s.forEach((e=>{const s=this.initLoginCipher();s.name=this.getValueOrDefault(e.Label,"--"),s.notes=this.getValueOrDefault(e.Notes);const i=this.getValueOrDefault(e.Text);this.isNullOrWhitespace(i)||(this.isNullOrWhitespace(s.notes)?s.notes=i:s.notes+="\n\n"+i);const r=e["Entry Type"];if("Password"===r)s.login.username=this.getValueOrDefault(e.Username),s.login.password=this.getValueOrDefault(e.Password),s.login.uris=this.makeUriArray(e["Site URL"]);else if("Credit Card"===r){s.type=h.O.Card,s.card=new V._,s.card.cardholderName=this.getValueOrDefault(e["Name on card"]),s.card.number=this.getValueOrDefault(e["Card Number"]),s.card.brand=V._.getCardBrandByPatterns(s.card.number),s.card.code=this.getValueOrDefault(e.CVV);const t=this.getValueOrDefault(e.Expiry);if(!this.isNullOrWhitespace(t)){const e=t.split("/");e.length>1&&(s.card.expMonth=parseInt(e[0],null).toString(),s.card.expYear=(2e3+parseInt(e[1],null)).toString())}}this.convertToNoteIfNeeded(s),this.cleanupCipher(s),t.ciphers.push(s)})),t.success=!0,Promise.resolve(t))}}class re extends D{parse(e){const t=new w,s=this.parseCsv(e,!1);if(null==s)return t.success=!1,Promise.resolve(t);let i=!0;return s.forEach((e=>{if(e.length<2||i&&("Title"===e[0]||"title"===e[0]))return void(i=!1);const s=this.initLoginCipher();if(s.notes=this.getValueOrDefault(e[e.length-1]),s.name=this.getValueOrDefault(e[0],"--"),2!==e.length&&(this.containsField(e,"username")||this.containsField(e,"password")||this.containsField(e,"email")||this.containsField(e,"url"))||(s.type=h.O.SecureNote,s.secureNote=new S.z,s.secureNote.type=x.xs.Generic),this.containsField(e,"cardholder")&&this.containsField(e,"number")&&this.containsField(e,"expiry date")&&(s.type=h.O.Card,s.card=new V._),e.length>2&&e.length%2==0)for(let t=0;t<e.length-2;t+=2){const i=e[t+2];if(this.isNullOrWhitespace(i))continue;const r=e[t+1],n=r.toLowerCase();if(s.type===h.O.Login){if("url"===n&&(null==s.login.uris||0===s.login.uris.length)){s.login.uris=this.makeUriArray(i);continue}if(("username"===n||"email"===n)&&this.isNullOrWhitespace(s.login.username)){s.login.username=i;continue}if("password"===n&&this.isNullOrWhitespace(s.login.password)){s.login.password=i;continue}if("totp"===n&&this.isNullOrWhitespace(s.login.totp)){s.login.totp=i;continue}}else if(s.type===h.O.Card){if("cardholder"===n&&this.isNullOrWhitespace(s.card.cardholderName)){s.card.cardholderName=i;continue}if("number"===n&&this.isNullOrWhitespace(s.card.number)){s.card.number=i,s.card.brand=V._.getCardBrandByPatterns(s.card.number);continue}if("cvc"===n&&this.isNullOrWhitespace(s.card.code)){s.card.code=i;continue}if("expiry date"===n&&this.isNullOrWhitespace(s.card.expMonth)&&this.isNullOrWhitespace(s.card.expYear)){if(this.setCardExpiration(s,i))continue}else if("type"===n)continue}this.processKvp(s,r,i)}this.cleanupCipher(s),t.ciphers.push(s)})),t.success=!0,Promise.resolve(t)}containsField(e,t){return null!=e&&null!=t&&e.filter((e=>!this.isNullOrWhitespace(e)&&e.toLowerCase()===t.toLowerCase())).length>0}}const ne=new RegExp("androidapp://.*==@","g");class oe extends D{parse(e){const t=new w,s=JSON.parse(e);if(null==s||null==s.items||0===s.items.length)return t.success=!1,Promise.resolve(t);const i=new Map,r=new Map,n=this.buildFolderTree(s.folders);return this.flattenFolderTree(null,n,i),i.forEach(((e,s)=>{r.set(s,t.folders.length);const i=new v.a;i.name=e,t.folders.push(i)})),s.items.forEach((e=>{null!=e.folders&&e.folders.length>0&&r.has(e.folders[0])&&t.folderRelationships.push([t.ciphers.length,r.get(e.folders[0])]);const s=this.initLoginCipher();s.name=this.getValueOrDefault(e.title),s.favorite=e.favorite>0,null!=e.template_type&&null!=e.fields&&e.fields.length>0&&(0===e.template_type.indexOf("login.")||0===e.template_type.indexOf("password.")?this.processLogin(s,e.fields):0===e.template_type.indexOf("creditcard.")?this.processCard(s,e.fields):e.template_type.indexOf("identity.")<0&&e.fields.some((e=>"password"===e.type&&!this.isNullOrWhitespace(e.value)))?this.processLogin(s,e.fields):this.processNote(s,e.fields)),s.notes+="\n"+this.getValueOrDefault(e.note,""),this.convertToNoteIfNeeded(s),this.cleanupCipher(s),t.ciphers.push(s)})),t.success=!0,Promise.resolve(t)}processLogin(e,t){const s=[];t.forEach((t=>{if(!this.isNullOrWhitespace(t.value)&&"section"!==t.type)if("username"!==t.type&&"email"!==t.type||!this.isNullOrWhitespace(e.login.username))if("password"===t.type&&this.isNullOrWhitespace(e.login.password))e.login.password=t.value;else if("totp"===t.type&&this.isNullOrWhitespace(e.login.totp))e.login.totp=t.value;else if("url"===t.type)s.push(t.value);else if(".Android#"===t.type){let e=t.value.startsWith("androidapp://")?t.value:"androidapp://"+t.value;e=e.replace("android://",""),e=e.replace(ne,"androidapp://"),s.push(e)}else this.processKvp(e,t.label,t.value,1===t.sensitive?x.fS.Hidden:x.fS.Text);else e.login.username=t.value})),e.login.uris=this.makeUriArray(s)}processCard(e,t){e.card=new V._,e.type=h.O.Card,t.forEach((t=>{this.isNullOrWhitespace(t.value)||"section"===t.type||"ccType"===t.type||("ccName"===t.type&&this.isNullOrWhitespace(e.card.cardholderName)?e.card.cardholderName=t.value:"ccNumber"===t.type&&this.isNullOrWhitespace(e.card.number)?(e.card.number=t.value,e.card.brand=V._.getCardBrandByPatterns(e.card.number)):"ccCvc"===t.type&&this.isNullOrWhitespace(e.card.code)?e.card.code=t.value:"ccExpiry"===t.type&&this.isNullOrWhitespace(e.card.expYear)&&this.setCardExpiration(e,t.value)||this.processKvp(e,t.label,t.value,1===t.sensitive?x.fS.Hidden:x.fS.Text))}))}processNote(e,t){t.forEach((t=>{this.isNullOrWhitespace(t.value)||"section"===t.type||this.processKvp(e,t.label,t.value,1===t.sensitive?x.fS.Hidden:x.fS.Text)}))}buildFolderTree(e){if(null==e)return[];const t=[],s=new Map([]);return e.forEach((e=>{s.set(e.uuid,e),e.children=[]})),e.forEach((e=>{null!=e.parent_uuid&&""!==e.parent_uuid&&s.has(e.parent_uuid)?s.get(e.parent_uuid).children.push(e):t.push(e)})),t}flattenFolderTree(e,t,s){null!=t&&t.forEach((t=>{if(null!=t.title&&""!==t.title.trim()){let i=t.title.trim();null!=e&&""!==e.trim()&&(i=e+"/"+i),s.set(t.uuid,i),null!=t.children&&0!==t.children.length&&this.flattenFolderTree(i,t.children,s)}}))}}class ae extends D{parse(e){const t=new w,s=this.parseCsv(e,!0);return null==s?(t.success=!1,Promise.resolve(t)):(s.filter((e=>"chrome://FirefoxAccounts"!==e.url)).forEach((e=>{const s=this.initLoginCipher(),i=this.getValueOrDefault(e.url,this.getValueOrDefault(e.hostname));s.name=this.getValueOrDefault(this.nameFromUrl(i),"--"),s.login.username=this.getValueOrDefault(e.username),s.login.password=this.getValueOrDefault(e.password),s.login.uris=this.makeUriArray(i),this.cleanupCipher(s),t.ciphers.push(s)})),t.success=!0,Promise.resolve(t))}}var le;!function(e){e[e.Login=1]="Login",e[e.CreditCard=2]="CreditCard"}(le||(le={}));class ce extends D{parse(e){const t=new w,s=JSON.parse(e);if(null==s||null==s.data)return t.success=!1,Promise.resolve(t);for(const i in s.data){if(!s.data.hasOwnProperty(i))continue;const e=s.data[i],r=this.parseEntry(e);t.ciphers.push(r)}return t.success=!0,Promise.resolve(t)}parseEntry(e){const t=this.initLoginCipher();switch(t.name=this.getValueOrDefault(e.service),t.notes=this.getValueOrDefault(e.notes),t.favorite=e.favorite>0,e.type){case le.Login:this.handleLoginEntry(e,t);break;case le.CreditCard:this.handleCreditCardEntry(e,t);break;default:return}return this.convertToNoteIfNeeded(t),this.cleanupCipher(t),t}handleLoginEntry(e,t){t.login.username=this.getValueOrDefault(e.username),t.login.password=this.getValueOrDefault(e.password),t.login.uris=this.makeUriArray(e.url)}handleCreditCardEntry(e,t){t.type=h.O.Card,t.card=new V._,t.card.cardholderName=this.getValueOrDefault(e.username),t.card.number=this.getValueOrDefault(e.creditNumber),t.card.brand=V._.getCardBrandByPatterns(t.card.number),t.card.code=this.getValueOrDefault(e.creditCvv),this.isNullOrWhitespace(e.creditExpiry)||this.setCardExpiration(t,e.creditExpiry)||this.processKvp(t,"Expiration",e.creditExpiry),this.isNullOrWhitespace(e.password)||this.processKvp(t,"PIN",e.password)}}class ue extends D{parse(e){const t=new w,s=JSON.parse(e);if(null==s||0===Object.keys(s).length)return t.success=!1,Promise.resolve(t);for(const i in s)s.hasOwnProperty(i)&&!this.isNullOrWhitespace(i)&&0!==s[i].length&&s[i].forEach((e=>{if(this.isNullOrWhitespace(e.display_name)||0!==e.display_name.indexOf("http"))return;this.processFolder(t,i);const s=this.initLoginCipher();if(s.name=e.display_name.replace("http://","").replace("https://",""),s.name.length>30&&(s.name=s.name.substring(0,30)),s.login.password=this.getValueOrDefault(e.secret),s.login.uris=this.makeUriArray(e.display_name),null!=e.attributes){s.login.username=null!=e.attributes?this.getValueOrDefault(e.attributes.username_value):null;for(const t in e.attributes)e.attributes.hasOwnProperty(t)&&"username_value"!==t&&"xdg:schema"!==t&&this.processKvp(s,t,e.attributes[t])}this.convertToNoteIfNeeded(s),this.cleanupCipher(s),t.ciphers.push(s)}));return this.organization&&this.moveFoldersToCollections(t),t.success=!0,Promise.resolve(t)}}const pe="Notes\n\n",he="Applications\n\n",de="Websites\n\n",me="\n---\n";class fe extends D{parse(e){const t=new w;let s,i,r,n=this.splitNewLine(e).join("\n");if(-1!==n.indexOf(pe)){const e=n.split(pe);e.length>1&&(n=e[0],s=e[1])}if(-1!==n.indexOf(he)){const e=n.split(he);e.length>1&&(n=e[0],i=e[1])}if(0===n.indexOf(de)){const e=n.split(de);e.length>1&&(n=e[0],r=e[1])}const o=this.parseDataCategory(s),a=this.parseDataCategory(i),l=this.parseDataCategory(r);return o.forEach((e=>{const s=this.initLoginCipher();s.name=this.getValueOrDefault(e.get("Name")),s.notes=this.getValueOrDefault(e.get("Text")),this.cleanupCipher(s),t.ciphers.push(s)})),l.concat(a).forEach((e=>{const s=this.initLoginCipher(),i=e.has("Website name")?"Website name":"Application";s.name=this.getValueOrDefault(e.get(i),""),this.isNullOrWhitespace(e.get("Login name"))||(this.isNullOrWhitespace(s.name)||(s.name+=": "),s.name+=e.get("Login name")),s.notes=this.getValueOrDefault(e.get("Comment")),e.has("Website URL")&&(s.login.uris=this.makeUriArray(e.get("Website URL"))),s.login.username=this.getValueOrDefault(e.get("Login")),s.login.password=this.getValueOrDefault(e.get("Password")),this.cleanupCipher(s),t.ciphers.push(s)})),t.success=!0,Promise.resolve(t)}parseDataCategory(e){if(this.isNullOrWhitespace(e)||-1===e.indexOf(me))return[];const t=[];return e.split(me).forEach((e=>{if(-1===e.indexOf("\n"))return;const s=new Map;let i,r;e.split("\n").forEach((e=>{if(null!=i)return void(i+="\n"+e);const t=e.indexOf(":");let n,o;-1!==t&&(n=e.substring(0,t),e.length>t+1&&(o=e.substring(t+2)),null!=n&&s.set(n,o),"Comment"!==n&&"Text"!==n||(i=o,r=n))})),null!=i&&null!=r&&s.set(r,i),0!==s.size&&t.push(s)})),t}}class ge extends D{constructor(){super(...arguments),this.result=new w}parse(e){const t=this.parseXml(e);if(null==t)return this.result.success=!1,Promise.resolve(this.result);const s=t.querySelector("KeePassFile");if(null==s)return this.result.errorMessage="Missing `KeePassFile` node.",this.result.success=!1,Promise.resolve(this.result);const i=s.querySelector("Root");if(null==i)return this.result.errorMessage="Missing `KeePassFile > Root` node.",this.result.success=!1,Promise.resolve(this.result);const r=i.querySelector("Group");return null==r?(this.result.errorMessage="Missing `KeePassFile > Root > Group` node.",this.result.success=!1,Promise.resolve(this.result)):(this.traverse(r,!0,""),this.organization&&this.moveFoldersToCollections(this.result),this.result.success=!0,Promise.resolve(this.result))}traverse(e,t,s){const i=this.result.folders.length;let r=s;if(!t){""!==r&&(r+="/");const t=this.querySelectorDirectChild(e,"Name");r+=null==t?"-":t.textContent;const s=new v.a;s.name=r,this.result.folders.push(s)}this.querySelectorAllDirectChild(e,"Entry").forEach((e=>{const s=this.result.ciphers.length,r=this.initLoginCipher();this.querySelectorAllDirectChild(e,"String").forEach((e=>{const t=this.querySelectorDirectChild(e,"Value"),s=null!=t?t.textContent:null;if(this.isNullOrWhitespace(s))return;const i=this.querySelectorDirectChild(e,"Key"),n=null!=i?i.textContent:null;if("URL"===n)r.login.uris=this.makeUriArray(s);else if("UserName"===n)r.login.username=s;else if("Password"===n)r.login.password=s;else if("otp"===n)r.login.totp=s.replace("key=","");else if("Title"===n)r.name=s;else if("Notes"===n)r.notes+=s+"\n";else{let e=x.fS.Text;const i=t.attributes;i.length>0&&null!=i.ProtectInMemory&&"True"===i.ProtectInMemory.value&&(e=x.fS.Hidden),this.processKvp(r,n,s,e)}})),this.cleanupCipher(r),this.result.ciphers.push(r),t||this.result.folderRelationships.push([s,i])})),this.querySelectorAllDirectChild(e,"Group").forEach((e=>{this.traverse(e,!1,r)}))}}class ye extends D{parse(e){const t=new w,s=this.parseCsv(e,!0);return null==s?(t.success=!1,Promise.resolve(t)):(s.forEach((e=>{if(this.isNullOrWhitespace(e.Title))return;e.Group=!this.isNullOrWhitespace(e.Group)&&e.Group.startsWith("Root/")?e.Group.replace("Root/",""):e.Group;const s=this.isNullOrWhitespace(e.Group)?null:e.Group;this.processFolder(t,s);const i=this.initLoginCipher();i.notes=this.getValueOrDefault(e.Notes),i.name=this.getValueOrDefault(e.Title,"--"),i.login.username=this.getValueOrDefault(e.Username),i.login.password=this.getValueOrDefault(e.Password),i.login.uris=this.makeUriArray(e.URL),this.cleanupCipher(i),t.ciphers.push(i)})),this.organization&&this.moveFoldersToCollections(t),t.success=!0,Promise.resolve(t))}}class ve extends D{parse(e){const t=new w,s=this.parseCsv(e,!1);return null==s?(t.success=!1,Promise.resolve(t)):(s.forEach((e=>{if(e.length<6)return;this.processFolder(t,e[0]);const s=this.initLoginCipher(),i=this.getValueOrDefault(e[5]);if(i&&(s.notes=`${i}\n`),s.name=this.getValueOrDefault(e[1],"--"),s.login.username=this.getValueOrDefault(e[2]),s.login.password=this.getValueOrDefault(e[3]),s.login.uris=this.makeUriArray(e[4]),e.length>7)for(let t=7;t<e.length;t+=2)"TFC:Keeper"==e[t]?s.login.totp=e[t+1]:this.processKvp(s,e[t],e[t+1]);this.cleanupCipher(s),t.ciphers.push(s)})),this.organization&&this.moveFoldersToCollections(t),t.success=!0,Promise.resolve(t))}}class we extends D{parse(e){const t=new w,s=this.parseCsv(e,!0);return null==s?(t.success=!1,Promise.resolve(t)):(s.forEach((e=>{const s=t.ciphers.length;let i=t.folders.length,r=e.grouping;null!=r&&(r=r.replace(/\\/g,"/").replace(/[\x00-\x1F\x7F-\x9F]/g,""));const n="(none)"!==this.getValueOrDefault(r,"(none)");let o=n;if(n)for(let l=0;l<t.folders.length;l++)if(t.folders[l].name===r){o=!1,i=l;break}const a=this.buildBaseCipher(e);if(a.type===h.O.Login)a.notes=this.getValueOrDefault(e.extra),a.login=new U.q,a.login.uris=this.makeUriArray(e.url),a.login.username=this.getValueOrDefault(e.username),a.login.password=this.getValueOrDefault(e.password),a.login.totp=this.getValueOrDefault(e.totp);else if(a.type===h.O.SecureNote)this.parseSecureNote(e,a);else if(a.type===h.O.Card)a.card=this.parseCard(e),a.notes=this.getValueOrDefault(e.notes);else if(a.type===h.O.Identity&&(a.identity=this.parseIdentity(e),a.notes=this.getValueOrDefault(e.notes),!this.isNullOrWhitespace(e.ccnum))){const s=this.buildBaseCipher(e);s.identity=null,s.type=h.O.Card,s.card=this.parseCard(e),t.ciphers.push(s)}if(t.ciphers.push(a),o){const e=new v.a;e.name=r,t.folders.push(e)}n&&t.folderRelationships.push([s,i])})),this.organization&&this.moveFoldersToCollections(t),t.success=!0,Promise.resolve(t))}buildBaseCipher(e){const t=new _.$;return e.hasOwnProperty("profilename")&&e.hasOwnProperty("profilelanguage")?(t.favorite=!1,t.name=this.getValueOrDefault(e.profilename,"--"),t.type=h.O.Card,this.isNullOrWhitespace(e.title)&&this.isNullOrWhitespace(e.firstname)&&this.isNullOrWhitespace(e.lastname)&&this.isNullOrWhitespace(e.address1)&&this.isNullOrWhitespace(e.phone)&&this.isNullOrWhitespace(e.username)&&this.isNullOrWhitespace(e.email)||(t.type=h.O.Identity)):(t.favorite=!this.organization&&"1"===this.getValueOrDefault(e.fav,"0"),t.name=this.getValueOrDefault(e.name,"--"),t.type="http://sn"===e.url?h.O.SecureNote:h.O.Login),t}parseCard(e){const t=new V._;if(t.cardholderName=this.getValueOrDefault(e.ccname),t.number=this.getValueOrDefault(e.ccnum),t.code=this.getValueOrDefault(e.cccsc),t.brand=V._.getCardBrandByPatterns(t.number),!this.isNullOrWhitespace(e.ccexp)&&e.ccexp.indexOf("-")>-1){const s=e.ccexp.split("-");s.length>1&&(t.expYear=s[0],t.expMonth=s[1],2===t.expMonth.length&&"0"===t.expMonth[0]&&(t.expMonth=t.expMonth[1]))}return t}parseIdentity(e){const t=new G.t;return t.title=this.getValueOrDefault(e.title),t.firstName=this.getValueOrDefault(e.firstname),t.middleName=this.getValueOrDefault(e.middlename),t.lastName=this.getValueOrDefault(e.lastname),t.username=this.getValueOrDefault(e.username),t.company=this.getValueOrDefault(e.company),t.ssn=this.getValueOrDefault(e.ssn),t.address1=this.getValueOrDefault(e.address1),t.address2=this.getValueOrDefault(e.address2),t.address3=this.getValueOrDefault(e.address3),t.city=this.getValueOrDefault(e.city),t.state=this.getValueOrDefault(e.state),t.postalCode=this.getValueOrDefault(e.zip),t.country=this.getValueOrDefault(e.country),t.email=this.getValueOrDefault(e.email),t.phone=this.getValueOrDefault(e.phone),this.isNullOrWhitespace(t.title)||(t.title=t.title.charAt(0).toUpperCase()+t.title.slice(1)),t}parseSecureNote(e,t){const s=this.splitNewLine(e.extra);let i=!1;if(s.length){const e=s[0].split(":");if(e.length>1&&"NoteType"===e[0]&&("Credit Card"===e[1]||"Address"===e[1])){if("Credit Card"===e[1]){const e=this.parseSecureNoteMapping(t,s,{Number:"number","Name on Card":"cardholderName","Security Code":"code","Expiration Date":"expMonth"});if(this.isNullOrWhitespace(e.expMonth)||","===e.expMonth)e.expMonth=void 0;else{const[t,s]=e.expMonth.split(",");if(this.isNullOrWhitespace(t))e.expMonth=void 0;else{const s=new Date(Date.parse(t.trim()+" 1, 2012")).getMonth()+1;isNaN(s)?e.expMonth=void 0:e.expMonth=s.toString()}this.isNullOrWhitespace(s)||(e.expYear=s)}t.type=h.O.Card,t.card=e}else if("Address"===e[1]){const e=this.parseSecureNoteMapping(t,s,{Title:"title","First Name":"firstName","Last Name":"lastName","Middle Name":"middleName",Company:"company","Address 1":"address1","Address 2":"address2","Address 3":"address3","City / Town":"city",State:"state","Zip / Postal Code":"postalCode",Country:"country","Email Address":"email",Username:"username"});t.type=h.O.Identity,t.identity=e}i=!0}}i||(t.secureNote=new S.z,t.secureNote.type=x.xs.Generic,t.notes=this.getValueOrDefault(e.extra))}parseSecureNoteMapping(e,t,s){const i={};let r=!1;return t.forEach((t=>{let n=null,o=null;if(!r){if(this.isNullOrWhitespace(t))return;const e=t.indexOf(":");if(-1===e?n=t:(n=t.substring(0,e),t.length>e&&(o=t.substring(e+1))),this.isNullOrWhitespace(n)||this.isNullOrWhitespace(o)||"NoteType"===n)return}r?e.notes+="\n"+t:"Notes"===n?(this.isNullOrWhitespace(e.notes)?e.notes=o:e.notes+="\n"+o,r=!0):s.hasOwnProperty(n)?i[s[n]]=o:this.processKvp(e,n,o)})),i}}class Oe extends D{parse(e){const t=new w,s=this.parseCsv(e,!1);return null==s?(t.success=!1,Promise.resolve(t)):(s.forEach((e=>{if(e.length<4)return;const s=this.initLoginCipher();s.name=this.getValueOrDefault(e[0],"--"),s.login.username=this.getValueOrDefault(e[2]),s.login.password=this.getValueOrDefault(e[3]),s.login.uris=this.makeUriArray(e[1]),this.cleanupCipher(s),t.ciphers.push(s)})),t.success=!0,Promise.resolve(t))}}class xe extends D{parse(e){const t=new w,s=this.parseCsv(e,!0);return null==s?(t.success=!1,Promise.resolve(t)):(s.forEach((e=>{const s=this.initLoginCipher();s.name=this.getValueOrDefault(e.DisplayName,"--"),s.notes=this.getValueOrDefault(e.Notes),s.login.username=this.getValueOrDefault(e.UserName),s.login.password=this.getValueOrDefault(e.Password),s.login.uris=this.makeUriArray(e.Url),this.cleanupCipher(s),t.ciphers.push(s)})),t.success=!0,Promise.resolve(t))}}class Ne extends D{parse(e){const t=new w,s=this.parseCsv(e,!1);return null==s?(t.success=!1,Promise.resolve(t)):(s.forEach((e=>{if(e.length<3)return;const s="Unassigned"!==this.getValueOrDefault(e[0],"Unassigned")?e[0]:null;this.processFolder(t,s);const i=this.initLoginCipher();if(i.name=this.getValueOrDefault(e[2],"--"),"Web Logins"===e[1]||"Login"===e[1])i.login.uris=this.makeUriArray(e[4]),i.login.username=this.getValueOrDefault(e[5]),i.login.password=this.getValueOrDefault(e[6]),i.notes=this.isNullOrWhitespace(e[3])?null:e[3].split("\\n").join("\n");else if(e.length>3){i.type=h.O.SecureNote,i.secureNote=new S.z,i.secureNote.type=x.xs.Generic;for(let t=3;t<e.length;t++)this.isNullOrWhitespace(e[t])||(i.notes+=e[t]+"\n")}this.isNullOrWhitespace(e[1])||i.type===h.O.Login||(i.name=e[1]+": "+i.name),this.cleanupCipher(i),t.ciphers.push(i)})),this.organization&&this.moveFoldersToCollections(t),t.success=!0,Promise.resolve(t))}}const _e=["nickname","additionalInfo"],be=new Set(_e.concat(["url","username","password","twofaSecret"])),Ce=new Set(_e.concat(["cardNumber","cardName","exp_month","exp_year","cvv"])),Ue=new Set(_e.concat(["title","firstName","middleName","lastName","email","firstAddressLine","secondAddressLine","city","country","zipCode"])),Se=new Set(_e.concat(["idName","idNumber","idCountry"])),De=new Set(_e.concat(["authToken"])),ke=new Set(_e.concat(["content"]));class Pe extends D{parse(e){const t=new w,s=this.parseCsv(e,!0);return null==s?(t.success=!1,Promise.resolve(t)):(s.forEach((e=>{const s=this.initLoginCipher();if(s.name=this.getValueOrDefault(e.nickname,"--"),s.notes=this.getValueOrDefault(e.additionalInfo),void 0!==e.url)s.login.uris=this.makeUriArray(e.url),s.login.username=this.getValueOrDefault(e.username),s.login.password=this.getValueOrDefault(e.password),s.login.totp=this.getValueOrDefault(e.twofaSecret),this.importUnmappedFields(s,e,be);else if(void 0!==e.authToken)s.login.totp=this.getValueOrDefault(e.authToken),this.importUnmappedFields(s,e,De);else if(void 0!==e.cardNumber)s.card=new V._,s.type=h.O.Card,s.card.cardholderName=this.getValueOrDefault(e.cardName),s.card.number=this.getValueOrDefault(e.cardNumber),s.card.brand=V._.getCardBrandByPatterns(s.card.number),s.card.expMonth=this.getValueOrDefault(e.exp_month),s.card.expYear=this.getValueOrDefault(e.exp_year),s.card.code=this.getValueOrDefault(e.cvv),this.importUnmappedFields(s,e,Ce);else if(void 0!==e.firstName)s.identity=new G.t,s.type=h.O.Identity,s.identity.title=this.getValueOrDefault(e.title),s.identity.firstName=this.getValueOrDefault(e.firstName),s.identity.middleName=this.getValueOrDefault(e.middleName),s.identity.lastName=this.getValueOrDefault(e.lastName),s.identity.phone=this.getValueOrDefault(e.number),s.identity.email=this.getValueOrDefault(e.email),s.identity.address1=this.getValueOrDefault(e.firstAddressLine),s.identity.address2=this.getValueOrDefault(e.secondAddressLine),s.identity.city=this.getValueOrDefault(e.city),s.identity.country=this.getValueOrDefault(e.country),s.identity.postalCode=this.getValueOrDefault(e.zipCode),this.importUnmappedFields(s,e,Ue);else if(void 0!==e.idType){switch(s.identity=new G.t,s.type=h.O.Identity,this.processFullName(s,e.idName),s.identity.country=this.getValueOrDefault(e.idCountry),e.idType){case"Passport":s.identity.passportNumber=e.idNumber;break;case"Social Security":s.identity.ssn=e.idNumber;break;default:s.identity.licenseNumber=e.idNumber}this.importUnmappedFields(s,e,Se)}else{if(void 0===e.content)return;s.secureNote=new S.z,s.type=h.O.SecureNote,s.secureNote.type=x.xs.Generic,s.notes=this.getValueOrDefault(e.content),this.importUnmappedFields(s,e,ke)}this.cleanupCipher(s),t.ciphers.push(s)})),t.success=!0,Promise.resolve(t))}importUnmappedFields(e,t,s){Object.keys(t).filter((e=>!s.has(e))).forEach((s=>{const i=t;this.processKvp(e,s,i[s])}))}}class Ve extends D{parse(e){const t=new w,s=this.parseCsv(e,!0);return null==s?(t.success=!1,Promise.resolve(t)):(s.forEach((e=>{const s=this.evaluateType(e);if(void 0===s)return;this.organization||this.processFolder(t,e.folder);const i=new _.$;switch(i.name=this.getValueOrDefault(e.name,"--"),i.notes=this.getValueOrDefault(e.note),s){case h.O.Login:i.type=h.O.Login,i.login=new U.q,i.login.username=this.getValueOrDefault(e.username),i.login.password=this.getValueOrDefault(e.password),i.login.uris=this.makeUriArray(e.url);break;case h.O.Card:i.type=h.O.Card,i.card.cardholderName=this.getValueOrDefault(e.cardholdername),i.card.number=this.getValueOrDefault(e.cardnumber),i.card.code=this.getValueOrDefault(e.cvc),i.card.brand=V._.getCardBrandByPatterns(i.card.number),this.setCardExpiration(i,e.expirydate);break;case h.O.Identity:i.type=h.O.Identity,this.processFullName(i,this.getValueOrDefault(e.full_name)),i.identity.address1=this.getValueOrDefault(e.address1),i.identity.address2=this.getValueOrDefault(e.address2),i.identity.city=this.getValueOrDefault(e.city),i.identity.state=this.getValueOrDefault(e.state),i.identity.postalCode=this.getValueOrDefault(e.zipcode),i.identity.country=this.getValueOrDefault(e.country),null!=i.identity.country&&(i.identity.country=i.identity.country.toUpperCase()),i.identity.email=this.getValueOrDefault(e.email),i.identity.phone=this.getValueOrDefault(e.phone_number);break;case h.O.SecureNote:i.type=h.O.SecureNote,i.secureNote.type=x.xs.Generic}this.cleanupCipher(i),t.ciphers.push(i)})),this.organization&&this.moveFoldersToCollections(t),t.success=!0,Promise.resolve(t))}evaluateType(e){return this.isNullOrWhitespace(e.username)?this.isNullOrWhitespace(e.cardnumber)?this.isNullOrWhitespace(e.full_name)?this.isNullOrWhitespace(e.note)?void 0:h.O.SecureNote:h.O.Identity:h.O.Card:h.O.Login}}var Ae,Ee,Ie=s(42937);class Te extends D{constructor(){super(...arguments),this.result=new w}parse(e){return e.split(this.newLineRegex).forEach((e=>{if(this.isNullOrWhitespace(e)||"{"!==e[0])return;const t=JSON.parse(e);if(!0===t.trashed)return;const s=this.initLoginCipher();this.isNullOrWhitespace(t.hmac)?this.processStandardItem(t,s):this.processWinOpVaultItem(t,s),this.convertToNoteIfNeeded(s),this.cleanupCipher(s),this.result.ciphers.push(s)})),this.result.success=!0,Promise.resolve(this.result)}processWinOpVaultItem(e,t){if(null!=e.overview&&(t.name=this.getValueOrDefault(e.overview.title),null!=e.overview.URLs)){const s=[];e.overview.URLs.forEach((e=>{this.isNullOrWhitespace(e.u)||s.push(e.u)})),t.login.uris=this.makeUriArray(s)}null!=e.details&&(null!=e.details.passwordHistory&&this.parsePasswordHistory(e.details.passwordHistory,t),this.isNullOrWhitespace(e.details.ccnum)&&this.isNullOrWhitespace(e.details.cvv)?this.isNullOrWhitespace(e.details.firstname)&&this.isNullOrWhitespace(e.details.address1)||(t.type=h.O.Identity,t.identity=new G.t):(t.type=h.O.Card,t.card=new V._),t.type!==h.O.Login||this.isNullOrWhitespace(e.details.password)||(t.login.password=e.details.password),this.isNullOrWhitespace(e.details.notesPlain)||(t.notes=e.details.notesPlain.split(this.newLineRegex).join("\n")+"\n"),null!=e.details.fields&&this.parseFields(e.details.fields,t,"designation","value","name"),null!=e.details.sections&&e.details.sections.forEach((e=>{null!=e.fields&&this.parseFields(e.fields,t,"n","v","t")})))}processStandardItem(e,t){if(t.favorite=!(!e.openContents||!e.openContents.faveIndex),t.name=this.getValueOrDefault(e.title),"securenotes.SecureNote"===e.typeName?(t.type=h.O.SecureNote,t.secureNote=new S.z,t.secureNote.type=x.xs.Generic):"wallet.financial.CreditCard"===e.typeName?(t.type=h.O.Card,t.card=new V._):"identities.Identity"===e.typeName?(t.type=h.O.Identity,t.identity=new G.t):t.login.uris=this.makeUriArray(e.location),null!=e.secureContents){if(null!=e.secureContents.passwordHistory&&this.parsePasswordHistory(e.secureContents.passwordHistory,t),this.isNullOrWhitespace(e.secureContents.notesPlain)||(t.notes=e.secureContents.notesPlain.split(this.newLineRegex).join("\n")+"\n"),t.type===h.O.Login&&(this.isNullOrWhitespace(e.secureContents.password)||(t.login.password=e.secureContents.password),null!=e.secureContents.URLs)){const s=[];e.secureContents.URLs.forEach((e=>{this.isNullOrWhitespace(e.url)||s.push(e.url)})),s.length>0&&(t.login.uris=this.makeUriArray(s))}null!=e.secureContents.fields&&this.parseFields(e.secureContents.fields,t,"designation","value","name"),null!=e.secureContents.sections&&e.secureContents.sections.forEach((e=>{null!=e.fields&&this.parseFields(e.fields,t,"n","v","t")}))}}parsePasswordHistory(e,t){const s=e.length>5?5:e.length;t.passwordHistory=e.filter((e=>!this.isNullOrWhitespace(e.value)&&null!=e.time)).sort(((e,t)=>t.time-e.time)).slice(0,s).map((e=>{const t=new Ie.i;return t.password=e.value,t.lastUsedDate=new Date((""+e.time).length>=13?e.time:1e3*e.time),t}))}parseFields(e,t,s,i,r){e.forEach((e=>{if(null==e[i]||""===e[i].toString().trim())return;const n="date"===e.k?new Date(1e3*e[i]).toUTCString():e[i].toString(),o=null!=e[s]?e[s].toString():null;if(t.type===h.O.Login){if(this.isNullOrWhitespace(t.login.username)&&"username"===o)return void(t.login.username=n);if(this.isNullOrWhitespace(t.login.password)&&"password"===o)return void(t.login.password=n);if(this.isNullOrWhitespace(t.login.totp)&&null!=o&&o.startsWith("TOTP_"))return void(t.login.totp=n)}else if(t.type===h.O.Card){if(this.isNullOrWhitespace(t.card.number)&&"ccnum"===o)return t.card.number=n,void(t.card.brand=V._.getCardBrandByPatterns(t.card.number));if(this.isNullOrWhitespace(t.card.code)&&"cvv"===o)return void(t.card.code=n);if(this.isNullOrWhitespace(t.card.cardholderName)&&"cardholder"===o)return void(t.card.cardholderName=n);if(this.isNullOrWhitespace(t.card.expiration)&&"expiry"===o&&6===n.length)return t.card.expMonth=n.substr(4,2),"0"===t.card.expMonth[0]&&(t.card.expMonth=t.card.expMonth.substr(1,1)),void(t.card.expYear=n.substr(0,4));if("type"===o)return}else if(t.type===h.O.Identity){const s=t.identity;if(this.isNullOrWhitespace(s.firstName)&&"firstname"===o)return void(s.firstName=n);if(this.isNullOrWhitespace(s.lastName)&&"lastname"===o)return void(s.lastName=n);if(this.isNullOrWhitespace(s.middleName)&&"initial"===o)return void(s.middleName=n);if(this.isNullOrWhitespace(s.phone)&&"defphone"===o)return void(s.phone=n);if(this.isNullOrWhitespace(s.company)&&"company"===o)return void(s.company=n);if(this.isNullOrWhitespace(s.email)&&"email"===o)return void(s.email=n);if(this.isNullOrWhitespace(s.username)&&"username"===o)return void(s.username=n);if("address"===o){const{street:t,city:r,country:n,zip:o}=e[i];return s.address1=this.getValueOrDefault(t),s.city=this.getValueOrDefault(r),this.isNullOrWhitespace(n)||(s.country=n.toUpperCase()),void(s.postalCode=this.getValueOrDefault(o))}}const a=this.isNullOrWhitespace(e[r])?"no_name":e[r];if("password"===a&&null!=t.passwordHistory&&t.passwordHistory.some((e=>e.password===n)))return;const l="concealed"===e.k?x.fS.Hidden:x.fS.Text;this.processKvp(t,a,n,l)}))}}!function(e){e.Login="001",e.CreditCard="002",e.SecureNote="003",e.Identity="004",e.Password="005",e.Document="006",e.SoftwareLicense="100",e.BankAccount="101",e.Database="102",e.DriversLicense="103",e.OutdoorLicense="104",e.Membership="105",e.Passport="106",e.RewardsProgram="107",e.SocialSecurityNumber="108",e.WirelessRouter="109",e.Server="110",e.EmailAccount="111",e.API_Credential="112",e.MedicalRecord="113"}(Ae||(Ae={})),function(e){e.TextOrHtml="T",e.EmailAddress="E",e.URL="U",e.Number="N",e.Password="P",e.TextArea="A",e.PhoneNumber="T",e.CheckBox="C"}(Ee||(Ee={}));class Fe extends D{constructor(){super(...arguments),this.result=new w}parse(e){return JSON.parse(e).accounts[0].vaults.forEach((e=>{e.items.forEach((e=>{if(!0===e.trashed)return;const t=this.initLoginCipher(),s=e.categoryUuid;switch(s){case Ae.Login:case Ae.Database:case Ae.Password:case Ae.WirelessRouter:case Ae.Server:case Ae.API_Credential:t.type=h.O.Login,t.login=new U.q;break;case Ae.CreditCard:case Ae.BankAccount:t.type=h.O.Card,t.card=new V._;break;case Ae.SecureNote:case Ae.SoftwareLicense:case Ae.EmailAccount:case Ae.MedicalRecord:t.type=h.O.SecureNote,t.secureNote=new S.z,t.secureNote.type=x.xs.Generic;break;case Ae.Identity:case Ae.DriversLicense:case Ae.OutdoorLicense:case Ae.Membership:case Ae.Passport:case Ae.RewardsProgram:case Ae.SocialSecurityNumber:t.type=h.O.Identity,t.identity=new G.t}t.favorite=1===e.favIndex,this.processOverview(e.overview,t),this.processLoginFields(e,t),this.processDetails(s,e.details,t),this.parsePasswordHistory(e.details.passwordHistory,t),this.processSections(s,e.details.sections,t),this.isNullOrWhitespace(e.details.notesPlain)||(t.notes=e.details.notesPlain.split(this.newLineRegex).join("\n")+"\n"),this.convertToNoteIfNeeded(t),this.cleanupCipher(t),this.result.ciphers.push(t)}))})),this.organization&&this.moveFoldersToCollections(this.result),this.result.success=!0,Promise.resolve(this.result)}processOverview(e,t){if(null!=e){if(t.name=this.getValueOrDefault(e.title),null!=e.urls){const s=[];e.urls.forEach((e=>{this.isNullOrWhitespace(e.url)||s.push(e.url)})),t.login.uris=this.makeUriArray(s)}if(null!=e.tags&&e.tags.length>0){const t=this.capitalize(e.tags[0]);this.processFolder(this.result,t)}}}capitalize(e){return e.trim().replace(/\w\S*/g,(e=>e.replace(/^\w/,(e=>e.toUpperCase()))))}processLoginFields(e,t){null!=e.details&&null!=e.details.loginFields&&0!==e.details.loginFields.length&&e.details.loginFields.forEach((e=>{if("username"===e.designation&&""!==e.value)return t.type=h.O.Login,void(t.login.username=e.value);if("password"===e.designation&&""!==e.value)return t.type=h.O.Login,void(t.login.password=e.value);let s=e.value,i=x.fS.Text;switch(e.fieldType){case Ee.Password:i=x.fS.Hidden;break;case Ee.CheckBox:s=""!==e.value?"true":"false",i=x.fS.Boolean}this.processKvp(t,e.name,s,i)}))}processDetails(e,t,s){e===Ae.Password&&null!=t&&(s.login.password=t.password)}processSections(e,t,s){null!=t&&0!==t.length&&t.forEach((t=>{null!=t.fields&&this.parseSectionFields(e,t.fields,s)}))}parseSectionFields(e,t,s){t.forEach((t=>{const i=Object.keys(t.value)[0],r=t;if(null==r.value||null==r.value[i]||""===r.value[i])return;const n=this.getFieldName(t.id,t.title),o=this.extractValue(t.value,i);if(s.type===h.O.Login){if(this.fillLogin(t,o,s))return;switch(e){case Ae.Login:case Ae.Database:case Ae.EmailAccount:case Ae.WirelessRouter:break;case Ae.Server:if(this.isNullOrWhitespace(s.login.uri)&&"url"===t.id)return void(s.login.uris=this.makeUriArray(o));break;case Ae.API_Credential:if(this.fillApiCredentials(t,o,s))return}}else if(s.type===h.O.Card){if(this.fillCreditCard(t,o,s))return;if(e===Ae.BankAccount&&this.fillBankAccount(t,o,s))return}else if(s.type===h.O.Identity){if(this.fillIdentity(t,o,s,i))return;if("address"===i){const{street:e,city:i,country:r,zip:n,state:o}=t.value.address;return s.identity.address1=this.getValueOrDefault(e),s.identity.city=this.getValueOrDefault(i),this.isNullOrWhitespace(r)||(s.identity.country=r.toUpperCase()),s.identity.postalCode=this.getValueOrDefault(n),void(s.identity.state=this.getValueOrDefault(o))}switch(e){case Ae.Identity:break;case Ae.DriversLicense:if(this.fillDriversLicense(t,o,s))return;break;case Ae.OutdoorLicense:if(this.fillOutdoorLicense(t,o,s))return;break;case Ae.Membership:if(this.fillMembership(t,o,s))return;break;case Ae.Passport:if(this.fillPassport(t,o,s))return;break;case Ae.RewardsProgram:if(this.fillRewardsProgram(t,o,s))return;break;case Ae.SocialSecurityNumber:if(this.fillSSN(t,o,s))return}}if("email"===i){const{email_address:e,provider:i}=t.value.email;return this.processKvp(s,n,e,x.fS.Text),void this.processKvp(s,"provider",i,x.fS.Text)}if("password"===t.title&&null!=s.passwordHistory&&s.passwordHistory.some((e=>e.password===o)))return;t.guarded&&s.reprompt===F.N.None&&(s.reprompt=F.N.Password);const a="concealed"===i?x.fS.Hidden:x.fS.Text;this.processKvp(s,n,o,a)}))}getFieldName(e,t){return this.isNullOrWhitespace(t)?e:e.length>25&&RegExp(/[0-9]{2}[A-Z]{2}/,"i").test(e)?t:e}extractValue(e,t){return"date"===t?new Date(1e3*e.date).toUTCString():"monthYear"===t?e.monthYear.toString():e[t]}fillLogin(e,t,s){const i=this.getFieldName(e.id,e.title);return this.isNullOrWhitespace(s.login.username)&&"username"===i?(s.login.username=t,!0):this.isNullOrWhitespace(s.login.password)&&"password"===i?(s.login.password=t,!0):!(!this.isNullOrWhitespace(s.login.totp)||null==e.id||!e.id.startsWith("TOTP_"))&&(s.login.totp=t,!0)}fillApiCredentials(e,t,s){const i=this.getFieldName(e.id,e.title);return this.isNullOrWhitespace(s.login.password)&&"credential"===i?(s.login.password=t,!0):!(!this.isNullOrWhitespace(s.login.uri)||"hostname"!==i)&&(s.login.uris=this.makeUriArray(t),!0)}fillCreditCard(e,t,s){if(this.isNullOrWhitespace(s.card.number)&&"ccnum"===e.id)return s.card.number=t,s.card.brand=V._.getCardBrandByPatterns(s.card.number),!0;if(this.isNullOrWhitespace(s.card.code)&&"cvv"===e.id)return s.card.code=t,!0;if(this.isNullOrWhitespace(s.card.cardholderName)&&"cardholder"===e.id)return s.card.cardholderName=t,!0;if(this.isNullOrWhitespace(s.card.expiration)&&"expiry"===e.id){const e=t.toString().trim();return s.card.expMonth=e.substring(4,6),"0"===s.card.expMonth[0]&&(s.card.expMonth=s.card.expMonth.substring(1,2)),s.card.expYear=e.substring(0,4),!0}return"type"===e.id}fillBankAccount(e,t,s){return!(!this.isNullOrWhitespace(s.card.cardholderName)||"owner"!==e.id)&&(s.card.cardholderName=t,!0)}fillIdentity(e,t,s,i){if(this.isNullOrWhitespace(s.identity.firstName)&&"firstname"===e.id)return s.identity.firstName=t,!0;if(this.isNullOrWhitespace(s.identity.lastName)&&"lastname"===e.id)return s.identity.lastName=t,!0;if(this.isNullOrWhitespace(s.identity.middleName)&&"initial"===e.id)return s.identity.middleName=t,!0;if(this.isNullOrWhitespace(s.identity.phone)&&"defphone"===e.id)return s.identity.phone=t,!0;if(this.isNullOrWhitespace(s.identity.company)&&"company"===e.id)return s.identity.company=t,!0;if(this.isNullOrWhitespace(s.identity.email)){if("email"===i){const{email_address:t,provider:i}=e.value.email;return s.identity.email=this.getValueOrDefault(t),this.processKvp(s,"provider",i,x.fS.Text),!0}if("email"===e.id)return s.identity.email=t,!0}return!(!this.isNullOrWhitespace(s.identity.username)||"username"!==e.id)&&(s.identity.username=t,!0)}fillDriversLicense(e,t,s){return this.isNullOrWhitespace(s.identity.firstName)&&"fullname"===e.id?(this.processFullName(s,t),!0):this.isNullOrWhitespace(s.identity.address1)&&"address"===e.id?(s.identity.address1=t,!0):this.isNullOrWhitespace(s.identity.country)&&"country"===e.id?(s.identity.country=t,!0):this.isNullOrWhitespace(s.identity.state)&&"state"===e.id?(s.identity.state=t,!0):!(!this.isNullOrWhitespace(s.identity.licenseNumber)||"number"!==e.id)&&(s.identity.licenseNumber=t,!0)}fillOutdoorLicense(e,t,s){return this.isNullOrWhitespace(s.identity.firstName)&&"name"===e.id?(this.processFullName(s,t),!0):this.isNullOrWhitespace(s.identity.country)&&"country"===e.id?(s.identity.country=t,!0):!(!this.isNullOrWhitespace(s.identity.state)||"state"!==e.id)&&(s.identity.state=t,!0)}fillMembership(e,t,s){return this.isNullOrWhitespace(s.identity.firstName)&&"member_name"===e.id?(this.processFullName(s,t),!0):this.isNullOrWhitespace(s.identity.company)&&"org_name"===e.id?(s.identity.company=t,!0):!(!this.isNullOrWhitespace(s.identity.phone)||"phone"!==e.id)&&(s.identity.phone=t,!0)}fillPassport(e,t,s){return this.isNullOrWhitespace(s.identity.firstName)&&"fullname"===e.id?(this.processFullName(s,t),!0):this.isNullOrWhitespace(s.identity.country)&&"issuing_country"===e.id?(s.identity.country=t,!0):!(!this.isNullOrWhitespace(s.identity.passportNumber)||"number"!==e.id)&&(s.identity.passportNumber=t,!0)}fillRewardsProgram(e,t,s){return this.isNullOrWhitespace(s.identity.firstName)&&"member_name"===e.id?(this.processFullName(s,t),!0):!(!this.isNullOrWhitespace(s.identity.company)||"company_name"!==e.id)&&(s.identity.company=t,!0)}fillSSN(e,t,s){return this.isNullOrWhitespace(s.identity.firstName)&&"name"===e.id?(this.processFullName(s,t),!0):!(!this.isNullOrWhitespace(s.identity.ssn)||"number"!==e.id)&&(s.identity.ssn=t,!0)}parsePasswordHistory(e,t){if(null==e||0===e.length)return;const s=e.length>5?5:e.length;t.passwordHistory=e.filter((e=>!this.isNullOrWhitespace(e.value)&&null!=e.time)).sort(((e,t)=>t.time-e.time)).slice(0,s).map((e=>{const t=new Ie.i;return t.password=e.value,t.lastUsedDate=new Date((""+e.time).length>=13?e.time:1e3*e.time),t}))}}class Le{constructor(e,t,s){this.importRecord=e,this.property=t,this.cipher=s,this.lowerProperty=t.toLowerCase()}}const Ze=["ainfo","autosubmit","notesplain","ps","scope","tags","title","uuid","notes"];class We extends D{constructor(){super(...arguments),this.loginPropertyParsers=[this.setLoginUsername,this.setLoginPassword,this.setLoginUris],this.creditCardPropertyParsers=[this.setCreditCardNumber,this.setCreditCardVerification,this.setCreditCardCardholderName,this.setCreditCardExpiry],this.identityPropertyParsers=[this.setIdentityFirstName,this.setIdentityInitial,this.setIdentityLastName,this.setIdentityUserName,this.setIdentityEmail,this.setIdentityPhone,this.setIdentityCompany]}parse(e){const t=new w,s=this.parseCsv(e,!0,{quoteChar:'"',escapeChar:"\\"});return null==s?(t.success=!1,Promise.resolve(t)):(s.forEach((e=>{if(this.isNullOrWhitespace(this.getProp(e,"title")))return;const s=this.initLoginCipher();s.name=this.getValueOrDefault(this.getProp(e,"title"),"--"),this.setNotes(e,s),this.setCipherType(e,s);let i=null;for(const t in e){if(!e.hasOwnProperty(t)||this.isNullOrWhitespace(e[t]))continue;const r=new Le(e,t,s);s.type===h.O.Login&&this.setKnownLoginValue(r)||(s.type===h.O.Card&&this.setKnownCreditCardValue(r)||s.type===h.O.Identity&&this.setKnownIdentityValue(r)||(i=this.setUnknownValue(r,i)))}s.type===h.O.Login&&!this.isNullOrWhitespace(i)&&this.isNullOrWhitespace(s.login.username)&&-1===i.indexOf("://")&&(s.login.username=i),this.convertToNoteIfNeeded(s),this.cleanupCipher(s),t.ciphers.push(s)})),t.success=!0,Promise.resolve(t))}getProp(e,t){return Object.entries(e).reduce(((e,t)=>(e[t[0].toLowerCase()]=t[1],e)),{})[t.toLowerCase()]}getPropByRegexp(e,t){const s=Object.keys(e).reduce(((e,s)=>(s.match(t)&&e.push(s),e)),[]);return 0===s.length?null:e[s[0]]}getPropIncluding(e,t){const s=Object.keys(e).reduce(((e,s)=>(s.toLowerCase().includes(t.toLowerCase())&&e.push(s),e)),[]);return 0===s.length?null:e[s[0]]}setNotes(e,t){t.notes=this.getValueOrDefault(this.getProp(e,"notesPlain"),"")+"\n"+this.getValueOrDefault(this.getProp(e,"notes"),"")+"\n",t.notes.trim()}setKnownLoginValue(e){return this.loginPropertyParsers.reduce(((t,s)=>(t||(t=s.bind(this)(e)),t)),!1)}setKnownCreditCardValue(e){return this.creditCardPropertyParsers.reduce(((t,s)=>(t||(t=s.bind(this)(e)),t)),!1)}setKnownIdentityValue(e){return this.identityPropertyParsers.reduce(((t,s)=>(t||(t=s.bind(this)(e)),t)),!1)}setUnknownValue(e,t){if(-1===Ze.indexOf(e.lowerProperty)&&!e.lowerProperty.startsWith("section:")&&!e.lowerProperty.startsWith("section ")){if(null==t&&"email"===e.lowerProperty)return e.importRecord[e.property];if("created date"===e.lowerProperty||"modified date"===e.lowerProperty){const t=new Date(1e3*parseInt(e.importRecord[e.property],10)).toUTCString();return this.processKvp(e.cipher,"1Password "+e.property,t),null}e.lowerProperty.includes("password")||e.lowerProperty.includes("key")||e.lowerProperty.includes("secret")?this.processKvp(e.cipher,e.property,e.importRecord[e.property],x.fS.Hidden):this.processKvp(e.cipher,e.property,e.importRecord[e.property])}return null}setIdentityFirstName(e){return!(!this.isNullOrWhitespace(e.cipher.identity.firstName)||!e.lowerProperty.includes("first name"))&&(e.cipher.identity.firstName=e.importRecord[e.property],!0)}setIdentityInitial(e){return!(!this.isNullOrWhitespace(e.cipher.identity.middleName)||!e.lowerProperty.includes("initial"))&&(e.cipher.identity.middleName=e.importRecord[e.property],!0)}setIdentityLastName(e){return!(!this.isNullOrWhitespace(e.cipher.identity.lastName)||!e.lowerProperty.includes("last name"))&&(e.cipher.identity.lastName=e.importRecord[e.property],!0)}setIdentityUserName(e){return!(!this.isNullOrWhitespace(e.cipher.identity.username)||!e.lowerProperty.includes("username"))&&(e.cipher.identity.username=e.importRecord[e.property],!0)}setIdentityCompany(e){return!(!this.isNullOrWhitespace(e.cipher.identity.company)||!e.lowerProperty.includes("company"))&&(e.cipher.identity.company=e.importRecord[e.property],!0)}setIdentityPhone(e){return!(!this.isNullOrWhitespace(e.cipher.identity.phone)||!e.lowerProperty.includes("default phone"))&&(e.cipher.identity.phone=e.importRecord[e.property],!0)}setIdentityEmail(e){return!(!this.isNullOrWhitespace(e.cipher.identity.email)||!e.lowerProperty.includes("email"))&&(e.cipher.identity.email=e.importRecord[e.property],!0)}setCreditCardNumber(e){return!(!this.isNullOrWhitespace(e.cipher.card.number)||!e.lowerProperty.includes("number"))&&(e.cipher.card.number=e.importRecord[e.property],e.cipher.card.brand=V._.getCardBrandByPatterns(e.cipher.card.number),!0)}setCreditCardVerification(e){return!(!this.isNullOrWhitespace(e.cipher.card.code)||!e.lowerProperty.includes("verification number"))&&(e.cipher.card.code=e.importRecord[e.property],!0)}setCreditCardCardholderName(e){return!(!this.isNullOrWhitespace(e.cipher.card.cardholderName)||!e.lowerProperty.includes("cardholder name"))&&(e.cipher.card.cardholderName=e.importRecord[e.property],!0)}setCreditCardExpiry(e){return!(!this.isNullOrWhitespace(e.cipher.card.expiration)||!e.lowerProperty.includes("expiry date")||7!==e.importRecord[e.property].length)&&(e.cipher.card.expMonth=e.importRecord[e.property].substr(0,2),"0"===e.cipher.card.expMonth[0]&&(e.cipher.card.expMonth=e.cipher.card.expMonth.substr(1,1)),e.cipher.card.expYear=e.importRecord[e.property].substr(3,4),!0)}setLoginPassword(e){return!(!this.isNullOrWhitespace(e.cipher.login.password)||"password"!==e.lowerProperty)&&(e.cipher.login.password=e.importRecord[e.property],!0)}setLoginUsername(e){return!(!this.isNullOrWhitespace(e.cipher.login.username)||"username"!==e.lowerProperty)&&(e.cipher.login.username=e.importRecord[e.property],!0)}setLoginUris(e){if((null==e.cipher.login.uris||0===e.cipher.login.uris.length)&&"urls"===e.lowerProperty){const t=e.importRecord[e.property].split(this.newLineRegex);return e.cipher.login.uris=this.makeUriArray(t),!0}return"url"===e.lowerProperty&&(null==e.cipher.login.uris&&(e.cipher.login.uris=[]),e.cipher.login.uris.concat(this.makeUriArray(e.importRecord[e.property])),!0)}}class Be extends We{setCipherType(e,t){switch(this.getValueOrDefault(this.getProp(e,"type"),"Login")){case"Credit Card":t.type=h.O.Card,t.card=new V._,Ze.push("type");break;case"Identity":t.type=h.O.Identity,t.identity=new G.t,Ze.push("type");break;case"Login":case"Secure Note":Ze.push("type")}}}class qe extends We{constructor(){super(),this.identityPropertyParsers.push(this.setIdentityAddress)}setCipherType(e,t){t.type=h.O.Login,t.login=new U.q,this.isNullOrWhitespace(this.getPropByRegexp(e,/\d+: number/i))||this.isNullOrWhitespace(this.getPropByRegexp(e,/\d+: expiry date/i))||(t.type=h.O.Card,t.card=new V._),this.isNullOrWhitespace(this.getPropByRegexp(e,/name \d+: first name/i))&&this.isNullOrWhitespace(this.getPropByRegexp(e,/name \d+: initial/i))&&this.isNullOrWhitespace(this.getPropByRegexp(e,/name \d+: last name/i))&&this.isNullOrWhitespace(this.getPropByRegexp(e,/internet \d+: email/i))||(t.type=h.O.Identity,t.identity=new G.t)}setIdentityAddress(e){return!!e.lowerProperty.match(/address \d+: address/i)&&(this.processKvp(e.cipher,"address",e.importRecord[e.property]),!0)}setCreditCardExpiry(e){if(this.isNullOrWhitespace(e.cipher.card.expiration)&&e.lowerProperty.includes("expiry date")){const t=e.importRecord[e.property].split("/");return e.cipher.card.expMonth=t[0],"0"===e.cipher.card.expMonth[0]&&2===e.cipher.card.expMonth.length&&(e.cipher.card.expMonth=e.cipher.card.expMonth.substr(1,1)),e.cipher.card.expYear=t[2].length>4?t[2].substr(0,4):t[2],!0}return!1}}class Re extends D{parse(e){const t=new w,s=this.parseCsv(e,!1);if(null==s)return t.success=!1,Promise.resolve(t);let i=null;return s.forEach((e=>{if(null==i)return void(i=e.map((e=>e)));if(e.length<2||e.length!==i.length)return;if(!this.isNullOrWhitespace(e[1]))if(this.organization){e[1].split(",").forEach((e=>{e=e.trim();let s=!0,i=t.collections.length;for(let r=0;r<t.collections.length;r++)if(t.collections[r].name===e){s=!1,i=r;break}if(s){const s=new y.n;s.name=e,t.collections.push(s)}t.collectionRelationships.push([t.ciphers.length,i])}))}else{const s=e[1].split(","),i=s.length>0?s[0].trim():null;this.processFolder(t,i)}const s=this.initLoginCipher();s.name=this.getValueOrDefault(e[0],"--");for(let t=2;t<e.length;t++){const r=i[t].trim().toLowerCase();this.isNullOrWhitespace(e[t])||this.isNullOrWhitespace(r)||(this.usernameFieldNames.indexOf(r)>-1?s.login.username=e[t]:this.passwordFieldNames.indexOf(r)>-1?s.login.password=e[t]:this.uriFieldNames.indexOf(r)>-1?s.login.uris=this.makeUriArray(e[t]):this.processKvp(s,i[t],e[t]))}this.cleanupCipher(s),t.ciphers.push(s)})),t.success=!0,Promise.resolve(t)}}class Qe extends D{parse(e){const t=new w,s=this.parseCsv(e,!0);return null==s?(t.success=!1,Promise.resolve(t)):(s.forEach((e=>{this.processFolder(t,this.getValue("category",e));const s=this.initLoginCipher();s.notes=this.getValue("description",e),s.name=this.getValueOrDefault(this.getValue("title",e),"--"),s.login.username=this.getValue("username",e),s.login.password=this.getValue("password",e),s.login.uris=this.makeUriArray(this.getValue("site",e)),this.processKvp(s,"Password 2",this.getValue("password2",e)),this.cleanupCipher(s),t.ciphers.push(s)})),this.organization&&this.moveFoldersToCollections(t),t.success=!0,Promise.resolve(t))}getValue(e,t){return this.getValueOrDefault(t[e],this.getValueOrDefault(t[" "+e]))}}class Ye extends D{parse(e){const t=new w,s=JSON.parse(e);return null==s||null==s.passwords||0===s.passwords.length?(t.success=!1,Promise.resolve(t)):1==s.encrypted?(t.success=!1,t.errorMessage="Unable to import an encrypted passky backup.",Promise.resolve(t)):(s.passwords.forEach((e=>{const s=this.initLoginCipher();s.name=e.website,s.login.username=e.username,s.login.password=e.password,s.login.uris=this.makeUriArray(e.website),s.notes=e.message,this.convertToNoteIfNeeded(s),this.cleanupCipher(s),t.ciphers.push(s)})),t.success=!0,Promise.resolve(t))}}class Me extends D{parse(e){const t=new w,s=JSON.parse(e);return null==s||0===s.length?(t.success=!1,Promise.resolve(t)):(s.forEach((e=>{if(null!=e.tags&&e.tags.length>0){const s=e.tags[0].text;this.processFolder(t,s)}const s=this.initLoginCipher();s.name=e.label,s.login.username=this.getValueOrDefault(e.username),this.isNullOrWhitespace(s.login.username)?s.login.username=this.getValueOrDefault(e.email):this.isNullOrWhitespace(e.email)||(s.notes="Email: "+e.email+"\n"),s.login.password=this.getValueOrDefault(e.password),s.login.uris=this.makeUriArray(e.url),s.notes+=this.getValueOrDefault(e.description,""),null!=e.otp&&(s.login.totp=this.getValueOrDefault(e.otp.secret)),null!=e.custom_fields&&e.custom_fields.forEach((e=>{switch(e.field_type){case"text":case"password":this.processKvp(s,e.label,e.value)}})),this.convertToNoteIfNeeded(s),this.cleanupCipher(s),t.ciphers.push(s)})),this.organization&&this.moveFoldersToCollections(t),t.success=!0,Promise.resolve(t))}}class ze extends D{parse(e){const t=new w,s=this.parseCsv(e,!0);return null==s?(t.success=!1,Promise.resolve(t)):(s.forEach((e=>{const s=this.isNullOrWhitespace(e.Tags)?null:JSON.parse(e.Tags),i=null!=s&&null!=s.tags&&s.tags.length>0?s.tags.map((e=>{try{const t=JSON.parse(e);return this.getValueOrDefault(t.tag)}catch(t){}return null})).filter((e=>!this.isNullOrWhitespace(e))):null;this.organization&&null!=i&&i.length>0?i.forEach((e=>{let s=!0,i=t.collections.length;for(let r=0;r<t.collections.length;r++)if(t.collections[r].name===e){s=!1,i=r;break}if(s){const s=new y.n;s.name=e,t.collections.push(s)}t.collectionRelationships.push([t.ciphers.length,i])})):!this.organization&&null!=i&&i.length>0&&this.processFolder(t,i[0]);const r=this.initLoginCipher();r.notes=this.getValueOrDefault(e.Notes,""),r.notes+="\n\n"+this.getValueOrDefault(e["Shared Notes"],"")+"\n",r.name=this.getValueOrDefault(e["Entry Name"],"--"),r.login.username=this.getValueOrDefault(e["User ID"]),r.login.password=this.getValueOrDefault(e.Password),r.login.uris=this.makeUriArray(e.URL),null!=e.__parsed_extra&&e.__parsed_extra.length>0&&e.__parsed_extra.forEach((e=>{this.isNullOrWhitespace(e)||(r.notes+="\n"+e)}));const n=this.isNullOrWhitespace(e["Extra Fields"])?null:JSON.parse(e["Extra Fields"]),o=null!=n&&null!=n.extraFields&&n.extraFields.length>0?n.extraFields.map((e=>{try{return JSON.parse(e)}catch(t){}return null})):null;null!=o&&o.forEach((e=>{null!=e&&this.processKvp(r,e.name,e.data)})),this.cleanupCipher(r),t.ciphers.push(r)})),t.success=!0,Promise.resolve(t))}}class Je extends D{parse(e){const t=new w,s=this.parseCsv(e,!1);if(null==s)return t.success=!1,Promise.resolve(t);let i=!0;return s.forEach((e=>{if(5!==e.length&&e.length<9)return;const s=10===e.length&&"0"===e[0],r=this.initLoginCipher();if(r.name=this.getValueOrDefault(e[s?1:0],"--"),r.login.username=this.getValueOrDefault(e[s?2:1]),r.login.password=this.getValueOrDefault(e[s?3:2]),5===e.length)i=!1,r.notes=this.getValueOrDefault(e[4]),r.login.uris=this.makeUriArray(e[3]);else{const i=this.getValueOrDefault(e[s?9:8],"(None)");let n="(None)"!==i?i.split("\\").join("/"):null;null!=n&&(n=i.split(" > ").join("/"),n=i.split(">").join("/")),this.processFolder(t,n),r.notes=this.getValueOrDefault(e[s?5:3]),r.login.uris=this.makeUriArray(e[4])}this.convertToNoteIfNeeded(r),this.cleanupCipher(r),t.ciphers.push(r)})),i&&this.organization&&this.moveFoldersToCollections(t),t.success=!0,Promise.resolve(t)}}class je extends D{parse(e){const t=new w,s=JSON.parse(e);if(null==s||null==s.items)return t.success=!1,Promise.resolve(t);const i=new Map;s.folders.forEach((e=>{i.set(e.id,e.name)}));const r=new Map;return i.forEach(((e,s)=>{r.set(s,t.folders.length);const i=new v.a;i.name=e,t.folders.push(i)})),s.items.forEach((e=>{const s=this.initLoginCipher();if(s.name=this.getValueOrDefault(e.name,"--"),s.login.uris=this.makeUriArray(e.login_url),null!=e.folder&&r.has(e.folder)&&t.folderRelationships.push([t.ciphers.length,r.get(e.folder)]),null!=e.identifiers){this.isNullOrWhitespace(e.identifiers.notes)||(s.notes=e.identifiers.notes.split("\\r\\n").join("\n").split("\\n").join("\n")),"CreditCard"===e.type&&(s.card=new V._,s.type=h.O.Card);for(const t in e.identifiers){if(!e.identifiers.hasOwnProperty(t))continue;const r=e.identifiers[t],n=null!=r?r.toString():null;if(!this.isNullOrWhitespace(n)&&"notes"!==t&&"ignoreItemInSecurityScore"!==t)if("custom_fields"!==t){if(s.type===h.O.Card){if("cardNumber"===t){s.card.number=n,s.card.brand=V._.getCardBrandByPatterns(s.card.number);continue}if("nameOnCard"===t){s.card.cardholderName=n;continue}if("security_code"===t){s.card.code=n;continue}if("expires"===t){try{const e=new Date(n);s.card.expYear=e.getFullYear().toString(),s.card.expMonth=(e.getMonth()+1).toString()}catch(i){}continue}if("cardType"===t)continue}else{if(("username"===t||"email"===t)&&this.isNullOrWhitespace(s.login.username)){s.login.username=n;continue}if("password"===t){s.login.password=n;continue}if("totp"===t){s.login.totp=n;continue}if((null==s.login.uris||0===s.login.uris.length)&&this.uriFieldNames.indexOf(t)>-1){s.login.uris=this.makeUriArray(n);continue}}this.processKvp(s,t,n)}else r.forEach((e=>{this.processKvp(s,e.name,e.value)}))}this.convertToNoteIfNeeded(s),this.cleanupCipher(s),t.ciphers.push(s)}})),t.success=!0,Promise.resolve(t)}}class Ke extends D{parse(e){const t=new w,s=this.parseXml(e);if(null==s)return t.success=!1,Promise.resolve(t);const i=s.querySelectorAll("PasswordManager > record");return Array.from(i).forEach((e=>{const s=this.querySelectorDirectChild(e,"Category"),i=null==s||this.isNullOrWhitespace(s.textContent)||"Unfiled"===s.textContent?null:s.textContent;this.processFolder(t,i);const r=this.querySelectorDirectChild(e,"Account-Name"),n=this.querySelectorDirectChild(e,"User-Id"),o=this.querySelectorDirectChild(e,"Password"),a=this.querySelectorDirectChild(e,"URL"),l=this.querySelectorDirectChild(e,"Notes"),c=this.initLoginCipher();c.name=null!=r?this.getValueOrDefault(r.textContent,"--"):"--",c.notes=null!=l?this.getValueOrDefault(l.textContent):"",c.login.username=null!=n?this.getValueOrDefault(n.textContent):null,c.login.password=null!=o?this.getValueOrDefault(o.textContent):null,c.login.uris=null!=a?this.makeUriArray(a.textContent):null;const u=[];for(let t=1;t<=10;t++)u.push("Attribute-"+t);this.querySelectorAllDirectChild(e,u.join(",")).forEach((e=>{this.isNullOrWhitespace(e.textContent)||"null"===e.textContent||this.processKvp(c,e.tagName,e.textContent)})),this.cleanupCipher(c),t.ciphers.push(c)})),this.organization&&this.moveFoldersToCollections(t),t.success=!0,Promise.resolve(t)}}class Ge extends D{parse(e){const t=new w,s=this.parseXml(e);if(null==s)return t.success=!1,Promise.resolve(t);const i=s.querySelector("passwordsafe");if(null==i)return t.errorMessage="Missing `passwordsafe` node.",t.success=!1,Promise.resolve(t);const r=i.getAttribute("delimiter"),n=s.querySelectorAll("passwordsafe > entry");return Array.from(n).forEach((e=>{const s=this.querySelectorDirectChild(e,"group"),i=null==s||this.isNullOrWhitespace(s.textContent)?null:s.textContent.split(".").join("/");this.processFolder(t,i);const n=this.querySelectorDirectChild(e,"title"),o=this.querySelectorDirectChild(e,"username"),a=this.querySelectorDirectChild(e,"email"),l=this.querySelectorDirectChild(e,"password"),c=this.querySelectorDirectChild(e,"url"),u=this.querySelectorDirectChild(e,"notes"),p=this.initLoginCipher();p.name=null!=n?this.getValueOrDefault(n.textContent,"--"):"--",p.notes=null!=u?this.getValueOrDefault(u.textContent,"").split(r).join("\n"):null,p.login.username=null!=o?this.getValueOrDefault(o.textContent):null,p.login.password=null!=l?this.getValueOrDefault(l.textContent):null,p.login.uris=null!=c?this.makeUriArray(c.textContent):null,this.isNullOrWhitespace(p.login.username)&&null!=a?p.login.username=this.getValueOrDefault(a.textContent):null==a||this.isNullOrWhitespace(a.textContent)||(p.notes=this.isNullOrWhitespace(p.notes)?"Email: "+a.textContent:p.notes+"\nEmail: "+a.textContent),this.cleanupCipher(p),t.ciphers.push(p)})),this.organization&&this.moveFoldersToCollections(t),t.success=!0,Promise.resolve(t)}}class $e extends D{parse(e){const t=new w,s=this.parseCsv(e,!1);return null==s?(t.success=!1,Promise.resolve(t)):(s.forEach((e=>{if(e.length<1)return;e.length>5&&this.processFolder(t,e[5]);const s=this.initLoginCipher();s.name=this.getValueOrDefault(e[0],"--"),e.length>4&&(s.notes=this.getValueOrDefault(e[4],"").split("¬").join("\n")),e.length>2&&(s.login.username=this.getValueOrDefault(e[2])),e.length>3&&(s.login.password=this.getValueOrDefault(e[3])),e.length>1&&(s.login.uris=this.makeUriArray(e[1])),this.cleanupCipher(s),t.ciphers.push(s)})),this.organization&&this.moveFoldersToCollections(t),t.success=!0,Promise.resolve(t))}}var He;!function(e){e[e.ACTIVE=1]="ACTIVE",e[e.TRASHED=2]="TRASHED"}(He||(He={}));class Xe extends D{constructor(e){super(),this.i18nService=e}parse(e){const t=new w,s=JSON.parse(e);if(null==s||null==s.vaults)return t.success=!1,Promise.resolve(t);if(s.encrypted)return t.success=!1,t.errorMessage=this.i18nService.t("unsupportedEncryptedImport"),Promise.resolve(t);for(const[,i]of Object.entries(s.vaults))for(const e of i.items){if(e.state==He.TRASHED)continue;this.processFolder(t,i.name);const s=this.initLoginCipher();switch(s.name=e.data.metadata.name,s.notes=e.data.metadata.note,e.data.type){case"login":{const t=e.data.content;s.login.uris=this.makeUriArray(t.urls),s.login.username=t.username,s.login.password=t.password,""!=t.totpUri&&(s.login.totp=new URL(t.totpUri).searchParams.get("secret"));for(const i of e.data.extraFields)this.processKvp(s,i.fieldName,"totp"==i.type?i.data.totpUri:i.data.content,"text"==i.type?x.fS.Text:x.fS.Hidden);break}case"note":s.type=h.O.SecureNote,s.secureNote=new S.z,s.secureNote.type=x.xs.Generic;break;case"creditCard":{const t=e.data.content;s.type=h.O.Card,s.card=new V._,s.card.cardholderName=t.cardholderName,s.card.number=t.number,s.card.brand=V._.getCardBrandByPatterns(t.number),s.card.code=t.verificationNumber,this.isNullOrWhitespace(t.expirationDate)||(s.card.expMonth=t.expirationDate.substring(0,2),s.card.expMonth=s.card.expMonth.replace(/^0+/,""),s.card.expYear=t.expirationDate.substring(2,6)),this.isNullOrWhitespace(t.pin)||this.processKvp(s,"PIN",t.pin,x.fS.Hidden);break}}this.cleanupCipher(s),t.ciphers.push(s)}return this.organization&&this.moveFoldersToCollections(t),t.success=!0,Promise.resolve(t)}}class et extends D{constructor(){super(...arguments),this.WEBSITE_mappedValues=new Set(["type","name","website_password_title","website_password_notes","website_password_username","website_password_password","website_password_url","autosubmit","website_password_auto_submit","urlfilter","website_password_url_filter"]),this.APP_PWD_mappedValues=new Set(["type","name","application_password_title","application_password_notes","application_password_username","application_password_password"]),this.BOOKMARK_mappedValues=new Set(["type","name","bookmark_title","bookmark_notes","bookmark_url"]),this.NOTES_mappedValues=new Set(["type","name","note_title","note_notes"]),this.TOTP_mappedValues=new Set(["type","name","totp_title","totp_notes","totp_code"]),this.ENV_VARIABLES_mappedValues=new Set(["type","name","environment_variables_title","environment_variables_notes","environment_variables_variables"]),this.GPG_mappedValues=new Set(["type","name","mail_gpg_own_key_title","mail_gpg_own_key_public","mail_gpg_own_key_name","mail_gpg_own_key_email","mail_gpg_own_key_private"])}parse(e){const t=new w,s=JSON.parse(e);return null==s?(t.success=!1,Promise.resolve(t)):(this.parseFolders(t,s.folders),this.handleItemParsing(t,s.items),this.organization&&this.moveFoldersToCollections(t),t.success=!0,Promise.resolve(t))}parseFolders(e,t){null!=t&&0!==t.length&&t.forEach((t=>{null!=t.items&&0!=t.items.length&&(this.processFolder(e,t.name),this.handleItemParsing(e,t.items))}))}handleItemParsing(e,t){null!=t&&0!==t.length&&t.forEach((t=>{const s=this.parsePsonoItem(t);this.cleanupCipher(s),e.ciphers.push(s)}))}parsePsonoItem(e){const t=this.initLoginCipher();switch(e.type){case"website_password":this.parseWebsiteLogins(e,t);break;case"application_password":this.parseApplicationPasswords(e,t);break;case"environment_variables":this.parseEnvironmentVariables(e,t);break;case"totp":this.parseTOTP(e,t);break;case"bookmark":this.parseBookmarks(e,t);break;case"note":this.parseNotes(e,t)}return t}parseWebsiteLogins(e,t){var s;null!=e&&"website_password"==e.type&&(t.name=e.website_password_title,t.notes=e.website_password_notes,t.login.username=e.website_password_username,t.login.password=e.website_password_password,t.login.uris=this.makeUriArray(e.website_password_url),this.processKvp(t,"website_password_auto_submit",null===(s=e.website_password_auto_submit)||void 0===s?void 0:s.toString(),x.fS.Boolean),this.processKvp(t,"website_password_url_filter",e.website_password_url_filter),this.importUnmappedFields(t,e,this.WEBSITE_mappedValues))}parseApplicationPasswords(e,t){null!=e&&"application_password"==e.type&&(t.name=e.application_password_title,t.notes=e.application_password_notes,t.login.username=e.application_password_username,t.login.password=e.application_password_password,this.importUnmappedFields(t,e,this.APP_PWD_mappedValues))}parseBookmarks(e,t){null!=e&&"bookmark"==e.type&&(t.name=e.bookmark_title,t.notes=e.bookmark_notes,t.login.uris=this.makeUriArray(e.bookmark_url),this.importUnmappedFields(t,e,this.BOOKMARK_mappedValues))}parseNotes(e,t){null!=e&&"note"==e.type&&(t.type=h.O.SecureNote,t.secureNote=new S.z,t.secureNote.type=x.xs.Generic,t.name=e.note_title,t.notes=e.note_notes,this.importUnmappedFields(t,e,this.NOTES_mappedValues))}parseTOTP(e,t){null!=e&&"totp"==e.type&&(t.name=e.totp_title,t.notes=e.totp_notes,t.login.totp=e.totp_code,this.importUnmappedFields(t,e,this.TOTP_mappedValues))}parseEnvironmentVariables(e,t){null!=e&&"environment_variables"==e.type&&(t.type=h.O.SecureNote,t.secureNote=new S.z,t.secureNote.type=x.xs.Generic,t.name=e.environment_variables_title,t.notes=e.environment_variables_notes,e.environment_variables_variables.forEach((e=>{this.processKvp(t,e.key,e.value)})),this.importUnmappedFields(t,e,this.ENV_VARIABLES_mappedValues))}parseGPG(e,t){null!=e&&"mail_gpg_own_key"==e.type&&(t.type=h.O.SecureNote,t.secureNote=new S.z,t.secureNote.type=x.xs.Generic,t.name=e.mail_gpg_own_key_title,t.notes=e.mail_gpg_own_key_public,this.processKvp(t,"mail_gpg_own_key_name",e.mail_gpg_own_key_name),this.processKvp(t,"mail_gpg_own_key_email",e.mail_gpg_own_key_email),this.processKvp(t,"mail_gpg_own_key_private",e.mail_gpg_own_key_private,x.fS.Hidden),this.importUnmappedFields(t,e,this.GPG_mappedValues))}importUnmappedFields(e,t,s){Object.keys(t).filter((e=>!s.has(e))).forEach((s=>{const i=t;this.processKvp(e,s,i[s].toString())}))}}class tt extends D{parse(e){const t=new w,s=this.parseCsv(e,!0);return null==s?(t.success=!1,Promise.resolve(t)):(s.forEach((e=>{if("true"===e.trash)return;const s=this.initLoginCipher();if(s.name=this.getValueOrDefault(e.name),s.notes=this.getValueOrDefault(e.notes),"LoginItem"===e.type)s.login.uris=this.makeUriArray(e.website),s.login.password=this.getValueOrDefault(e.password),s.login.username=this.getValueOrDefault(e.username);else if("CreditCardItem"===e.type){s.type=h.O.Card,s.card=new V._,s.card.cardholderName=this.getValueOrDefault(e.cardholder),s.card.number=this.getValueOrDefault(e.number),s.card.brand=V._.getCardBrandByPatterns(s.card.number),s.card.code=this.getValueOrDefault(e.verification);try{const t=this.getValueOrDefault(e.expiryMonth);if(null!=t){const e=parseInt(t,null);null!=e&&e>=1&&e<=12&&(s.card.expMonth=e.toString())}}catch(i){}try{const t=this.getValueOrDefault(e.expiryYear);if(null!=t){const e=parseInt(t,null);null!=e&&(s.card.expYear=e.toString())}}catch(r){}const t=this.getValueOrDefault(e.pin);null!=t&&this.processKvp(s,"PIN",t);const n=this.getValueOrDefault(e.zipCode);null!=n&&this.processKvp(s,"Zip Code",n)}this.cleanupCipher(s),t.ciphers.push(s)})),t.success=!0,Promise.resolve(t))}}class st extends D{parse(e){const t=new w,s=this.parseCsv(e,!0);if(null==s)return t.success=!1,Promise.resolve(t);let i=1;return s.forEach((e=>{const r=!this.isNullOrWhitespace(e.Folder)&&e.Folder.startsWith("/")?e.Folder.replace("/",""):e.Folder,n=this.isNullOrWhitespace(r)?null:r;this.processFolder(t,n);const o=this.initLoginCipher();if(o.notes=this.getValueOrDefault(e.Note),o.name=this.getValueOrDefault(e.Name,"--"),o.login.username=this.getValueOrDefault(e.Login),o.login.password=this.getValueOrDefault(e.Pwd),o.login.uris=this.makeUriArray(e.Url),!this.isNullOrWhitespace(e.Rf_fields)){let t=[e.Rf_fields];null!=e.__parsed_extra&&e.__parsed_extra.length>0&&(t=t.concat(e.__parsed_extra)),t.forEach((e=>{const t=e.split(":");if(t.length<3)return;const s="-no-name-"===t[0]?null:t[0],i=4===t.length&&"rck"===t[2]?t[1]:t[2];this.processKvp(o,s,i)}))}this.convertToNoteIfNeeded(o),this.cleanupCipher(o),i===s.length&&"--"===o.name&&this.isNullOrWhitespace(o.login.password)||(t.ciphers.push(o),i++)})),this.organization&&this.moveFoldersToCollections(t),t.success=!0,Promise.resolve(t)}}class it extends D{parse(e){const t=new w,s=this.parseCsv(e,!0);return null==s?(t.success=!1,Promise.resolve(t)):(s.forEach((e=>{var s;const i=this.initLoginCipher();i.name=this.getValueOrDefault(e.Title,"--"),i.login.username=this.getValueOrDefault(e.Username),i.login.password=this.getValueOrDefault(e.Password),i.login.uris=this.makeUriArray(null!==(s=e.Url)&&void 0!==s?s:e.URL),i.login.totp=this.getValueOrDefault(e.OTPAuth),i.notes=this.getValueOrDefault(e.Notes),this.cleanupCipher(i),t.ciphers.push(i)})),t.success=!0,Promise.resolve(t))}}class rt extends D{parse(e){const t=new w,s=this.parseXml(e);if(null==s)return t.success=!1,Promise.resolve(t);if(null==s.querySelector("database"))return t.errorMessage="Missing `database` node.",t.success=!1,Promise.resolve(t);const i=new Map;return Array.from(s.querySelectorAll("database > label")).forEach((e=>{const s=e.getAttribute("name"),r=e.getAttribute("id");if(!this.isNullOrWhitespace(s)&&!this.isNullOrWhitespace(r)){i.set(r,t.folders.length);const e=new v.a;e.name=s,t.folders.push(e)}})),Array.from(s.querySelectorAll("database > card")).forEach((e=>{if("true"===e.getAttribute("template")||"true"===e.getAttribute("deleted"))return;const s=this.querySelectorDirectChild(e,"label_id");if(null!=s){const e=s.textContent;!this.isNullOrWhitespace(e)&&i.has(e)&&t.folderRelationships.push([t.ciphers.length,i.get(e)])}const r=this.initLoginCipher();r.name=this.getValueOrDefault(e.getAttribute("title"),"--"),"true"===e.getAttribute("star")&&(r.favorite=!0);"note"===e.getAttribute("type")?(r.type=h.O.SecureNote,r.secureNote=new S.z,r.secureNote.type=x.xs.Generic):Array.from(this.querySelectorAllDirectChild(e,"field")).forEach((e=>{const t=e.textContent;if(this.isNullOrWhitespace(t))return;const s=e.getAttribute("name"),i=this.getValueOrDefault(e.getAttribute("type"),"").toLowerCase();"login"===i?r.login.username=t:"password"===i||"secret"===i?this.processKvp(r,s,t,x.fS.Hidden):"one_time_password"===i?r.login.totp=t:"notes"===i?r.notes+=t+"\n":"weblogin"===i||"website"===i?r.login.uris=this.makeUriArray(t):this.processKvp(r,s,t)})),Array.from(this.querySelectorAllDirectChild(e,"notes")).forEach((e=>{r.notes+=e.textContent+"\n"})),this.setPassword(r),this.cleanupCipher(r),t.ciphers.push(r)})),this.organization&&this.moveFoldersToCollections(t),t.success=!0,Promise.resolve(t)}setPassword(e){const t=e.fields.filter((e=>e.type===x.fS.Hidden));if(!t.length)return;let s;for(const i of t)if(this.passwordFieldNames.includes(i.name.toLowerCase())){s=i,e.fields=e.fields.filter((e=>e!==s));break}s||(s=t[0]),e.login.password=s.value}}class nt extends D{parse(e){const t=new w,s=this.parseCsv(e,!0);return null==s?(t.success=!1,Promise.resolve(t)):(s.forEach((e=>{const s=this.initLoginCipher();s.name=this.getValueOrDefault(this.nameFromUrl(e.url),"--"),s.notes=this.getValueOrDefault(e.notes),s.login.username=this.getValueOrDefault(e.username),s.login.password=this.getValueOrDefault(e.password),s.login.uris=this.makeUriArray(e.url),this.cleanupCipher(s),t.ciphers.push(s)})),t.success=!0,Promise.resolve(t))}}class ot extends D{parse(e){const t=new w,s=this.parseCsv(e,!0);return null==s?(t.success=!1,Promise.resolve(t)):(s.forEach((e=>{const s=this.initLoginCipher();s.name=this.getValueOrDefault(e.Title),s.notes=this.getValueOrDefault(e.Comment),s.login.uris=this.makeUriArray(e.Url),s.login.password=this.getValueOrDefault(e.Password),s.login.username=this.getValueOrDefault(e.Username),this.cleanupCipher(s),t.ciphers.push(s)})),t.success=!0,Promise.resolve(t))}}class at extends D{parse(e){const t=new w,s=this.parseCsv(e,!1);return null==s?(t.success=!1,Promise.resolve(t)):(s.forEach((e=>{if(e.length<3)return;this.processFolder(t,this.getValueOrDefault(e[e.length-1]));const s=this.initLoginCipher();s.notes=this.getValueOrDefault(e[e.length-2],""),s.name=this.getValueOrDefault(e[1],"--"),"Web Logins"===e[0]||"Servers"===e[0]||"Email Accounts"===e[0]?(s.login.username=this.getValueOrDefault(e[2]),s.login.password=this.getValueOrDefault(e[3]),s.login.uris=this.makeUriArray(e[4]),this.parseFieldsToNotes(s,5,e)):this.parseFieldsToNotes(s,2,e),this.convertToNoteIfNeeded(s),this.cleanupCipher(s),t.ciphers.push(s)})),this.organization&&this.moveFoldersToCollections(t),t.success=!0,Promise.resolve(t))}parseFieldsToNotes(e,t,s){for(let i=t;i<s.length-3;i++)this.isNullOrWhitespace(s[i])||(e.notes+=s[i]+"\n")}}class lt extends D{parse(e){const t=new w,s=this.parseXml(e);if(null==s)return t.success=!1,Promise.resolve(t);const i=s.querySelectorAll("root > Database > Logins > Login");return Array.from(i).forEach((e=>{const i=e.getAttribute("ID");if(this.isNullOrWhitespace(i))return;const r=e.getAttribute("Name"),n=e.getAttribute("Password");let o=null,a=null,l=null,c=null,u=null;const p=s.querySelector('root > Database > Accounts > Account > LoginLinks > Login[SourceLoginID="'+i+'"]');if(null!=p){const e=p.parentElement.parentElement;null!=e&&(o=e.getAttribute("Name"),a=e.getAttribute("Link"),c=e.getAttribute("ParentID"),l=e.getAttribute("Comments"),this.isNullOrWhitespace(l)||(l=l.split("/n").join("\n")))}this.isNullOrWhitespace(c)||(u=this.buildGroupText(s,c,""),this.processFolder(t,u));const h=this.initLoginCipher();h.name=this.getValueOrDefault(o,"--"),h.notes=this.getValueOrDefault(l),h.login.username=this.getValueOrDefault(r),h.login.password=this.getValueOrDefault(n),h.login.uris=this.makeUriArray(a),this.cleanupCipher(h),t.ciphers.push(h)})),this.organization&&this.moveFoldersToCollections(t),t.success=!0,Promise.resolve(t)}buildGroupText(e,t,s){const i=e.querySelector('root > Database > Groups > Group[ID="'+t+'"]');return null==i?s:(this.isNullOrWhitespace(s)||(s="/"+s),s=i.getAttribute("Name")+s,this.buildGroupText(e,i.getAttribute("ParentID"),s))}}const ct=["kind","autologin","favorite","hexcolor","protectedwithpassword","subdomainonly","type","tk_export_version","note","title","document_content"];class ut extends D{parse(e){const t=new w,s=this.parseCsv(e,!0);return null==s?(t.success=!1,Promise.resolve(t)):(s.forEach((e=>{const s=this.initLoginCipher();if(s.favorite="true"===this.getValueOrDefault(e.favorite,"").toLowerCase(),s.name=this.getValueOrDefault(e.name,"--"),s.notes=this.getValueOrDefault(e.memo,""),s.login.username=this.getValueOrDefault(e.login),s.login.password=this.getValueOrDefault(e.password),s.login.uris=this.makeUriArray(e.url),"login"!==e.kind&&(s.name=this.getValueOrDefault(e.title,"--"),s.notes=this.getValueOrDefault(e.note,"")),"cc"===e.kind){if(s.type=h.O.Card,s.card=new V._,s.card.cardholderName=this.getValueOrDefault(e.cardholder),s.card.number=this.getValueOrDefault(e.number),s.card.brand=V._.getCardBrandByPatterns(s.card.number),!this.isNullOrWhitespace(e.expiryDate))try{const t=new Date(e.expiryDate);s.card.expYear=t.getFullYear().toString(),s.card.expMonth=(t.getMonth()+1).toString()}catch(i){}}else if("login"!==e.kind){s.type=h.O.SecureNote,s.secureNote=new S.z,s.secureNote.type=x.xs.Generic,this.isNullOrWhitespace(s.notes)||(s.notes=this.getValueOrDefault(e.document_content,""));for(const t in e)e.hasOwnProperty(t)&&ct.indexOf(t.toLowerCase())<0&&!this.isNullOrWhitespace(e[t])&&this.processKvp(s,t,e[t])}this.cleanupCipher(s),t.ciphers.push(s)})),t.success=!0,Promise.resolve(t))}}class pt extends D{parse(e){const t=new w,s=this.parseCsv(e,!1);return null==s?(t.success=!1,Promise.resolve(t)):(s.forEach((e=>{if(5!==e.length)return;const s=this.initLoginCipher();s.name=this.getValueOrDefault(e[0],"--"),s.notes=this.getValueOrDefault(e[4]),s.login.username=this.getValueOrDefault(e[1]),s.login.password=this.getValueOrDefault(e[2]),s.login.uris=this.makeUriArray(e[3]),this.cleanupCipher(s),t.ciphers.push(s)})),t.success=!0,Promise.resolve(t))}}class ht extends D{parse(e){const t=new w,s=this.parseCsv(e,!0);return null==s?(t.success=!1,Promise.resolve(t)):(s.forEach((e=>{const s=this.initLoginCipher();s.name=this.getValueOrDefault(e.Name,"--"),s.login.username=this.getValueOrDefault(e["User name"]),s.login.password=this.getValueOrDefault(e.Password),s.login.uris=this.makeUriArray(e.URL),this.cleanupCipher(s),t.ciphers.push(s)})),t.success=!0,Promise.resolve(t))}}class dt extends D{parse(e){const t=new w,s=this.parseCsv(e,!0);return null==s?(t.success=!1,Promise.resolve(t)):(s.forEach((e=>{if(this.isNullOrWhitespace(e["Password Name"])&&this.isNullOrWhitespace(e["Secret Name"]))return;this.processFolder(t,this.getValueOrDefault(e.ChamberName));const s=this.initLoginCipher();s.favorite="1"===this.getValueOrDefault(e.Favorite,"0"),s.notes=this.getValueOrDefault(e.Notes),s.name=this.getValueOrDefault(e["Password Name"],this.getValueOrDefault(e["Secret Name"],"--")),s.login.uris=this.makeUriArray(this.getValueOrDefault(e["Password URL"],this.getValueOrDefault(e["Secret URL"]))),this.parseData(s,e.SecretData),this.parseData(s,e.CustomData),this.convertToNoteIfNeeded(s),this.cleanupCipher(s),t.ciphers.push(s)})),this.organization&&this.moveFoldersToCollections(t),t.success=!0,Promise.resolve(t))}parseData(e,t){if(this.isNullOrWhitespace(t))return;this.splitNewLine(t).forEach((t=>{const s=t.indexOf(":");if(s<0)return;const i=t.substring(0,s),r=t.length>s?t.substring(s+1):null;if(this.isNullOrWhitespace(i)||this.isNullOrWhitespace(r)||"SecretType"===i)return;const n=i.toLowerCase();null==e.login.username&&this.usernameFieldNames.indexOf(n)>-1?e.login.username=r:null==e.login.password&&this.passwordFieldNames.indexOf(n)>-1?e.login.password=r:this.processKvp(e,i,r)}))}}const mt=[{id:"bitwardenjson",name:"Bitwarden (json)"},{id:"bitwardencsv",name:"Bitwarden (csv)"},{id:"chromecsv",name:"Chrome (csv)"},{id:"dashlanecsv",name:"Dashlane (csv)"},{id:"firefoxcsv",name:"Firefox (csv)"},{id:"keepass2xml",name:"KeePass 2 (xml)"},{id:"lastpasscsv",name:"LastPass (csv)"},{id:"safaricsv",name:"Safari and macOS (csv)"},{id:"1password1pux",name:"1Password (1pux/json)"}],ft=[{id:"keepassxcsv",name:"KeePassX (csv)"},{id:"1password1pif",name:"1Password (1pif)"},{id:"1passwordwincsv",name:"1Password 6 and 7 Windows (csv)"},{id:"1passwordmaccsv",name:"1Password 6 and 7 Mac (csv)"},{id:"dashlanejson",name:"Dashlane (json)"},{id:"roboformcsv",name:"RoboForm (csv)"},{id:"keepercsv",name:"Keeper (csv)"},{id:"enpasscsv",name:"Enpass (csv)"},{id:"enpassjson",name:"Enpass (json)"},{id:"protonpass",name:"ProtonPass (zip/json)"},{id:"safeincloudxml",name:"SafeInCloud (xml)"},{id:"pwsafexml",name:"Password Safe (xml)"},{id:"stickypasswordxml",name:"Sticky Password (xml)"},{id:"msecurecsv",name:"mSecure (csv)"},{id:"truekeycsv",name:"True Key (csv)"},{id:"passwordbossjson",name:"Password Boss (json)"},{id:"zohovaultcsv",name:"Zoho Vault (csv)"},{id:"splashidcsv",name:"SplashID (csv)"},{id:"passworddragonxml",name:"Password Dragon (xml)"},{id:"padlockcsv",name:"Padlock (csv)"},{id:"passboltcsv",name:"Passbolt (csv)"},{id:"clipperzhtml",name:"Clipperz (html)"},{id:"aviracsv",name:"Avira (csv)"},{id:"saferpasscsv",name:"SaferPass (csv)"},{id:"upmcsv",name:"Universal Password Manager (csv)"},{id:"ascendocsv",name:"Ascendo DataVault (csv)"},{id:"meldiumcsv",name:"Meldium (csv)"},{id:"passkeepcsv",name:"PassKeep (csv)"},{id:"operacsv",name:"Opera (csv)"},{id:"vivaldicsv",name:"Vivaldi (csv)"},{id:"gnomejson",name:"GNOME Passwords and Keys/Seahorse (json)"},{id:"blurcsv",name:"Blur (csv)"},{id:"passwordagentcsv",name:"Password Agent (csv)"},{id:"passpackcsv",name:"Passpack (csv)"},{id:"passmanjson",name:"Passman (json)"},{id:"avastcsv",name:"Avast Passwords (csv)"},{id:"avastjson",name:"Avast Passwords (json)"},{id:"fsecurefsk",name:"F-Secure KEY (fsk)"},{id:"kasperskytxt",name:"Kaspersky Password Manager (txt)"},{id:"remembearcsv",name:"RememBear (csv)"},{id:"passwordwallettxt",name:"PasswordWallet (txt)"},{id:"mykicsv",name:"Myki (csv)"},{id:"securesafecsv",name:"SecureSafe (csv)"},{id:"logmeoncecsv",name:"LogMeOnce (csv)"},{id:"blackberrycsv",name:"BlackBerry Password Keeper (csv)"},{id:"buttercupcsv",name:"Buttercup (csv)"},{id:"codebookcsv",name:"Codebook (csv)"},{id:"encryptrcsv",name:"Encryptr (csv)"},{id:"yoticsv",name:"Yoti (csv)"},{id:"nordpasscsv",name:"Nordpass (csv)"},{id:"psonojson",name:"Psono (json)"},{id:"passkyjson",name:"Passky (json)"}];var gt=function(e,t,s,i){return new(s||(s=Promise))((function(r,n){function o(e){try{l(i.next(e))}catch(t){n(t)}}function a(e){try{l(i.throw(e))}catch(t){n(t)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,a)}l((i=i.apply(e,t||[])).next())}))};class yt{constructor(e,t,s,i,r,n){this.cipherService=e,this.folderService=t,this.importApiService=s,this.i18nService=i,this.collectionService=r,this.cryptoService=n,this.featuredImportOptions=mt,this.regularImportOptions=ft}getImportOptions(){return this.featuredImportOptions.concat(this.regularImportOptions)}import(e,t,s=null,i=null,r){return gt(this,void 0,void 0,(function*(){let n;try{n=yield e.parse(t)}catch(o){if(o instanceof SyntaxError)throw new Error(this.i18nService.t("importFormatError"));throw o}if(!n.success){if(!p.c.isNullOrWhitespace(n.errorMessage))throw new Error(n.errorMessage);throw new Error(this.i18nService.t("importFormatError"))}if(0===n.folders.length&&0===n.ciphers.length)throw new Error(this.i18nService.t("importNothingError"));if(n.ciphers.length>0){const e=Math.floor(n.ciphers.length/2),t=n.ciphers.length-1;if(this.badData(n.ciphers[0])&&this.badData(n.ciphers[e])&&this.badData(n.ciphers[t]))throw new Error(this.i18nService.t("importFormatError"))}if(s&&p.c.isNullOrWhitespace(i)&&!r){if(n.ciphers.some((e=>!Array.isArray(e.collectionIds)||0==e.collectionIds.length)))throw new Error(this.i18nService.t("importUnassignedItemsError"))}try{yield this.setImportTarget(n,s,i),null!=s?yield this.handleOrganizationalImport(n,s):yield this.handleIndividualImport(n)}catch(o){const e=new u.i(o,400);throw this.handleServerError(e,n)}return n}))}getImporter(e,t,s=null){if(null==t)return null;const i=this.getImporterInstance(e,t);return null==i?null:(i.organizationId=s,i)}getImporterInstance(e,t){if(null==e)return null;switch(e){case"bitwardencsv":return new L;case"bitwardenjson":case"bitwardenpasswordprotected":return new Y(this.cryptoService,this.i18nService,t);case"lastpasscsv":case"passboltcsv":return new we;case"keepassxcsv":return new ye;case"aviracsv":return new E;case"blurcsv":return new M;case"safeincloudxml":return new rt;case"padlockcsv":return new Re;case"keepass2xml":return new ge;case"chromecsv":case"operacsv":case"vivaldicsv":return new T;case"firefoxcsv":return new ae;case"upmcsv":return new pt;case"saferpasscsv":return new nt;case"safaricsv":return new it;case"meldiumcsv":return new xe;case"1password1pif":return new Te;case"1password1pux":return new Fe;case"1passwordwincsv":return new qe;case"1passwordmaccsv":return new Be;case"keepercsv":return new ve;case"passworddragonxml":return new Ke;case"enpasscsv":return new re;case"enpassjson":return new oe;case"pwsafexml":return new Ge;case"dashlanecsv":return new ee;case"dashlanejson":return new se;case"msecurecsv":return new Ne;case"stickypasswordxml":return new lt;case"truekeycsv":return new ut;case"clipperzhtml":return new j;case"roboformcsv":return new st;case"ascendocsv":return new k;case"passwordbossjson":return new je;case"zohovaultcsv":return new dt;case"splashidcsv":return new at;case"passkeepcsv":return new Qe;case"gnomejson":return new ue;case"passwordagentcsv":return new Je;case"passpackcsv":return new ze;case"passmanjson":return new Me;case"avastcsv":return new P;case"avastjson":return new A;case"fsecurefsk":return new ce;case"kasperskytxt":return new fe;case"remembearcsv":return new tt;case"passwordwallettxt":return new $e;case"mykicsv":return new Pe;case"securesafecsv":return new ot;case"logmeoncecsv":return new Oe;case"blackberrycsv":return new I;case"buttercupcsv":return new J;case"codebookcsv":return new K;case"encryptrcsv":return new ie;case"yoticsv":return new ht;case"nordpasscsv":return new Ve;case"psonojson":return new et;case"passkyjson":return new Ye;case"protonpass":return new Xe(this.i18nService);default:return null}}handleIndividualImport(e){return gt(this,void 0,void 0,(function*(){const t=new a;for(let s=0;s<e.ciphers.length;s++){const i=yield this.cipherService.encrypt(e.ciphers[s]);t.ciphers.push(new d.a(i))}if(null!=e.folders)for(let s=0;s<e.folders.length;s++){const i=yield this.folderService.encrypt(e.folders[s]);t.folders.push(new g.C(i))}return null!=e.folderRelationships&&e.folderRelationships.forEach((e=>t.folderRelationships.push(new c(e[0],e[1])))),yield this.importApiService.postImportCiphers(t)}))}handleOrganizationalImport(e,t){return gt(this,void 0,void 0,(function*(){const s=new l;for(let i=0;i<e.ciphers.length;i++){e.ciphers[i].organizationId=t;const r=yield this.cipherService.encrypt(e.ciphers[i]);s.ciphers.push(new d.a(r))}if(null!=e.collections)for(let i=0;i<e.collections.length;i++){e.collections[i].organizationId=t;const r=yield this.collectionService.encrypt(e.collections[i]);s.collections.push(new f(r))}return null!=e.collectionRelationships&&e.collectionRelationships.forEach((e=>s.collectionRelationships.push(new c(e[0],e[1])))),yield this.importApiService.postImportOrganizationCiphers(t,s)}))}badData(e){return(null==e.name||"--"===e.name)&&e.type===h.O.Login&&null!=e.login&&p.c.isNullOrWhitespace(e.login.password)}handleServerError(e,t){if(null==e.validationErrors)return new Error(e.message);let s="";return Object.entries(e.validationErrors).forEach((([e,i],r)=>{let n,o;const a=Number(e.match(/[0-9]+/)[0]);switch(e.match(/^\w+/)[0]){case"Ciphers":n=t.ciphers[a],o=h.O[n.type];break;case"Folders":n=t.folders[a],o="Folder";break;case"Collections":n=t.collections[a],o="Collection";break;default:return}r>0&&(s+="\n\n"),"Folder"!==o&&"Collection"!==o&&(s+="["+(a+1)+"] "),s+="["+o+'] "'+n.name+'": '+i})),new Error(s)}setImportTarget(e,t,s){return gt(this,void 0,void 0,(function*(){if(p.c.isNullOrWhitespace(s))return;if(t){const t=(yield this.collectionService.getAllDecrypted()).find((e=>e.id===s)),i=[];e.ciphers.forEach(((e,s)=>{Array.isArray(e.collectionIds)&&0!=e.collectionIds.length||(e.collectionIds=[t.id],i.push([s,0]))}));const r=[...e.collections];e.collections=[t],r.map((s=>{const i=new y.n;i.name=`${t.name}/${s.name}`,e.collections.push(i)}));const n=[...e.collectionRelationships];return e.collectionRelationships=[...i],void n.map((t=>{e.collectionRelationships.push([t[0],t[1]+1])}))}const i=(yield this.folderService.getAllDecryptedFromState()).find((e=>e.id===s)),r=[];e.ciphers.forEach(((e,t)=>{p.c.isNullOrEmpty(e.folderId)&&(e.folderId=i.id,r.push([t,0]))}));const n=[...e.folders];e.folders=[i],n.map((t=>{const s=`${i.name}/${t.name}`,r=new v.a;r.name=s,e.folders.push(r)}));const o=[...e.folderRelationships];e.folderRelationships=[...r],o.map((t=>{e.folderRelationships.push([t[0],t[1]+1])}))}))}}}}]);
//# sourceMappingURL=212.b6e5d6da5ce23ac1e1bb.js.map